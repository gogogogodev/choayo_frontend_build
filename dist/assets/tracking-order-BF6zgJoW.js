import{r as l,k as e,q as E,v as L,a as j,e as b,u as B,g as N,t as M,aw as s,C as w,ax as A,F as Y,S as i,ay as H,o as G,az as z,aA as W,l as d,aB as q,aC as v,aD as V,aE as J,aF as g,c as K,f as P,m as Q,n as k,aG as X,aH as U,aI as Z,as as ee,aJ as _,aK as te,aL as re,H as se}from"./index-DL1FC2Xw.js";import{u as ie}from"./use-params-Ck7vsunK.js";import{F as ne}from"./form-caption-DFg98poz.js";import{f as u}from"./format-number-CnUv9gu0.js";import{T as f}from"./text-divider-CeTsOEqe.js";import{P as ae}from"./product-icon-7f0PvYQ8.js";import{C as y}from"./Card-x9v4l8Wx.js";import{C as h}from"./CardHeader-bsWkR9QZ.js";import{T as oe,a as ce,b as S,c as de}from"./TableRow-Dnp-F93Q.js";import{T as x}from"./TableCell--CDe426o.js";import{S as m}from"./Skeleton-M-yixhCy.js";import{T as le,a as xe,b as ue,c as me,d as he,e as pe,t as ge}from"./TimelineSeparator-CtgkETtB.js";import"./divider-oAQn-qZp.js";import"./errors-wZ747Yys.js";const C=l.createContext(void 0),D=()=>{const t=l.useContext(C);if(t===void 0)throw new Error("useContextPage must be used within a PageContext.Provider");return t},je=({children:t})=>{const[r,n]=l.useState(null),o=c=>{n(c)},a=l.useMemo(()=>({trackingOrderDetail:r,updateTrackingOrderDetail:o}),[r]);return e.jsx(C.Provider,{value:a,children:t})},be="_bg_tracking_order_pin_12to7_1",T={bg_tracking_order_pin:be},ye=E({pin:L()}),_e={pin:""},fe=async t=>{try{return(await j.post(`${b.customer.tracking_order}`,t)).data}catch(r){throw console.error("TrackingOrderPinFormSubmit - error : ",r),new Error("something wrong")}},Te=async t=>{try{return(await j.get(`${b.transaction.point.history_list}/${t}?pointRequest=orderPoint`)).data}catch(r){throw console.error("OrderPaymentPointGet - error : ",r),new Error("unexpected error occurred")}},we=async t=>{try{return(await j.get(`${b.transaction.order.logs}/${t}`)).data}catch(r){throw console.error("TrackingOrderLogsGet - error : ",r),new Error("something wrong")}};function ve(){const t=B(),{order_id:r=""}=ie(),{trackingOrderDetail:n,updateTrackingOrderDetail:o}=D(),a=N({resolver:M(ye),defaultValues:_e}),{watch:c,handleSubmit:p,formState:{isSubmitting:O,isDirty:$}}=a,F=async I=>{await fe({order_id:r,pin:I.pin}).then(R=>{o(R)}).catch(()=>{})};return n===null&&e.jsx(s,{sx:{width:"100%",height:"100vh",position:"relative",backgroundRepeat:"no-repeat",backgroundPositionX:"center",backgroundPositionY:{xs:"14%",sm:"center"},backgroundSize:{xs:"200px",sm:"60%",md:"50%",lg:"40%"},backgroundImage:`url(${w.site.basePath}/logo/logo-custom-full-midnight.png)`},children:e.jsxs(s,{className:T.bg_tracking_order_pin,sx:{position:"relative",width:"100%",height:"100%",display:"flex",alignItems:"center",backdropFilter:"blur(0px)"},children:[e.jsx("div",{className:T.bg_tracking_order_pin}),e.jsx(A,{maxWidth:"md",sx:{px:4},children:e.jsx(Y,{methods:a,onSubmit:p(F),children:e.jsxs(i,{spacing:2,children:[e.jsx(s,{sx:{backgroundColor:t.vars.palette.primary.light,borderRadius:t.shape.borderRadius/8},children:e.jsx(H,{name:"pin",size:"medium"})}),e.jsx(ne,{caption:"Masukan pin invoice anda"}),e.jsx(s,{sx:{display:"flex",justifyContent:"end"},children:e.jsx(G,{size:"medium",type:"submit",variant:"contained",loading:O,disabled:!$||c("pin").length<6,children:"Submit"})})]})})})]})})}function Pe({trackingOrderDetail:t}){return e.jsxs(y,{children:[e.jsx(h,{title:"Order List"}),e.jsx(s,{sx:{position:"relative",px:2.5,pt:2.5},children:e.jsx(z,{children:e.jsxs(oe,{size:"medium",sx:{minWidth:0},children:[e.jsx(Se,{}),e.jsx(Ce,{rows:t.order_products})]})})})]})}const ke=[{id:"product_info",label:"Product"},{id:"add_ons",label:"Add-Ons",width:"15%"},{id:"price",label:"Price",width:"10%"},{id:"qty",label:"Quantity",width:"10%"},{id:"total_price",label:"Total Price",width:"15%"},{id:"laundry_status",label:"Status",width:"10%"}];function Se(){return e.jsx(ce,{children:e.jsx(S,{children:ke.map(t=>e.jsx(x,{align:t.align||"left",sortDirection:!1,sx:{width:t.width,minWidth:0},children:t.label},t.id))})})}function Ce({rows:t}){return e.jsx(de,{children:t.map((r,n)=>{const o=r.order_product_detail&&r.order_product_detail?.addons?.reduce((c,p)=>c+Number(p.price),0)||0;let a=Number(r.price_item);return r.discount_type===W.absolute?a-=Number(r.discount_value):a-=a*Number(r.discount_value)/100,e.jsxs(S,{sx:{bgcolor:""},children:[e.jsxs(x,{sx:{whiteSpace:"nowrap",display:"flex",color:""},children:[e.jsx(ae,{icon_name:"",sx:{width:64,height:64}}),e.jsxs(s,{sx:{ml:2},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:r.name}),e.jsx(d,{variant:"body2",gutterBottom:!0,children:r.order_product_detail&&r.order_product_detail.brand_name!==""?r.order_product_detail.brand_name:"-"}),e.jsx(d,{variant:"body2",gutterBottom:!0,children:r.order_product_detail&&r.order_product_detail.color_name!==""?r.order_product_detail.color_name:"-"})]})]}),e.jsx(x,{sx:{whiteSpace:"wrap",color:""},children:e.jsx(f,{type:"normal",disableDivider:!0,lowerTextProps:{variant:"caption",color:"text.disabled"},upperText:`Rp. ${u(o)}`,lowerText:r.order_product_detail&&r.order_product_detail?.addons.length>0?r.order_product_detail?.addons.map(c=>`${q(c.name)}`).join(", "):"-"})}),e.jsx(x,{sx:{whiteSpace:"nowrap",color:""},children:e.jsx(f,{type:"normal",disableDivider:!0,lowerTextProps:{variant:"caption",color:"text.disabled",sx:{textDecoration:"line-through"}},upperText:`Rp. ${u(a)}`,lowerText:`Rp. ${Number(r.price_item)}`})}),e.jsx(x,{sx:{whiteSpace:"nowrap",color:""},children:r.qty}),e.jsx(x,{sx:{whiteSpace:"nowrap",color:""},children:`Rp. ${u(Number(r.total_net)+o)}`}),e.jsx(x,{sx:{whiteSpace:"nowrap",color:""},children:e.jsx(v,{children:V(r.laundry_status)})})]},n)})})}function De(){const{trackingOrderDetail:t}=D();return t&&e.jsxs(J,{sx:{pt:5},children:[e.jsx(Oe,{trackingOrderDetail:t}),e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{order:{xs:2,md:1},xs:12,md:8,children:e.jsxs(i,{spacing:3,direction:"column",children:[e.jsx($e,{trackingOrderDetail:t}),e.jsx(Pe,{trackingOrderDetail:t})]})}),e.jsx(g,{order:{xs:1,md:2},xs:12,md:4,children:e.jsx(Ie,{trackingOrderDetail:t})})]})]})}function Oe({trackingOrderDetail:t}){const r=K();return P(),e.jsx(i,{spacing:3,direction:{xs:"column",md:"row"},sx:{mb:{xs:3,md:5}},children:e.jsxs(i,{spacing:1,direction:"row",alignItems:"flex-start",children:[e.jsx(Q,{onClick:()=>r.refresh(),children:e.jsx(k,{icon:"eva:arrow-ios-back-fill"})}),e.jsxs(i,{spacing:.5,children:[e.jsxs(i,{spacing:1,direction:"row",alignItems:"center",children:[e.jsxs(d,{variant:"h4",children:[" Order ",`#${t.order_no}`," "]}),e.jsx(v,{variant:"soft",color:U(t.status),children:X(t.status)})]}),e.jsx(d,{variant:"body2",sx:{color:"text.disabled"},children:`${Z(t.date,"DD MMMM YYYY hh:mm")} WIB`})]})]})})}function $e({trackingOrderDetail:t}){const r=P(!1),[n,o]=l.useState([]),a=async()=>{r.onTrue(),await we(t.id).then(c=>{o(c.data)}).finally(()=>{r.onFalse()})};return l.useEffect(()=>{a()},[t]),e.jsxs(y,{children:[e.jsx(h,{title:"Delivery Timeline"}),r.value?e.jsxs(i,{spacing:2,sx:{p:3,mt:1},children:[e.jsx(m,{variant:"rounded",sx:{width:"100%",height:20}}),e.jsx(m,{variant:"rounded",sx:{width:"100%",height:20}}),e.jsx(m,{variant:"rounded",sx:{width:"100%",height:20}}),e.jsx(m,{variant:"rounded",sx:{width:"100%",height:20}})]}):e.jsx(i,{spacing:3,sx:{p:3,mt:1},direction:{xs:"column",md:"row"},children:e.jsx(Fe,{logs:n})})]})}function Fe({logs:t}){return e.jsx(le,{sx:{p:0,m:0,[`& .${ge.root}:before`]:{flex:0,padding:0}},children:t.map((r,n)=>{const o=n===t.length-1;return e.jsxs(xe,{children:[e.jsxs(ue,{children:[e.jsx(me,{color:"success"}),o?null:e.jsx(he,{})]}),e.jsxs(pe,{children:[e.jsx(d,{variant:"subtitle2",children:_(r.status,"en")}),e.jsx(d,{variant:"subtitle2",color:"text.disabled",fontWeight:400,children:_(r.status,"id")}),e.jsx(s,{sx:{color:"text.disabled",typography:"caption",mt:.5},children:`${te(r.created_at,"DD MMMM YYYY hh:mm")} WIB`})]})]},n)})})}function Ie({trackingOrderDetail:t}){return e.jsxs(y,{children:[e.jsx(Re,{trackingOrderDetail:t}),e.jsx(ee,{sx:{borderStyle:"dashed"}}),e.jsx(Ee,{trackingOrderDetail:t})]})}function Re({trackingOrderDetail:t}){const[r,n]=l.useState(0),o=async()=>{await Te(t.customer?.id??"").then(a=>{n(Number(a.balance))}).catch(()=>{})};return l.useEffect(()=>{o()},[]),e.jsxs(e.Fragment,{children:[e.jsx(h,{title:"Customer"}),e.jsxs(i,{direction:"row",sx:{p:3,mt:1},children:[e.jsx(re,{src:"-",alt:t.customer.name,sx:{width:48,height:48,mr:2}}),e.jsxs(i,{spacing:.5,alignItems:"flex-start",sx:{typography:"body2"},children:[e.jsx(d,{variant:"subtitle2",children:t.customer.name}),e.jsxs(s,{sx:{color:"text.secondary",display:"flex",alignItems:"center"},children:[e.jsx(k,{icon:"ri:coin-fill",sx:{color:"warning.light",mr:1}}),e.jsx(d,{variant:"body2",sx:{color:"text.disabled"},children:u(r)})]})]})]})]})}function Ee({trackingOrderDetail:t}){return e.jsxs(e.Fragment,{children:[e.jsx(h,{title:"Payment"}),e.jsxs(i,{spacing:2,sx:{p:3,mt:1,typography:"body2"},children:[e.jsxs(i,{direction:"row",justifyContent:"space-between",children:[e.jsx(s,{sx:{color:"text.secondary"},children:"Amount order"}),e.jsx(s,{sx:{typography:"subtitle2"},children:`Rp. ${u(Number(t.net_payable_amount??"0"))}`})]}),e.jsxs(i,{direction:"row",justifyContent:"space-between",children:[e.jsx(s,{sx:{color:"text.secondary"},children:"Amount paid"}),e.jsx(s,{sx:{typography:"subtitle2"},children:`Rp. ${u(Number(t.total_paid??"0"))}`})]}),e.jsxs(i,{direction:"row",justifyContent:"space-between",children:[e.jsx(s,{sx:{color:"text.secondary"},children:"Balance"}),e.jsx(s,{sx:{typography:"subtitle2",color:"error.main"},children:`Rp. ${u(Number(t.total_paid??"0")-Number(t.net_payable_amount??"0"))}`})]})]})]})}const Le={title:`Tracking Order - ${w.site.name}`};function Xe(){return e.jsxs(e.Fragment,{children:[e.jsx(se,{children:e.jsxs("title",{children:[" ",Le.title]})}),e.jsxs(je,{children:[e.jsx(ve,{}),e.jsx(De,{})]})]})}export{Xe as default};
