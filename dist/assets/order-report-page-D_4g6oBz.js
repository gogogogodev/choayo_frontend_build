import{r,fC as _,k as e,c as V,p as k,aI as b,aZ as H,aC as L,aH as W,q as y,v as S,a as A,e as q,d as z,f as G,g as N,t as U,S as R,F as K,aF as j,aU as Z,dg as C,ag as D,n as P,o as J,dC as Q,aw as X,az as ee,ib as O,H as te,C as ae,aE as se}from"./index-DL1FC2Xw.js";import{C as re}from"./custom-breadcrumbs-nJImJlyu.js";import{T as oe}from"./table-pagination-custom-D4L-eNU7.js";import{a as ne,b as $,c as ie,T as le}from"./TableRow-Dnp-F93Q.js";import{T as l}from"./TableCell--CDe426o.js";import{T as v}from"./table-body-rowinfo-yZgQl4g3.js";import{f as M}from"./format-number-CnUv9gu0.js";import{R as F}from"./rhf-date-picker-CcRSy6lj.js";import{O as de}from"./functions-C5vispQk.js";import{C as ce}from"./Card-x9v4l8Wx.js";import"./TablePagination-Cu0e8Dmj.js";import"./LastPage-CNSkhtZT.js";import"./FormControlLabel-RF8C1zCS.js";import"./DatePicker-x3rEWLr9.js";import"./ListItem-ByRhTH_M.js";import"./MobileDateTimePicker-DRzd3izO.js";import"./errors-wZ747Yys.js";const B=r.createContext(void 0),I=()=>{const t=r.useContext(B);if(t===void 0)throw new Error("useContextSearch must be used within a PageContext.Provider");return t},he=({children:t})=>{const[a,o]=r.useState(0),n=()=>o(i=>i+1),[c,p]=r.useState({store:{id:"all",name:""},start_date:`${_("YYYY-MM")}-01`,end_date:`${_("YYYY-MM-DD")}`}),h=i=>{p(i)},[u,w]=r.useState(0),d=i=>{w(i)},[m,x]=r.useState(0),g=i=>{x(i)},f=r.useMemo(()=>({refreshFlag:a,triggerRefresh:n,toolbarSearchValue:c,updateToolbarSearchValue:h,page:u,updatePage:d,rowsPerPage:m,updateRowsPerPage:g}),[a,c,u,m]);return e.jsx(B.Provider,{value:f,children:t})};function ue(){return e.jsx(re,{heading:"Order Report",links:[{name:"Reports",href:"#"},{name:"Order",href:"#"}],sx:{mb:{xs:3,md:5}}})}const Y=[{id:"code",label:"Code",width:10},{id:"customer",label:"Customer",width:100},{id:"phone",label:"Phone",width:100},{id:"items",label:"Items",width:100},{id:"tanggal",label:"Tanggal",width:100},{id:"tagihan",label:"Tagihan",width:100},{id:"terbayar",label:"Terbayar",width:100},{id:"status",label:"Status",width:100}];function xe(){return e.jsx(ne,{children:e.jsx($,{children:Y.map(t=>e.jsx(l,{align:t.align||"left",sortDirection:!1,sx:{width:t.width,minWidth:0},children:t.label},t.id))})})}function pe({row:t}){const a=V();return r.useCallback(o=>{a.push(`${k.dashboard.transaction.order.details(o)}/invoice`)},[a]),e.jsxs($,{hover:!0,children:[e.jsx(l,{sx:{whiteSpace:"nowrap"},children:t.order_no}),e.jsx(l,{sx:{whiteSpace:"nowrap"},children:t.customer.name}),e.jsx(l,{sx:{whiteSpace:"nowrap"},children:t.customer.phone??"-"}),e.jsx(l,{sx:{whiteSpace:"nowrap"},children:t.order_products_count}),e.jsx(l,{sx:{whiteSpace:"nowrap"},children:b(Number(t.date),H.dateTime)}),e.jsx(l,{sx:{whiteSpace:"nowrap"},children:M(t.net_payable_amount)}),e.jsx(l,{sx:{whiteSpace:"nowrap"},children:M(t.amount_paid)}),e.jsx(l,{sx:{whiteSpace:"nowrap"},children:e.jsx(L,{variant:"soft",color:W(t.status),children:t.status})})]})}function me({rows:t,status:a}){return e.jsx(ie,{children:a==="loading"?e.jsx(v,{text:"loading ..",colspan:Y.length}):t.length===0?e.jsx(v,{text:"data not found",colspan:Y.length}):t.map((o,n)=>e.jsx(pe,{row:o},n))})}const ge=y({store:y({id:S(),name:S()}).nullable(),start_date:S(),end_date:S()}).refine(t=>!(t.end_date&&!t.start_date),{message:"Start date is required",path:["start_date"]}),E={store:null,start_date:`${_("YYYY-MM")}-01`,end_date:_("YYYY-MM-DD")},fe=async t=>{try{const a=b(t.start_date,"YYYY-M-D"),o=b(t.end_date,"YYYY-M-D"),n=await A.post(`${q.report.order}?start_at=${a}&end_at=${o}&store_id=${t.store?.id??""}&mode=url`);window.open(n.data,"__blank")}catch(a){throw console.error("OrderReportDownload - error : ",a),new Error("something wrong")}};function je(){const{loginInfo:t}=z(),{triggerRefresh:a,updateToolbarSearchValue:o}=I(),n=G(!1),[c,p]=r.useState([]);r.useEffect(()=>{t&&p(t.stores)},[t]);const h=N({resolver:U(ge),defaultValues:E}),{reset:u,setValue:w,handleSubmit:d,formState:{isDirty:m}}=h,x=async s=>{o(s),a()},g=async()=>{u(E),o(null),a()},f=async s=>{n.onTrue(),await fe(s).finally(()=>{n.onFalse()})},i=async s=>{s.start_date?.message&&Q.warning(s.start_date?.message,{position:"top-center"})};return e.jsx(R,{sx:{p:2.5},children:e.jsx(K,{methods:h,children:e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{xs:12,lg:3,children:e.jsx(Z,{options:c,name:"store",label:"Store",getOptionKey:s=>s.id,getOptionLabel:s=>s.name,isOptionEqualToValue:(s,T)=>s.id===T.id})}),e.jsx(j,{xs:12,lg:3,children:e.jsx(F,{name:"start_date",label:"Start Date",hideErrorMessage:!0})}),e.jsx(j,{xs:12,lg:3,children:e.jsx(F,{name:"end_date",label:"End Date"})}),e.jsx(j,{xs:12,lg:3,children:e.jsxs(R,{spacing:2,direction:"row",sx:{height:"100%",alignItems:"stretch"},children:[e.jsx(C,{title:"reset",arrow:!0,children:e.jsx("span",{style:{display:"flex",flex:1},children:e.jsx(D,{fullWidth:!0,onClick:g,variant:"outlined",color:"warning",sx:{height:"100%"},children:e.jsx(P,{icon:"system-uicons:reset-alt"})})})}),e.jsx(C,{title:"search",arrow:!0,children:e.jsx("span",{style:{display:"flex",flex:1},children:e.jsx(D,{fullWidth:!0,onClick:d(x,i),variant:"outlined",color:"info",sx:{height:"100%"},children:e.jsx(P,{icon:"material-symbols:search-rounded"})})})}),e.jsx(C,{title:"download",arrow:!0,children:e.jsx("span",{style:{display:"flex",flex:1},children:e.jsx(J,{onClick:d(f,i),fullWidth:!0,size:"medium",type:"submit",variant:"outlined",loading:n.value,sx:{height:"100%"},children:e.jsx(P,{icon:"material-symbols:download"})})})})]})})]})})})}function be(){const{refreshFlag:t,toolbarSearchValue:a}=I(),[o,n]=r.useState(0),[c,p]=r.useState(0),[h,u]=r.useState(15),[w,d]=r.useState([]),[m,x]=r.useState(!1),g=async()=>{a===null?d([]):(x(!0),await de({page:o+1,start_date:O(`${b(a.start_date,"YYYY-MM-DD")} 00:00:01`)?.toString(),end_date:O(`${b(a.end_date,"YYYY-MM-DD")} 23:59:59`)?.toString(),store_id:a.store?.id??"all"}).then(s=>{d(s.data),p(s.total),n(s.current_page-1)}).finally(()=>{x(!1)}))};r.useEffect(()=>{g()},[a,t,o]);const f=(s,T)=>{n(T)},i=s=>{u(parseInt(s.target.value,10)),n(0)};return e.jsxs(ce,{children:[e.jsx(je,{}),e.jsx(X,{sx:{position:"relative"},children:e.jsx(ee,{children:e.jsxs(le,{size:"medium",sx:{minWidth:0},children:[e.jsx(xe,{}),e.jsx(me,{rows:w,status:m?"loading":"finish"})]})})}),e.jsx(oe,{dense:!1,page:o,count:c,rowsPerPage:h,rowsPerPageOptions:[15,25,100],onPageChange:f,onRowsPerPageChange:i})]})}const we={title:`Reports - Order Report - ${ae.site.name}`};function Ve(){return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsxs("title",{children:[" ",we.title]})}),e.jsx(se,{maxWidth:"xl",children:e.jsxs(he,{children:[e.jsx(ue,{}),e.jsx(be,{})]})})]})}export{Ve as default};
