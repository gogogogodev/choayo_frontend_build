import{u as Lt,r,k as e,cS as Mt,c9 as bt,aw as C,l as m,aC as Z,cs as ze,C as W,f as M,S as v,bI as Ae,ca as $t,cb as Wt,g as ie,t as ne,F as re,ay as z,I as Je,n as E,aF as o,bH as le,aA as te,aX as Bt,m as xe,o as ae,as as et,c6 as fe,dj as de,c8 as ce,bZ as ue,ag as G,aI as Ne,aZ as tt,az as st,d as at,cD as _t,i7 as we,h as Ct,ie as ee,ih as Ut,aB as Pe,iB as wt,ia as it,i9 as me,iu as A,iv as Fe,dC as qe,iG as oe,iJ as zt,fs as nt,id as pe,ix as Ge,ic as _e,iS as Ye,i8 as qt,iy as Q,bK as Gt,iK as Yt,aS as Kt,cc as Ke,iQ as Re,iO as rt,aH as St,aU as Xt,is as pt,cP as Qt,aG as Zt,iP as Jt,cQ as es,cd as ts,af as ss,iT as as,iR as Ie,iU as xt,p as is,H as ns,aE as rs}from"./index-DL1FC2Xw.js";import{u as V,C as os,b as ls,c as ds,d as cs,e as us,f as ms,g as Ce,h as hs,i as $e,j as ps,k as We,l as xs,m as Be,n as fs,o as js,p as gs,q as ft,r as ys,s as jt,t as vs,I as gt,v as bs,P as _s}from"./schema-CM6cLXsy.js";import{u as Cs}from"./use-params-Ck7vsunK.js";import{C as ws,c as Ss,V as Ds,d as Ps,e as ks,M as Dt,f as Ts,g as Is,h as Os,i as Fs,j as Rs,k as As,l as Es,m as Vs,n as Ns,o as Hs,p as Ls,q as Ms,r as $s,s as Ws,R as Bs,t as Us,u as zs,v as qs,w as Gs,x as Ys,y as Ks,z as Xs,A as Qs,B as Zs,D as Js,E as ea}from"./functions-C5vispQk.js";import{S as se}from"./Skeleton-M-yixhCy.js";import{f as $}from"./format-number-CnUv9gu0.js";import{P as Pt,h as ta}from"./product-icon-7f0PvYQ8.js";import{V as sa}from"./functions-wDwdqj4f.js";import{C as K}from"./Card-x9v4l8Wx.js";import{C as aa}from"./CardHeader-bsWkR9QZ.js";import{T as Ue}from"./text-divider-CeTsOEqe.js";import{T as ke}from"./table-body-rowinfo-yZgQl4g3.js";import{T as ot,a as lt,b as Se,c as dt}from"./TableRow-Dnp-F93Q.js";import{T as H}from"./TableCell--CDe426o.js";import{C as ct}from"./errors-wZ747Yys.js";import{R as Ee}from"./rhf-radio-group-c3xmrwMe.js";import{R as Xe}from"./rhf-switch-D1cE4SqJ.js";import{S as kt}from"./functions-_nuXFB4v.js";import{a as ia}from"./RadioGroup-DjJiUtpj.js";import{F as ut}from"./form-caption-DFg98poz.js";import{R as Ve}from"./rhf-autocomplete-on-enter-kdiwxQrI.js";import{U as na}from"./use-countdown-BXFyaDDS.js";import{T as Tt}from"./table-pagination-custom-D4L-eNU7.js";import{C as ra}from"./customer-form-DbQeUIrb.js";import{c as oa,C as la}from"./functions-BoFIsn5X.js";import{R as da}from"./rhf-autocomplete-checkboxes-BAgVzsEP.js";import{R as ca}from"./rhf-checkbox-DHrzNFCH.js";import{b as ua}from"./functions-DtJQT_hg.js";import{b as ma}from"./functions-_YXr4lzm.js";import{c as ha}from"./functions-BJ6gEtNd.js";import"./schemas-jjTqFOeL.js";import"./schemas-CENM9CnB.js";import"./divider-oAQn-qZp.js";import"./FormControlLabel-RF8C1zCS.js";import"./FormGroup-dr7_GDnD.js";import"./TablePagination-Cu0e8Dmj.js";import"./LastPage-CNSkhtZT.js";import"./rhf-date-picker-CcRSy6lj.js";import"./DatePicker-x3rEWLr9.js";import"./ListItem-ByRhTH_M.js";import"./MobileDateTimePicker-DRzd3izO.js";const yt=[{id:"product",name:"Order",icon:e.jsx(ze,{src:`${W.site.basePath}/assets/icons/navbar/ic-ecommerce.svg`,sx:{width:16,height:16}})},{id:"chart",name:"Chart",icon:e.jsx(ze,{src:`${W.site.basePath}/assets/icons/navbar/ic-order.svg`,sx:{width:16,height:16}})}];function pa({onChange:t}){const s=Lt(),{orderDetail:i}=V(),[a,n]=r.useState(yt[0].id);return e.jsx(Mt,{value:a,variant:"fullWidth",sx:{borderRadius:2},onChange:(u,d)=>{t(d),n(d)},slotProps:{indicator:{borderRadius:1.5,boxShadow:s.customShadows.z4},tab:{p:1}},children:yt.map(u=>e.jsx(bt,{value:u.id,label:e.jsxs(C,{sx:{display:"flex",alignItems:"center"},children:[u.icon,e.jsx(m,{variant:"subtitle2",sx:{color:"text.primary",ml:1.5},children:u.name}),u.id==="chart"&&e.jsx(Z,{variant:"soft",color:"info",ml:1.5,children:i?.items.length??0})]})},u.id))})}function xa({onChange:t}){const s=M(),[i,a]=r.useState("all"),[n,u]=r.useState([]),d=async()=>{s.onTrue(),await ws().then(c=>{c.length>0&&(t(c[0]),u(c),a(c[0].id))}).finally(()=>{s.onFalse()})};r.useEffect(()=>{d()},[]);const j=r.useCallback((c,l)=>{const p=n.find(f=>f.id===l);p&&(a(p.id),t(p))},[n,i]);return s.value?e.jsx(v,{spacing:2,direction:"row",sx:{px:0,py:1.2,boxShadow:c=>`inset 0 -2px 0 0 ${Ae(c.vars.palette.grey["500Channel"],.08)}`},children:Array.from({length:4}).map((c,l)=>e.jsx(se,{variant:"rectangular",sx:{width:100,height:30}},l))}):e.jsx($t,{value:i,onChange:j,sx:{boxShadow:c=>`inset 0 -2px 0 0 ${Ae(c.vars.palette.grey["500Channel"],.08)}`,[`& .${Wt.scrollButtons}`]:{"&.Mui-disabled":{opacity:.3}}},children:n.map(c=>e.jsx(bt,{value:c.id,label:c.name,iconPosition:"end",icon:e.jsx(Z,{variant:c.id===i&&"filled"||"soft",color:"default",children:c.products_count})},c.id))})}function fa({onEnter:t}){const[s,i]=r.useState(""),a=ie({resolver:ne(ls),defaultValues:os}),{watch:n,reset:u,handleSubmit:d}=a;r.useEffect(()=>{u({keyword:s})},[s]);const j=async l=>{t(l.keyword),i(l.keyword)},c=n();return r.useEffect(()=>{const l=setTimeout(()=>{c.keyword===""&&(t(""),i(""))},300);return()=>clearTimeout(l)},[c.keyword]),e.jsx(v,{children:e.jsx(re,{methods:a,onSubmit:d(j),children:e.jsx(z,{size:"medium",name:"keyword",tooltipTitle:"press enter",placeholder:"Search product...",InputProps:{startAdornment:e.jsx(Je,{position:"start",children:e.jsx(E,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})})}function ja({keywordFilter:t,categoryFilter:s}){const{openDialogFormOrderItem:i,passingProductInfoFormOrderItem:a}=V(),n=M(!0),[u,d]=r.useState([]),j=async(l,p)=>{n.onTrue(),await Ss({keyword:l,category_id:p.id!=="all"?p.id:""}).then(f=>{const D=f.map(h=>({...h,icon:h.icon}));d(D)}).finally(()=>{n.onFalse()})};r.useEffect(()=>{s&&j(t,s)},[t,s]);const c=l=>{i.onTrue(),a(l)};return e.jsx(o,{container:!0,spacing:3,children:n.value?Array.from({length:4}).map((l,p)=>e.jsx(o,{xs:3,children:e.jsx(se,{variant:"rounded",sx:{width:"100%",height:80}})},p)):u.map(l=>e.jsx(o,{xs:12,sm:4,md:3,children:e.jsxs(le,{sx:{p:2,height:"100%",display:"flex",cursor:"pointer","&:hover":{bgcolor:"action.hover"},border:p=>`solid 2px ${p.vars.palette.background.neutral}`},onClick:()=>c(l),children:[e.jsx(Pt,{icon_name:l.icon??"",sx:{width:48,height:48}}),e.jsxs(C,{sx:{ml:2},children:[e.jsx(m,{variant:"body2",sx:{color:"text.primary"},children:l.name}),e.jsx(m,{variant:"caption",sx:{color:"text.disabled"},children:`Rp ${$(l.price)}`})]})]})},l.id))})}function ga(){const[t,s]=r.useState(null),[i,a]=r.useState("");return e.jsxs(v,{spacing:3,children:[e.jsx(xa,{onChange:n=>s(n)}),e.jsx(fa,{onEnter:n=>a(n)}),e.jsx(ja,{categoryFilter:t,keywordFilter:i})]})}function mt({sx:t,showTotalItemPrice:s,showTotalItemDiscount:i,showTotalItemAddOnsPrice:a,showTotalVoucherDiscount:n,showDeliveryFee:u,showDeliveryFeeEditable:d,showTotalItemPriceFinal:j,showAmountPaid:c,showRedeemCoin:l,showRedeemCoinToggle:p,showBtnVoucherDiscount:f,showBtnCheckout:D}){const{orderDetail:h,orderDetailUpdate:x,orderDetailCalculateRefreshFlagUpdate:I,openDialogFormPayment:w}=V(),k=M(!1),b=M(!1),[R,g]=r.useState(0),[q,N]=r.useState(0),[P,B]=r.useState(0),[y,F]=r.useState(0);r.useEffect(()=>{const T=h.items.reduce((J,X)=>J+Number(X.quantity),0);g(T);const S=h.items.reduce((J,X)=>J+Number(X.quantity)*parseFloat(X.product.price??"0"),0);N(S);const ve=h.items.reduce((J,X)=>{const je=Number(X.quantity),ge=Number(X.product.price),U=Number(X.discount_value.replaceAll(",",""));return isNaN(U)||isNaN(ge)||isNaN(je)||je<=0?J:X.discount_type===te.absolute?J+U*je:X.discount_type===te.percentage?J+ge*U/100*je:J},0);B(ve);const be=h.items.reduce((J,X)=>{const je=X.arr_addons_obj?.reduce((ge,U)=>{let De=0;return U.price_type===te.absolute?De=Number(U.price):De=Number(X.product.price??"0")*Number(U.price)/100,ge+De},0)||0;return J+je*Number(X.quantity)},0);F(be)},[h]);const Y=(T,S)=>{x({...h,is_redeem_coin:S,available_redeem_coin:S?h.customer?.total_point??"0":"0"}),I()};return e.jsxs(e.Fragment,{children:[e.jsxs(v,{spacing:2,sx:{p:3,...t},children:[s&&e.jsx(he,{title:`Total Price (${R} Pcs)`,info:`Rp. ${$(q)}`}),i&&e.jsx(he,{title:"Total item discount",info:`Rp. -${$(P)}`}),a&&e.jsx(he,{title:"Add-ons Price",info:`Rp. ${$(y)}`}),n&&e.jsx(he,{title:"Voucher Discount",info:`Rp. ${$(h.voucher_amount??"0")}`}),u&&e.jsx(he,{title:"Delivery Fee",info:`Rp. ${h.delivery_fee??"0"}`}),d&&e.jsx(he,{title:"Delivery Fee",onClick:k.onTrue,info:`Rp. ${h.delivery_fee??"0"}`}),l&&e.jsx(he,{title:"Point Redeem",info:`Rp. -${h?.is_redeem_coin?$(Number(h?.available_redeem_coin??"0")):"0"}`}),j&&e.jsx(he,{title:"Total",info:`Rp. ${$(Number(h.amount_to_paid??"0"))}`,divider:!0,infoColor:"error.main",titleVarian:"subtitle1",infoVariant:"subtitle1",note:e.jsx(m,{variant:"caption",children:"(VAT included if applicable)"})}),c&&e.jsx(he,{title:"Total terbayarkan",info:`Rp. ${$(Number(h.amount_be_paid??"0"))}`,infoColor:"error.main",titleVarian:"subtitle1",infoVariant:"subtitle1",note:e.jsxs(m,{variant:"caption",children:["(Balance: ",e.jsx(C,{component:"span",color:"error.main",ml:.5,children:`-Rp. ${$(Number(h.amount_to_paid??"0")-Number(h?.amount_be_paid))}`}),")"]})}),p&&e.jsxs(C,{display:"flex",alignItems:"center",sx:{transform:`translateX(${W.switch.translateLeft})`},children:[e.jsx(Bt,{name:"is_redeem_coin",sx:{ml:0},onChange:Y}),e.jsxs(m,{variant:"body2",sx:{color:"text.disabled"},children:["Redeem Point (",$(Number(h.customer?.total_point??"0")),")"]}),e.jsx(E,{icon:"ri:coin-fill",sx:{color:"warning.light",ml:1.5}})]}),f&&e.jsxs(le,{onClick:b.onTrue,sx:{mb:2,p:1.5,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",border:T=>`dashed 4px ${T.vars.palette.background.neutral}`},children:[e.jsx(m,{variant:"body1",sx:{color:"text.disabled"},children:`Apply Voucher ${h.voucher.length===0?"":`(${h.voucher.map(T=>T.code).join(", ")})`}`}),e.jsx(xe,{children:e.jsx(E,{icon:"proicons:note",sx:{color:"text.disabled"}})})]}),D&&e.jsx(ae,{size:"large",variant:"contained",onClick:w.onTrue,disabled:h.items.length===0,children:"Checkout"})]}),e.jsx(ya,{open:k.value,onClose:k.onFalse}),e.jsx(va,{open:b.value,onClose:b.onFalse})]})}function he({info:t,title:s,divider:i,note:a,onClick:n,titleVarian:u="body2",infoColor:d="primary",infoVariant:j="subtitle2"}){return e.jsxs(e.Fragment,{children:[i&&e.jsx(et,{sx:{borderStyle:"dashed"}}),e.jsxs(C,{display:"flex",children:[e.jsx(m,{component:"span",onClick:n,variant:u,sx:{flexGrow:1,cursor:n?"pointer":"default",textDecoration:n?"underline":"none",color:n?"inherit":"text.secondary","&:hover":n?{color:"text.main"}:{}},children:s}),e.jsxs(C,{sx:{textAlign:"right"},children:[e.jsx(m,{component:"span",variant:j,sx:{display:"block",color:d},children:t}),a]})]})]})}function ya({open:t,onClose:s}){const{orderDetail:i,orderDetailUpdate:a,orderDetailCalculateRefreshFlagUpdate:n}=V(),u=ie({resolver:ne(cs),defaultValues:ds}),{reset:d,handleSubmit:j,formState:{isSubmitting:c,isDirty:l}}=u;r.useEffect(()=>{i&&d({delivery_fee:i.delivery_fee??"0"})},[i]);const p=D=>{s()},f=async D=>{a({...i,delivery_fee:D.delivery_fee.replace(/,/g,"")}),n(),p()};return e.jsx(fe,{open:t,fullWidth:!0,maxWidth:"sm",children:e.jsxs(re,{methods:u,onSubmit:j(f),children:[e.jsx(de,{children:"Delivery Fee"}),e.jsx(ce,{sx:{overflow:"visible"},children:e.jsx(C,{sx:{pt:1,overflowY:"auto",overflowX:"hidden"},children:e.jsx(o,{container:!0,spacing:3,children:e.jsx(o,{xs:12,children:e.jsx(z,{size:"medium",name:"delivery_fee",moneyFormat:!0,fullWidth:!0})})})})}),e.jsxs(ue,{children:[e.jsx(G,{onClick:s,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(ae,{size:"medium",type:"submit",disabled:!l,variant:"contained",loading:c,children:"Apply"})]})]})})}function va({open:t,onClose:s}){const{orderDetail:i,orderDetailUpdate:a,orderDetailCalculateRefreshFlagUpdate:n}=V(),u=M(!0),[d,j]=r.useState([]),[c,l]=r.useState([]),p=async()=>{u.onTrue(),await sa(i.customer?.id??"",i.id??"").then(g=>{j(g),l(g)}).finally(()=>{u.onFalse()})};r.useEffect(()=>{t&&p()},[t]);const f=ie({resolver:ne(ms),defaultValues:us}),{reset:D,watch:h,handleSubmit:x,formState:{isSubmitting:I,isDirty:w}}=f,k=h();r.useEffect(()=>{i&&D({search:"",arr_voucher_id:i.voucher.length>0?i.voucher.map(g=>g.id):[]})},[i]),r.useEffect(()=>{const g=setTimeout(()=>{d.length>0&&(k.search.trim()===""?l(d):l(d.filter(q=>q.code.toLowerCase().includes(k.search.toLowerCase())||q.name.toLowerCase().includes(k.search.toLowerCase()))))},300);return()=>clearTimeout(g)},[k.search,d]);const b=g=>{s()},R=async g=>{await Ds(i.customer?.id??"",i.id??"",g.arr_voucher_id).then(()=>{a({...i,voucher:d.filter(q=>g.arr_voucher_id.includes(q.id))}),n(),b()}).catch(()=>{})};return e.jsx(fe,{open:t,fullWidth:!0,maxWidth:"sm",children:e.jsxs(re,{methods:f,onSubmit:x(R),children:[e.jsx(de,{children:"Voucher"}),e.jsx(ce,{sx:{overflow:"visible"},children:e.jsx(C,{sx:{pt:1,overflowY:"auto",overflowX:"hidden",minHeight:W.dialog.content.minHeight,maxHeight:W.dialog.maxHeight},children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{xs:12,children:e.jsx(z,{size:"medium",name:"search",placeholder:"Search voucher...",InputProps:{startAdornment:e.jsx(Je,{position:"start",children:e.jsx(E,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})}),e.jsx(o,{xs:12,children:e.jsx(m,{variant:"subtitle2",color:"text.disabled",children:`Voucher Tersedia (${d.length})`})}),u.value?Array.from({length:2}).map((g,q)=>e.jsx(o,{xs:12,children:e.jsx(se,{variant:"rounded",sx:{width:"100%",height:60}})},q)):c.map(g=>e.jsx(o,{xs:12,sx:{px:1.6},children:e.jsx(ba,{voucher:g,selected:k.arr_voucher_id.includes(g.id),onClick:q=>{q.stopPropagation();const N=f.watch("arr_voucher_id"),P=N.includes(g.id)?N.filter(B=>B!==g.id):[...N,g.id];f.setValue("arr_voucher_id",P,{shouldDirty:!0})}})},g.id))]})})}),e.jsxs(ue,{children:[e.jsx(G,{onClick:s,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(ae,{size:"medium",type:"submit",disabled:!w,variant:"contained",loading:I,children:"Apply"})]})]})})}const ba=({selected:t,voucher:s,...i})=>e.jsxs(le,{variant:"outlined",sx:{p:2,cursor:"pointer",...t&&{boxShadow:a=>`0 0 0 1px ${a.vars.palette.success.main}`,bgcolor:a=>Ae(a.vars.palette.success.mainChannel,.08)}},...i,children:[e.jsx(m,{variant:"subtitle1",color:"success.main",children:s.code}),e.jsxs(m,{variant:"caption",color:"text.disabled",children:[e.jsx(C,{component:"span",children:`s.d. ${Ne(Number(s.end_at),tt.date)}`}),e.jsx("br",{}),s.name]})]});function _a(){const{orderDetailCalculateLoading:t}=V();return e.jsxs(K,{sx:{mb:3},children:[e.jsx(aa,{title:"Order Summary",action:t.value&&e.jsx(xe,{children:e.jsx(E,{icon:"line-md:loading-loop"})}),sx:{alignItems:"center"}}),e.jsx(mt,{showTotalItemPrice:!0,showTotalItemDiscount:!0,showTotalItemAddOnsPrice:!0,showTotalVoucherDiscount:!0,showDeliveryFeeEditable:!0,showTotalItemPriceFinal:!0,showBtnVoucherDiscount:!0,showBtnCheckout:!0})]})}function It({sx:t,tableHeads:s}){const{orderDetail:i}=V(),a=i.items;return e.jsx(C,{sx:{position:"relative",...t},children:e.jsx(st,{children:e.jsxs(ot,{size:"medium",sx:{minWidth:0},children:[e.jsx(Ca,{tableHeads:s}),e.jsx(wa,{tableHeads:s,rows:a})]})})})}function Ca({tableHeads:t}){return e.jsx(lt,{children:e.jsx(Se,{children:t.map(s=>e.jsx(H,{align:s.align||"left",sortDirection:!1,sx:{width:s.width,minWidth:0},children:s.label},s.id))})})}function wa({rows:t,tableHeads:s}){return e.jsx(dt,{children:t.length===0?e.jsx(ke,{colspan:s.length,text:"data not found"}):t.map((i,a)=>e.jsx(Sa,{row:i,tableHeads:s},a))})}function Sa({row:t,tableHeads:s}){const i=s.map(P=>P.id),a=M(),{checkAbilities:n}=at(),{showConfirmDialog:u}=_t(),{orderDetail:d,orderDetailCalculateRefreshFlagUpdate:j,orderDetailRemoveItem:c,openDialogFormOrderItem:l,passingProductInfoFormOrderItem:p,passingValueEditFormOrderItem:f,openDialogRevokeOrder:D,passingValueRevoke:h}=V(),{showSweetDialog:x}=we(),[I,w]=r.useState(0),[k,b]=r.useState(0),R=M(!1),g=M(!1),q=Ct("mobile-websocket-key");r.useEffect(()=>{d.order_status===ee.revoke&&R.onTrue(),t.status===Ut.revoke&&g.onTrue()},[d]),r.useEffect(()=>{if(t){const P=t.arr_addons_obj?.reduce((S,ve)=>{let be=0;return ve.price_type===te.absolute?be=Number(ve.price):be=Number(t.product.price??"0")*Number(ve.price)/100,S+be},0)||0;w(P);let B=0;const y=Number(t.quantity)||1,F=Number(t.product.price)||0,Y=Number(t.discount_value?.replace(/,/g,"")||0);t.discount_type===te.absolute?B=Y:t.discount_type===te.percentage&&(B=F*Y/100);const T=(F-B+P)*y;b(T)}},[t]);const N=async()=>{a.onTrue(),wt()?(await ks(t.item_id??""),a.onFalse()):await Dt({key:q,orderId:d.id}).then(P=>{x({title:"Order Print Receipt Success",icon:"success",description:P.message})}).catch(P=>console.error(P)).finally(async()=>{a.onFalse()})};return e.jsxs(Se,{sx:{bgcolor:g.value?"grey.300":""},children:[i.includes("product_info")&&e.jsxs(H,{sx:{whiteSpace:"nowrap",display:"flex",color:g.value?"text.disabled":""},children:[e.jsx(Pt,{icon_name:t.product.icon??"",sx:{width:64,height:64}}),e.jsxs(C,{sx:{ml:2},children:[e.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:t.product.name}),e.jsx(m,{variant:"body2",gutterBottom:!0,children:t.brand.name!==""?t.brand.name:"-"}),e.jsx(m,{variant:"body2",gutterBottom:!0,children:t.color.name!==""?t.color.name:"-"})]})]}),i.includes("price")&&e.jsx(H,{sx:{whiteSpace:"nowrap"},children:e.jsx(Ue,{type:"normal",disableDivider:!0,lowerTextProps:{variant:"caption",color:"text.disabled"},upperText:`Rp. ${$(t.product.price)}`,lowerText:t.discount_type===te.absolute?`Disc Rp.${$(Number(t.discount_value.replace(/,/g,"")))}`:`Disc ${$(Number(t.discount_value.replace(/,/g,"")))}%`})}),i.includes("color")&&e.jsx(H,{sx:{whiteSpace:"nowrap",color:g.value?"text.disabled":""},children:t.color.name!==""?Pe(t.color.name):"-"}),i.includes("remarks")&&e.jsx(H,{sx:{whiteSpace:"nowrap",color:g.value?"text.disabled":""},children:t.remarks.length>0?t.remarks.map(P=>`${Pe(P.name)}`).join(", "):"-"}),i.includes("add_ons")&&e.jsx(H,{sx:{whiteSpace:"wrap",color:g.value?"text.disabled":""},children:e.jsx(Ue,{type:"normal",disableDivider:!0,lowerTextProps:{variant:"caption",color:"text.disabled"},upperText:`Rp. ${$(I)}`,lowerText:t.arr_addons_obj.length>0?t.arr_addons_obj.map(P=>`${Pe(P.name)}`).join(", "):"-"})}),i.includes("notes")&&e.jsx(H,{sx:{whiteSpace:"nowrap",color:g.value?"text.disabled":""},children:t.notes!==""?t.notes:"-"}),i.includes("qty")&&e.jsx(H,{sx:{whiteSpace:"nowrap",color:g.value?"text.disabled":""},children:t.quantity}),i.includes("total_price")&&e.jsx(H,{sx:{whiteSpace:"nowrap",color:g.value?"text.disabled":""},children:e.jsx(Ue,{type:"normal",disableDivider:!0,lowerTextProps:{variant:"caption",color:"text.disabled"},upperText:`Rp. ${$(k)}`,lowerText:""})}),i.includes("action")&&e.jsx(H,{sx:{whiteSpace:"nowrap"},children:e.jsxs(C,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(xe,{onClick:P=>{P.stopPropagation(),p(t.product),f(t),l.onTrue()},children:e.jsx(E,{icon:"solar:pen-bold"})}),e.jsx(xe,{onClick:P=>{P.stopPropagation(),u({title:"Delete Item",description:"Anda yakin? Data akan dihapus permanent.",confirmBtnText:"Delete",onConfirm:async()=>{await Ps(t.item_id??"").then(()=>{c(t.item_id??""),j()}).catch(()=>{})}})},children:e.jsx(E,{icon:"solar:trash-bin-trash-bold"})})]})}),i.includes("marker")&&e.jsx(H,{sx:{whiteSpace:"nowrap",color:g.value?"text.disabled":""},children:e.jsx(ae,{size:"small",color:"inherit",variant:"outlined",loading:a.value,startIcon:e.jsx(E,{icon:"ion:receipt-outline"}),onClick:N,children:"Print"})}),i.includes("revoke")&&e.jsx(H,{sx:{whiteSpace:"nowrap"},children:n?.("order-detail:revoke")&&e.jsx(m,{variant:"body2",onClick:()=>{(!R.value||g.value)&&(h({order_id:d.id??"",item_id:t.item_id??""}),D.onTrue())},sx:{textAlign:"right",textDecoration:"underline",cursor:R.value||g.value?"not-allowed":"pointer",color:R.value||g.value?"text.disabled":"error.main"},children:"Revoke"})})]})}function Da(){const t=[{id:"product_info",label:"Product"},{id:"price",label:"Price"},{id:"add_ons",label:"Add Ons"},{id:"qty",label:"Quantity",width:"10"},{id:"total_price",label:"Total",width:"10"},{id:"action",label:"",width:"10"}];return e.jsx(K,{children:e.jsx(It,{tableHeads:t})})}function Ot({showPaymentPlan:t}){const s=it(_=>_.activeStore),{showSweetDialog:i}=we(),{openDialogFormPayment:a,openDialogPaymentWaiting:n,passingValueDialogPaymentWaiting:u,orderDetail:d,orderDetailReloadFlagUpdate:j,orderDetailUpdate:c,orderDetailUpdateRefreshFlagUpdate:l}=V(),[p,f]=r.useState(0),[D,h]=r.useState([]),[x,I]=r.useState(Ce),w=M(!1),k=M(!1),b=M(!1),R=M(!1),g=M(!1),q=()=>{kt(s?.id??"","").then(_=>{const O=_.data.find(L=>L.group_code===oe.cash);O&&I(L=>({...L,payment_method:{id:O.id,slug:{slug:O.slug,name:O.slug},group_code:O.group_code}})),h(_.data)}).finally(()=>{})},N=async()=>{await Fs(d.customer?.id??"").then(_=>{I(O=>({...O,max_deposit:String(_.balance)})),q()}).catch(()=>{})},P=async()=>{await Ts(d.customer?.id??"").then(_=>{I(O=>({...O,max_point:String(_.balance)})),N()}).catch(()=>{})};r.useEffect(()=>{a.value&&P()},[a.value]);const B=ie({resolver:ne(hs),defaultValues:Ce}),{control:y,reset:F,watch:Y,setValue:T,getValues:S,handleSubmit:ve,formState:{isSubmitting:be,isDirty:J,errors:X}}=B,je=me({control:y,name:"amount_receive"}),ge=me({control:y,name:"amount_paid"}),U=me({control:y,name:"payment_plan"}),De=me({control:y,name:"max_deposit"}),He=me({control:y,name:"use_deposit"}),Rt=me({control:y,name:"max_point"}),Te=me({control:y,name:"use_point"}),ht=me({control:y,name:"deposit"}),Le=me({control:y,name:"is_cash"});r.useEffect(()=>{if(a.value){const _={...Ce,amount_must_paid:String(Number(d.amount_to_paid??0)-Number(d.amount_be_paid??0)),amount_paid:t?String(d.amount_to_paid??0):"0",payment_plan:t?Ce.payment_plan:A.partial_payment,order_id:d.id??""};I(_)}},[a.value,t]),r.useEffect(()=>{F(x)},[x]),r.useEffect(()=>{S("use_deposit")||T("deposit","0",{shouldDirty:!0,shouldValidate:!0})},[He]),r.useEffect(()=>{Te&&!He&&Number(S("amount_paid"))===0?(b.onTrue(),T("use_deposit",!1),T("deposit","0")):Number(S("max_deposit"))>0&&b.onFalse()},[Te,ge]),r.useEffect(()=>{U!==A.partial_payment&&Number(S("amount_paid"))===0?(g.onTrue(),T("payment_method",Ce.payment_method)):g.onFalse(),U===A.partial_payment&&Number(S("amount_paid"))===0?(k.onTrue(),T("use_point",!1),f(0),b.onTrue(),T("use_deposit",!1),T("deposit","0")):(k.onFalse(),b.onFalse())},[U,ge]),r.useEffect(()=>{Number(S("max_deposit"))===0?b.onTrue():b.onFalse(),Number(S("max_point"))===0?k.onTrue():k.onFalse()},[De,Rt]);const At=_=>{_.group_code===oe.cash?T("is_cash",!0):T("is_cash",!1);let O=S("amount_paid");_.group_code===oe.cash&&(O="0"),T("amount_receive",O,{shouldDirty:!0,shouldValidate:!1})};r.useEffect(()=>{if(S("payment_plan")===A.partial_payment){const _=Number(S("amount_paid"));if(S("use_point")){const O=Number(S("max_point"));_-O>=0?f(O):f(_)}else f(0)}else if(S("payment_plan")===A.full_payment){const _=Number(S("amount_must_paid"));let O=Number(S("amount_must_paid"));if(S("use_point")){const L=Number(S("max_point"));O-=L,O>=0?f(L):(O=0,f(_))}else f(0);if(O>0&&S("use_deposit")){const L=Number(S("max_deposit")),ye=Number(S("deposit"));ye>L?(T("deposit",L.toString(),{shouldDirty:!0,shouldValidate:!0}),O-=L):O<ye?(T("deposit",O.toString(),{shouldDirty:!0,shouldValidate:!0}),O=0):O-=Number(S("deposit"))}T("amount_paid",O.toString(),{shouldDirty:!0,shouldValidate:!0})}},[Te,ht]),r.useEffect(()=>{S("payment_plan")===A.full_payment?(w.onFalse(),T("payment_plan",A.full_payment)):S("payment_plan")===A.partial_payment?(w.onFalse(),T("amount_paid","0"),T("payment_plan",A.partial_payment)):S("payment_plan")===A.pay_on_delivery&&(w.onTrue(),T("is_cash",!1),T("payment_plan",A.pay_on_delivery),T("payment_method",Ce.payment_method))},[U]),r.useEffect(()=>{const _=Number(S("amount_paid"));if(!S("is_cash"))T("amount_change","0");else{const O=Number(S("deposit")??"0"),L=S("use_point")?p:0,ye=Number(S("amount_receive")),Ht=U===A.partial_payment?O+L+ye-_:ye-_;T("amount_change",Ht.toString())}},[Le,ht,Te,He,p,ge,U,je]);const Me=()=>{a.onFalse()},Et=async _=>{_.payment_method?.message&&qe.warning(_.payment_method?.message,{position:"top-center"})},Vt=_=>{R.onFalse(),T("payment_method",{id:_.id,slug:{slug:_.slug,name:_.name},group_code:_.group_code},{shouldDirty:!0,shouldValidate:!0}),At(_)},Nt=async _=>{const O=Is(_);_.payment_method.id===""&&(O.store_payment_method_id=x.payment_method.id,_.is_cash=!0),t&&_.payment_plan===A.pay_on_delivery?(Me(),c({...d,order_status:d.order_status===ee.draft?ee.final:d.order_status,payment_plan:_.payment_plan}),l()):await Os(O).then(L=>{Me(),c({...d,payment_plan:_.payment_plan,order_status:d.order_status===ee.draft?ee.final:d.order_status}),l(),_.is_cash||_.payment_method.group_code===oe.bank_transfer?(i({icon:"success",title:"Payment success",description:"Payment successfully completed"}),j()):(n.onTrue(),u({payment_id:L.currentPayment.id,status:L.currentPayment.status,amount:L.currentPayment.amount,qris_url:L.currentPayment.qris_url,va_number:L.currentPayment.va_number,expired_at:L.currentPayment.expired_at,store_payment_method_id:L.currentPayment.store_payment_method_id}))}).catch(L=>{L instanceof ct&&Object.keys(L.validationErrors).forEach(ye=>{B.setError(ye,{type:"manual",message:L.validationErrors[ye][0]})})})};return e.jsxs(fe,{open:a.value,fullWidth:!0,maxWidth:"md",children:[e.jsxs(re,{methods:B,onSubmit:ve(Nt,Et),children:[e.jsx(de,{children:"Payment"}),e.jsx(ce,{sx:{overflow:"visible"},children:e.jsxs(v,{spacing:3,sx:{overflowY:"auto",overflowX:"hidden",maxHeight:W.dialog.maxHeight},children:[e.jsxs(K,{variant:"outlined",sx:{p:2,overflow:"visible"},children:[e.jsx(m,{variant:"body2",gutterBottom:!0,sx:{color:"text.default"},children:"Bill Amount"}),e.jsx(m,{variant:"body1",sx:{color:"error.main"},children:`Rp. ${$(S("amount_must_paid"))}`})]}),t&&e.jsx(K,{variant:"outlined",sx:{p:2,overflow:"visible"},children:e.jsxs(v,{spacing:1,children:[e.jsx(m,{variant:"body2",sx:{color:"text.default"},children:"Payment Plan"}),e.jsx(Ee,{row:!0,label:"",name:"payment_plan",sx:{px:.2},options:[{label:Fe(A.full_payment),value:A.full_payment},{label:Fe(A.partial_payment),value:A.partial_payment},{label:Fe(A.pay_on_delivery),value:A.pay_on_delivery}]})]})}),e.jsx(K,{variant:"outlined",sx:{p:2,overflow:"visible",display:U===A.partial_payment?"":"none"},children:e.jsx(z,{fullWidth:!0,moneyFormat:!0,hideCurrency:!0,size:"medium",name:"amount_paid",label:"Amount to be paid",inputProps:{inputMode:"numeric"},disabled:B.watch("payment_plan")===A.full_payment||w.value})}),e.jsx(K,{variant:"outlined",sx:{p:2,overflow:"visible",bgcolor:w.value||k.value?"grey.100":""},children:e.jsxs(v,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(Xe,{disabled:w.value||k.value,name:"use_point",sx:{mr:0},label:"Point"}),e.jsxs(C,{sx:{textAlign:"right"},children:[e.jsx(m,{variant:"body2",sx:{color:w.value||k.value?"text.disabled":"text.default"},children:`(Rp. ${$(Y("max_point")??"0")})`}),p>0&&e.jsx(m,{variant:"caption",sx:{color:"text.disabled"},children:`- ${$(p.toString())}`})]})]})}),e.jsx(K,{variant:"outlined",sx:{p:2,overflow:"visible",bgcolor:w.value||b.value?"grey.100":""},children:e.jsxs(v,{spacing:2,children:[e.jsxs(v,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(Xe,{disabled:w.value||b.value,name:"use_deposit",sx:{mr:0},label:"Deposit"}),e.jsx(m,{variant:"body2",sx:{color:w.value||b.value?"text.disabled":"text.default"},children:`(Rp. ${$(Y("max_deposit")??"0")})`})]}),B.watch("use_deposit")&&e.jsx(z,{fullWidth:!0,moneyFormat:!0,hideCurrency:!0,size:"medium",name:"deposit",label:"",disabled:w.value,inputProps:{inputMode:"numeric"}})]})}),e.jsx(K,{variant:"outlined",onClick:()=>{!w.value&&!g.value&&R.onTrue()},sx:{p:2,overflow:"visible",bgcolor:w.value||g.value?"grey.100":""},children:e.jsxs(v,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(v,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(E,{icon:"fluent:payment-28-regular",sx:{color:w.value||g.value?"text.disabled":"text.default"}}),e.jsxs(C,{children:[e.jsx(m,{variant:"body2",sx:{color:w.value||g.value?"text.disabled":"text.default"},children:"Payment Method"}),e.jsx(m,{variant:"subtitle1",sx:{color:"text.default"},children:S("payment_method").slug.name})]})]}),e.jsx(xe,{disabled:w.value||g.value,children:e.jsx(E,{icon:"oui:arrow-right",sx:{color:"text.disabled"}})})]})}),e.jsx(K,{variant:"outlined",sx:{p:2,overflow:"visible",bgcolor:w.value?"grey.100":""},children:e.jsx(v,{spacing:4,children:e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{xs:12,sm:Le?4:12,display:U==A.partial_payment?"none":"",children:e.jsx(z,{fullWidth:!0,moneyFormat:!0,hideCurrency:!0,size:"medium",name:"amount_paid",label:"Amount to be paid",inputProps:{inputMode:"numeric"},disabled:B.watch("payment_plan")===A.full_payment||w.value})}),Le&&e.jsxs(e.Fragment,{children:[e.jsx(o,{xs:12,sm:U==A.partial_payment?6:4,children:e.jsx(z,{fullWidth:!0,moneyFormat:!0,hideCurrency:!0,size:"medium",name:"amount_receive",label:"Amount Received",inputProps:{inputMode:"numeric"},disabled:w.value})}),e.jsx(o,{xs:12,sm:U==A.partial_payment?6:4,children:e.jsx(z,{disabled:!0,fullWidth:!0,hideCurrency:!0,moneyFormat:!0,size:"medium",name:"amount_change",label:"Amount to change"})})]})]})})})]})}),e.jsxs(ue,{children:[e.jsx(G,{onClick:Me,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(ae,{size:"medium",type:"submit",disabled:!J,variant:"contained",loading:be,children:"Process"})]})]}),e.jsx(Pa,{paymentMethods:D,open:R.value,selectedData:Y("payment_method"),onClose:R.onFalse,onSelect:_=>Vt(_)})]})}function Pa({open:t,onClose:s,selectedData:i,onSelect:a,paymentMethods:n}){return e.jsxs(fe,{open:t,fullWidth:!0,maxWidth:"sm",children:[e.jsx(de,{children:"Payment Method"}),e.jsx(ce,{sx:{overflow:"visible"},children:e.jsx(v,{spacing:3,sx:{overflowY:"auto",overflowX:"hidden",maxHeight:W.dialog.maxHeight},children:Object.values(oe).map((u,d)=>e.jsx(ka,{group_code:u,selectedData:i,onSelect:a,paymentMethods:n},d))})}),e.jsx(ue,{children:e.jsx(G,{onClick:s,variant:"outlined",color:"inherit",children:"Cancel"})})]})}const ka=({group_code:t,onSelect:s,selectedData:i,paymentMethods:a})=>{const n=M(!1),u=M(!1),[d,j]=r.useState([]);r.useEffect(()=>{const l=a.filter(p=>p.group_code===t);j(l)},[t]);const c=l=>{const p=d.find(f=>f.id===l);p&&s(p)};return e.jsx(K,{variant:"outlined",sx:{p:2,overflow:"visible",display:d.length===0?"none":""},children:t===oe.cash||t===oe.qris?e.jsx(vt,{loading:n.value,payment_methods:d,handleChange:c,selectedData:i}):e.jsxs(e.Fragment,{children:[e.jsxs(v,{direction:"row",alignItems:"center",justifyContent:"space-between",onClick:u.onToggle,children:[e.jsx(m,{variant:"subtitle2",color:"text.primary",children:Pe(zt(t))}),e.jsx(xe,{children:e.jsx(E,{icon:"oui:arrow-down",sx:{color:"text.disabled"}})})]}),e.jsx(nt,{in:u.value,timeout:"auto",unmountOnExit:!0,children:e.jsx(vt,{loading:n.value,payment_methods:d,handleChange:c,selectedData:i})})]})})};function vt({loading:t,payment_methods:s,handleChange:i,selectedData:a}){return t?Array.from({length:2}).map((n,u)=>e.jsx(o,{xs:12,children:e.jsx(se,{variant:"rounded",sx:{width:"100%",height:40}})},u)):s.map((n,u)=>e.jsxs(le,{variant:"outlined",sx:{p:1,mt:s.length>1?2:0,display:"flex",alignItems:"center"},onClick:()=>i(n.id),children:[e.jsx(ia,{sx:{mr:1},value:n.id,checked:a?.id===n.id}),e.jsx(m,{variant:"subtitle1",children:n.name})]},u))}function Ta(){return e.jsxs(v,{spacing:3,children:[e.jsx(Ia,{}),e.jsx(Oa,{})]})}function Ia(){const{orderDetail:t,orderDetailUpdate:s,orderDetailUpdateRefreshFlagUpdate:i}=V(),a=ie({resolver:ne(ps),defaultValues:$e}),{reset:n,handleSubmit:u,formState:{isSubmitting:d,isDirty:j}}=a,c=a.watch("type_pickup"),l=a.watch("type_shipping");return r.useEffect(()=>{t&&n({type_pickup:t.type_pickup??$e.type_pickup,type_shipping:t.type_shipping??$e.type_shipping})},[t]),r.useEffect(()=>{j&&t&&(s({...t,type_pickup:c,type_shipping:l}),i())},[c,l,j,t,s]),e.jsx(re,{methods:a,children:e.jsxs(o,{container:!0,children:[e.jsxs(o,{xs:6,children:[e.jsxs(m,{gutterBottom:!0,variant:"subtitle2",color:"text.primary",children:["Type Pick Up",e.jsx(C,{component:"span",color:"error.main",children:"*"})]}),e.jsx(Ee,{row:!0,name:"type_pickup",sx:{px:1.5},options:[{label:Ge(pe.walkin),value:pe.walkin},{label:Ge(pe.in_customer),value:pe.in_customer}]})]}),e.jsxs(o,{xs:6,children:[e.jsxs(m,{gutterBottom:!0,variant:"subtitle2",color:"text.primary",children:["Type Shipping",e.jsx(C,{component:"span",color:"error.main",children:"*"})]}),e.jsx(Ee,{row:!0,name:"type_shipping",sx:{px:1.5},options:[{label:Ye(_e.delivery),value:_e.delivery},{label:Ye(_e.in_store),value:_e.in_store}]})]})]})})}function Oa(){const t=M(!1);return e.jsx(le,{sx:{p:2,border:s=>`solid 2px ${s.vars.palette.background.neutral}`},children:e.jsxs(v,{spacing:3,children:[e.jsxs(C,{onClick:t.onToggle,sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(m,{variant:"subtitle2",color:"text.primary",children:"Address Detail"}),e.jsx(xe,{children:e.jsx(E,{icon:"oui:arrow-down",sx:{color:"text.disabled"}})})]}),e.jsx(nt,{in:t.value,timeout:"auto",unmountOnExit:!0,children:e.jsx(Fa,{})})]})})}function Fa(){const{orderDetail:t,orderDetailUpdate:s,openDialogChartCheckoutAddress:i,passingDialogChartCheckoutAddressPurpose:a}=V(),n=it(c=>c.activeStore),[u,d]=r.useState(null);r.useEffect(()=>{n&&n.address&&d(n.address)},[n]),r.useEffect(()=>{t.customer&&s({...t,pickup_address:t.pickup_address?t.pickup_address:t.customer.address,shipping_address:t.shipping_address?t.shipping_address:t.customer.address})},[t.customer]);const j=c=>{i.onTrue(),a(c)};return e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{xs:12,md:6,children:e.jsx(le,{sx:{p:2,height:"100%",border:c=>`dashed 2px ${c.vars.palette.background.neutral}`},children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{xs:12,children:e.jsxs(v,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(Z,{variant:"soft",color:"primary",children:"Pickup"}),e.jsx(xe,{onClick:c=>{c.stopPropagation(),j("pickup")},disabled:t?.type_pickup!==pe.in_customer,children:e.jsx(E,{icon:"solar:pen-bold"})})]})}),e.jsx(o,{xs:12,children:e.jsxs(v,{spacing:1,sx:{typography:"body2"},children:[e.jsxs(v,{direction:"row",children:[e.jsx(C,{component:"span",sx:{color:"text.secondary",width:70,flexShrink:0},children:e.jsx(m,{variant:"subtitle2",color:"text.disabled",children:"Name"})}),e.jsx(m,{variant:"body2",color:"text.primary",children:t?.type_pickup===pe.in_customer?t?.pickup_address?.receiver_name:u?.name})]}),e.jsxs(v,{direction:"row",children:[e.jsx(C,{component:"span",sx:{color:"text.secondary",width:70,flexShrink:0},children:e.jsx(m,{variant:"subtitle2",color:"text.disabled",children:"Address"})}),e.jsx(m,{variant:"body2",color:"text.primary",children:t?.type_pickup===pe.in_customer?t?.pickup_address?.text:u?.text})]}),e.jsxs(v,{direction:"row",children:[e.jsx(C,{component:"span",sx:{color:"text.secondary",width:70,flexShrink:0},children:e.jsx(m,{variant:"subtitle2",color:"text.disabled",children:"Phone"})}),e.jsx(m,{variant:"body2",color:"text.primary",children:t?.type_pickup===pe.in_customer?t?.pickup_address?.receiver_phone:"-"})]})]})})]})})}),e.jsx(o,{xs:12,md:6,children:e.jsx(le,{sx:{p:2,height:"100%",border:c=>`dashed 2px ${c.vars.palette.background.neutral}`},children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{xs:12,children:e.jsxs(v,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(Z,{variant:"soft",color:"primary",children:"Shipping"}),e.jsx(xe,{onClick:c=>{c.stopPropagation(),j("shipping")},disabled:t?.type_pickup!==pe.in_customer,children:e.jsx(E,{icon:"solar:pen-bold"})})]})}),e.jsx(o,{xs:12,children:e.jsxs(v,{spacing:1,sx:{typography:"body2"},children:[e.jsxs(v,{direction:"row",children:[e.jsx(C,{component:"span",sx:{color:"text.secondary",width:70,flexShrink:0},children:e.jsx(m,{variant:"subtitle2",color:"text.disabled",children:"Name"})}),e.jsx(m,{variant:"body2",color:"text.primary",children:t?.type_shipping===_e.delivery?t?.shipping_address?.receiver_name:u?.name})]}),e.jsxs(v,{direction:"row",children:[e.jsx(C,{component:"span",sx:{color:"text.secondary",width:70,flexShrink:0},children:e.jsx(m,{variant:"subtitle2",color:"text.disabled",children:"Address"})}),e.jsx(m,{variant:"body2",color:"text.primary",children:t?.type_shipping===_e.delivery?t?.shipping_address?.text:u?.text})]}),e.jsxs(v,{direction:"row",children:[e.jsx(C,{component:"span",sx:{color:"text.secondary",width:70,flexShrink:0},children:e.jsx(m,{variant:"subtitle2",color:"text.disabled",children:"Phone"})}),e.jsx(m,{variant:"body2",color:"text.primary",children:t?.type_shipping===_e.delivery?t?.shipping_address?.receiver_phone:"-"})]})]})})]})})})]})}function Ra(){const{openDialogChartCheckoutAddress:t,openDialogChartCheckoutAddressForm:s}=V();return e.jsx(fe,{open:t.value,fullWidth:!0,maxWidth:"sm",children:s.value===!1?e.jsx(Aa,{}):e.jsx(Va,{})})}function Aa(){const{orderDetail:t,orderDetailUpdate:s,orderDetailUpdateRefreshFlagUpdate:i,openDialogChartCheckoutAddress:a,openDialogChartCheckoutAddressForm:n,valueDialogChartCheckoutAddressPurpose:u}=V(),d=M(!0),[j,c]=r.useState([]),[l,p]=r.useState([]),f=async()=>{d.onTrue(),await Rs(t.customer?.address?.addressable_id??"").then(N=>{c(N),p(N)}).finally(()=>{d.onFalse()})};r.useEffect(()=>{a.value&&f()},[a.value]);const D=ie({resolver:ne(xs),defaultValues:We}),{watch:h,setValue:x,reset:I,handleSubmit:w,formState:{isDirty:k,isSubmitting:b}}=D,R=h();r.useEffect(()=>{const N=setTimeout(()=>{j.length>0&&(R.search.trim()===""?p(j):p(j.filter(P=>P.text.toLowerCase().includes(R.search.toLowerCase())||P.name.toLowerCase().includes(R.search.toLowerCase())||P.receiver_name?.toLowerCase().includes(R.search.toLowerCase())||P.receiver_phone?.includes(R.search))))},300);return()=>clearTimeout(N)},[R.search,j]),r.useEffect(()=>{a.value&&I({...We,address_id:u==="shipping"?t.shipping_address?.id:t.pickup_address?.id,order_code:t.order_no??""})},[a.value]);const g=()=>{I(We),p(j),a.onFalse()},q=N=>{const P=j.find(B=>B.id===N.address_id);P&&t&&(s(u==="shipping"?{...t,shipping_address:P}:{...t,pickup_address:P}),i()),g()};return e.jsxs(re,{methods:D,onSubmit:w(q),children:[e.jsx(de,{children:"Customer Address"}),e.jsx(ce,{sx:{overflow:"visible"},children:e.jsx(C,{sx:{pt:1,overflowY:"auto",overflowX:"hidden",maxHeight:W.dialog.maxHeight},children:e.jsx(C,{minHeight:W.dialog.content.minHeight,children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{xs:12,md:9,children:e.jsx(z,{size:"medium",name:"search",placeholder:"Search address...",InputProps:{startAdornment:e.jsx(Je,{position:"start",children:e.jsx(E,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})}),e.jsx(o,{xs:12,md:3,children:e.jsx(G,{fullWidth:!0,variant:"contained",sx:{height:"100%"},startIcon:e.jsx(E,{icon:"mingcute:add-line"}),onClick:n.onTrue,children:"Address"})}),e.jsx(o,{xs:12,children:e.jsx(ut,{caption:"Caption text, description, notification"})}),d.value?Array.from({length:2}).map((N,P)=>e.jsx(o,{xs:12,children:e.jsx(se,{variant:"rounded",sx:{width:"100%",height:100}})},P)):l.map(N=>e.jsx(o,{xs:12,sx:{px:1.6},children:e.jsx(Ea,{address:N,selected:D.watch("address_id")===N.id,onClick:()=>x("address_id",N.id,{shouldDirty:!0})})},N.id))]})})})}),e.jsxs(ue,{children:[e.jsx(G,{onClick:g,variant:"outlined",color:"inherit",children:"Close"}),e.jsx(ae,{size:"medium",type:"submit",disabled:!k,variant:"contained",loading:b,children:"Apply"})]})]})}const Ea=({selected:t,address:s,...i})=>{const{openDialogChartCheckoutAddressForm:a,passingDialogChartCheckoutAddressFormEdit:n}=V(),u=d=>{a.onTrue(),n(d)};return e.jsx(le,{variant:"outlined",sx:{p:2.5,cursor:"pointer",...t&&{boxShadow:d=>`0 0 0 1px ${d.vars.palette.primary.main}`,bgcolor:d=>Ae(d.vars.palette.primary.mainChannel,.08)}},...i,children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsxs(o,{xs:10,children:[e.jsx(m,{gutterBottom:!0,variant:"body2",color:"text.disabled",children:s.name}),e.jsx(m,{gutterBottom:!0,variant:"h6",color:"text.primary",children:s.receiver_name}),e.jsxs(v,{direction:"row",alignItems:"center",spacing:1,mb:1,children:[e.jsx(E,{icon:"mdi:telephone",sx:{color:"primary.main"}}),e.jsx(m,{variant:"h6",color:"text.primary",children:s.receiver_phone})]}),e.jsxs(v,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(E,{icon:"mdi:address-marker",sx:{color:"primary.main"}}),e.jsx(m,{variant:"h6",color:"text.primary",children:s.text})]})]}),e.jsx(o,{xs:2,display:"flex",flexDirection:"column",alignItems:"flex-end",children:e.jsx(E,{icon:t?"eva:checkmark-circle-2-fill":"eva:radio-button-off-fill",width:24,sx:{color:t?"primary.main":"text.secondary"}})}),e.jsx(o,{xs:12,display:"flex",flexDirection:"column",alignItems:"flex-end",children:e.jsx(G,{onClick:()=>u(s),variant:"outlined",children:"Edit Address"})})]})},s.id)};function Va(){const{showSweetDialog:t}=we(),{orderDetail:s,openDialogChartCheckoutAddressForm:i,valueDialogChartCheckoutAddressFormEdit:a,passingDialogChartCheckoutAddressFormEdit:n}=V(),u=ie({resolver:ne(fs),defaultValues:Be}),{watch:d,setValue:j,reset:c,handleSubmit:l,formState:{isDirty:p,isSubmitting:f}}=u;r.useEffect(()=>{i.value&&s.customer&&c(a?{address_id:a.id,person_id:s.customer?.address?.addressable_id,receive_name:a.receiver_name??"",receive_phone:a.receiver_phone??"",address_text:a.text??"",address_description:a.description??"",address_kode_pos:a.kode_pos??"0",address_name:a.name??"",wilayah:{kecamatan_id:String(a.kecamatan_id)??"",kelurahan_id:String(a.kelurahan_id)??"",full_name:a.full_name??""}}:{...Be,person_id:s.customer?.address?.addressable_id})},[i.value,a,s.customer]);const D=()=>{c(Be),n(null),i.onFalse()},h=async x=>{const I=As(x);await Es(I).then(()=>{t({icon:"success",title:"Data saved successfully",description:"Saved successfully"}),D()}).catch(w=>{w instanceof ct&&Object.keys(w.validationErrors).forEach(k=>{u.setError(k,{type:"manual",message:w.validationErrors[k][0]})})})};return e.jsxs(re,{methods:u,onSubmit:l(h),children:[e.jsx(de,{children:"Form Address"}),e.jsx(ce,{sx:{overflow:"visible"},children:e.jsx(C,{sx:{pt:1,overflowY:"auto",overflowX:"hidden",maxHeight:W.dialog.maxHeight},children:e.jsx(C,{minHeight:W.dialog.content.minHeight,children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{xs:12,md:6,children:e.jsx(z,{name:"receive_name",label:"Receive Name",size:"medium"})}),e.jsx(o,{xs:12,md:6,children:e.jsx(z,{name:"receive_phone",label:"Receive Phone",size:"medium"})}),e.jsx(o,{xs:12,children:e.jsx(Ve,{name:"wilayah",label:"Address",sx:{"& .MuiAutocomplete-popupIndicator":{transform:"none"}},getOptionLabel:x=>x?.full_name,popupIcon:e.jsx(E,{icon:"eva:search-fill",sx:{color:"text.disabled"}}),fetchFunction:async x=>await qt({keyword:x}),isOptionEqualToValue:(x,I)=>x?.kelurahan_id===I?.kelurahan_id,filterOptions:(x,I)=>{const w=I.inputValue.toLowerCase().trim().replace(/,/g,"").split(/\s+/);return x.filter(k=>{const b=k.full_name.toLowerCase().replace(/,/g,"");return w.every(R=>new RegExp(`\\b${R}`,"i").test(b))})}})}),e.jsx(o,{xs:12,children:e.jsx(z,{name:"address_text",label:"Address Full",size:"medium"})}),e.jsx(o,{xs:12,children:e.jsx(z,{name:"address_description",label:"Address Description",size:"medium"})}),e.jsx(o,{xs:12,children:e.jsx(z,{name:"address_kode_pos",label:"Address Postal Code",size:"medium"})}),e.jsx(o,{xs:12,children:e.jsx(z,{name:"address_name",label:"Address Name",size:"medium"})}),e.jsx(o,{xs:12,children:e.jsx(ut,{caption:"Warna rumah, patokan, pesan khusus, dll"})})]})})})}),e.jsxs(ue,{children:[e.jsx(G,{onClick:D,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(ae,{size:"medium",type:"submit",disabled:!p,variant:"contained",loading:f,children:"Save"})]})]})}function Ft(){const t=it(b=>b.activeStore),{showSweetDialog:s}=we(),{openDialogPaymentWaiting:i,valueDialogPaymentWaiting:a,passingValueDialogPaymentWaiting:n,orderDetailReloadFlagUpdate:u}=V(),d=M(!0),[j,c]=r.useState(null),[l,p]=r.useState(W.site.intervalCheckPayment),{countdownObj:f,setCountdown:D,startCountdown:h,stopCountDown:x}=na(0),I=async()=>{d.onTrue(),await kt(t?.id??"","").then(b=>{const R=b.data.find(g=>g.id===a?.store_payment_method_id);R&&c(R)}).finally(()=>{d.onFalse()})};r.useEffect(()=>{if(i.value&&a){const b=a.expired_at-Math.floor(Date.now()/1e3);D(Math.max(0,b)),h(),I()}},[i.value,a,t]);const w=async()=>{await Yt(a?.payment_id??"").then(b=>{a&&b.status===Q.success&&(n({...a,status:b.status}),s({icon:"success",title:"Payment success",description:"Payment successfully completed"}),x(),k())}).finally(()=>{})};r.useEffect(()=>{a?.status===Q.pending&&(p(l-1),l===0&&(p(W.site.intervalCheckPayment),w()))},[a,f.seconds]);const k=()=>{i.onFalse(),u()};return e.jsxs(fe,{open:i.value,fullWidth:!0,maxWidth:"md",children:[e.jsx(de,{children:"Payment"}),e.jsx(ce,{sx:{overflow:"visible"},children:e.jsx(C,{sx:{overflowY:"auto",overflowX:"hidden",maxHeight:W.dialog.maxHeight},children:e.jsx(v,{spacing:3,children:d.value?e.jsxs(e.Fragment,{children:[e.jsx(se,{variant:"rounded",sx:{width:"100%",height:100}}),e.jsx(se,{variant:"rounded",sx:{width:"100%",height:200}})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{sx:{p:3},children:e.jsxs(v,{justifyContent:"space-between",alignItems:"start",direction:"row",children:[e.jsxs(C,{children:[e.jsx(Z,{variant:"soft",sx:{mb:2},color:a?.status===Q.success&&"success"||a?.status===Q.pending&&"warning"||a?.status===Q.expired&&"error"||a?.status===Q.cancel&&"default"||a?.status===Q.cancel&&"error"||"default",children:a?.status??"-"}),e.jsx(m,{variant:"body2",gutterBottom:!0,sx:{color:"text.secondary"},children:"Batas Akhir Pembayaran"}),e.jsx(m,{variant:"subtitle1",children:Ne(a?.expired_at,tt.dateTime)})]}),a?.status===Q.pending&&e.jsxs(Z,{variant:"soft",color:a?.status===Q.pending?"error":"info",children:[e.jsx(ze,{sx:{width:14.67,height:14.67,mr:.5},src:`${W.site.basePath}/assets/icons/common/ic-loading-one.svg`}),`${Number(f.days)*24+Number(f.hours)}:${f.minutes}:${f.seconds}`]})]})}),e.jsx(K,{sx:{p:3},children:e.jsxs(v,{spacing:3,children:[e.jsx(v,{justifyContent:"space-between",alignItems:"center",direction:"row",children:e.jsx(m,{variant:"subtitle1",children:j?.name})}),j?.group_code===oe.va&&e.jsxs(C,{children:[e.jsx(m,{variant:"body2",gutterBottom:!0,sx:{color:"text.secondary"},children:"Nomor Virtual Account"}),e.jsx(m,{variant:"subtitle1",children:a?.va_number})]}),e.jsx(et,{sx:{borderStyle:"dashed",bgcolor:"grey.200"}}),e.jsxs(v,{spacing:2,direction:"row",children:[j?.group_code===oe.qris&&e.jsx(C,{width:"40%",children:e.jsx(Gt,{width:"100%",src:a?.qris_url??`${W.site.basePath}/assets/images/qrcode.png`})}),e.jsxs(C,{flex:1,children:[e.jsx(m,{variant:"subtitle1",mb:2,children:"Total Pembayaran"}),e.jsx(mt,{sx:{p:0},showTotalItemPrice:!0,showTotalItemDiscount:!0,showTotalItemAddOnsPrice:!0,showTotalVoucherDiscount:!0,showDeliveryFee:!0,showRedeemCoin:!0})]})]}),j?.group_name===oe.bank_transfer&&e.jsxs(v,{spacing:2,direction:"row",children:[e.jsx(G,{fullWidth:!0,size:"medium",variant:"contained",startIcon:e.jsx(E,{icon:"ic:baseline-whatsapp"}),children:"Share Via Whatsapp"}),e.jsx(G,{fullWidth:!0,size:"medium",variant:"contained",startIcon:e.jsx(E,{icon:"ic:baseline-qrcode"}),children:"Show Bracode"})]})]})})]})})})}),e.jsx(ue,{children:e.jsx(G,{onClick:k,variant:"outlined",color:"inherit",children:"Close"})})]})}function Na(){return e.jsxs(e.Fragment,{children:[e.jsxs(v,{spacing:3,children:[e.jsx(Ta,{}),e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{xs:12,md:7,children:e.jsx(Da,{})}),e.jsx(o,{xs:12,md:5,children:e.jsx(_a,{})})]})]}),e.jsx(Ft,{}),e.jsx(Ra,{}),e.jsx(Ot,{showPaymentPlan:!0})]})}function Ha(){const{showConfirmDialog:t}=_t(),{orderDetail:s,orderDetailUpdate:i}=V(),a=M();return e.jsxs(e.Fragment,{children:[e.jsx(le,{sx:{p:2,border:n=>`dashed 2px ${n.vars.palette.background.neutral}`},children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{xs:8,md:10,children:e.jsx(C,{children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{xs:12,sm:6,md:3,children:e.jsx(Oe,{title:"Order",info:s.order_no??"new",labelColor:"warning",labelInfo:s.order_status??"draft"})}),e.jsx(o,{xs:12,sm:6,md:3,children:e.jsx(Oe,{title:"Name",info:s.customer?.name??"",labelColor:"success",labelInfo:s.customer?.level?.name??"priority"})}),e.jsx(o,{xs:12,sm:6,md:3,children:e.jsx(Oe,{title:"Phone",info:s.customer?.phone??""})}),e.jsx(o,{xs:12,sm:6,md:3,children:e.jsx(Oe,{title:"Address",info:s.customer?.address?.text??""})})]})})}),e.jsxs(o,{xs:4,md:2,alignContent:{xs:"start",lg:"center"},children:[e.jsx(m,{gutterBottom:!0,variant:"body2",onClick:a.onTrue,sx:{color:"secondary.main",cursor:"pointer",textAlign:"right",textDecoration:"underline"},children:"Order History"}),e.jsx(m,{variant:"body2",onClick:()=>{t({title:"Change Customer",description:"Anda yakin? Data order akan direset.",confirmBtnText:"Change",onConfirm:async()=>{i({...s,customer:null})}})},sx:{color:"error.main",cursor:"pointer",textAlign:"right",textDecoration:"underline"},children:"Change Customer"})]})]})}),e.jsx(La,{open:a.value,onClose:a.onFalse})]})}function Oe({title:t,info:s,labelInfo:i,labelColor:a}){return e.jsxs(e.Fragment,{children:[e.jsx(m,{gutterBottom:!0,variant:"subtitle2",sx:{color:"text.disabled"},children:t}),e.jsxs(m,{variant:"body2",sx:{color:"text.primary"},children:[s,i&&e.jsx(Z,{variant:"soft",color:a??"default",ml:1,children:i})]})]})}function La({open:t,onClose:s}){const{orderDetail:i}=V(),[a,n]=r.useState(0),[u,d]=r.useState(0),[j,c]=r.useState(15),[l,p]=r.useState(!1),[f,D]=r.useState([]),[h,x]=r.useState("all"),I=async()=>{p(!0),await Vs({customer_id:i.customer?.id??"",payment_status:h!=="all"?h:""}).then(b=>{D(b.data),d(b.total),n(b.current_page-1)}).finally(()=>{p(!1)})};r.useEffect(()=>{t&&i.customer&&I()},[t,h]);const w=(b,R)=>{n(R)},k=b=>{c(parseInt(b.target.value,10)),n(0)};return e.jsxs(fe,{open:t,fullWidth:!0,maxWidth:"md",children:[e.jsx(de,{children:"Order History"}),e.jsx(ce,{sx:{overflow:"visible"},children:e.jsxs(C,{sx:{pt:1,overflowY:"auto",overflowX:"hidden",maxHeight:W.dialog.maxHeight},children:[e.jsx(Ma,{changeFilter:b=>x(b)}),e.jsx(le,{sx:{position:"relative",overflow:"hidden"},children:e.jsx(st,{children:e.jsxs(ot,{size:"medium",sx:{minWidth:0},children:[e.jsx($a,{}),e.jsx(Wa,{rows:f,status:l?"loading":"finish"})]})})}),e.jsx(Tt,{dense:!1,page:a,count:u,rowsPerPage:j,rowsPerPageOptions:[15,25,100],onPageChange:w,onRowsPerPageChange:k})]})}),e.jsx(ue,{children:e.jsx(G,{onClick:s,variant:"outlined",color:"inherit",children:"Close"})})]})}function Ma({changeFilter:t}){const s=ie({resolver:ne(gs),defaultValues:js}),{setValue:i}=s,a=n=>{i("payment_status",n.target.value),t(n.target.value)};return e.jsx(v,{sx:{pb:2.5},children:e.jsx(re,{methods:s,children:e.jsx(o,{container:!0,spacing:3,children:e.jsx(o,{xs:12,sm:3,children:e.jsxs(Kt,{label:"Payment Status",name:"payment_status",onChange:a,children:[e.jsx(Ke,{value:"all",children:"All Status"},""),Object.values(Re).map((n,u)=>e.jsx(Ke,{value:n,children:rt(n)},u))]})})})})})}const Qe=[{id:"invoice_number",label:"Invoice Number",width:"25%"},{id:"payment_plan",label:"Payment Plan",width:"25%",align:"right"},{id:"payment_status",label:"Payment Status",width:"25%",align:"right"},{id:"order_status",label:"Order Status",width:"25%",align:"right"}];function $a(){return e.jsx(lt,{children:e.jsx(Se,{children:Qe.map(t=>e.jsx(H,{align:t.align||"left",sortDirection:!1,sx:{width:t.width,minWidth:0},children:t.label},t.id))})})}function Wa({rows:t,status:s}){return e.jsx(dt,{children:s==="loading"?e.jsx(ke,{colspan:Qe.length,text:"loading .."}):t.length===0?e.jsx(ke,{colspan:Qe.length,text:"data not found"}):t.map((i,a)=>e.jsx(Ba,{row:i},i.invoice_no))})}function Ba({no:t,row:s}){return e.jsxs(Se,{hover:!0,children:[e.jsx(H,{sx:{whiteSpace:"nowrap"},children:s.invoice_no}),e.jsx(H,{sx:{whiteSpace:"nowrap"},align:"right",children:s.payment_plan===null?"-":e.jsx(Z,{variant:"soft",color:s.payment_plan===A.full_payment&&"success"||s.payment_plan===A.partial_payment&&"warning"||s.payment_plan===A.pay_on_delivery&&"info"||"default",children:Fe(s.payment_plan)})}),e.jsx(H,{sx:{whiteSpace:"nowrap"},align:"right",children:s.payment_status===null?"-":e.jsx(Z,{variant:"soft",color:s.payment_status===Re.paid&&"success"||s.payment_status===Re.partial&&"warning"||s.payment_status===Re.unpaid&&"default"||"default",children:rt(s.payment_status)})}),e.jsx(H,{sx:{whiteSpace:"nowrap"},align:"right",children:e.jsx(Z,{variant:"soft",color:St(s.status),children:s.status})})]})}function Ua(){const{orderDetail:t,orderDetailUpdate:s,orderDetailUpdateRefreshFlagUpdate:i,openDialogNewCustomer:a}=V(),[n,u]=r.useState(0),d=ie({resolver:ne(ys),defaultValues:ft}),{reset:j}=d;r.useEffect(()=>{if(t.customer){const l=oa(t.customer,ft.customer);j({customer:l})}},[t.customer]);const c=async l=>{l?.id&&(s({...t,customer:l}),i())};return e.jsxs(e.Fragment,{children:[e.jsx(re,{methods:d,children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{xs:12,md:10,children:e.jsx(Ve,{size:"medium",name:"customer",debounceSearch:!0,label:"Customer",disabled:!!t.customer,refreshTrigger:n,onSelect:l=>c(l),isOptionEqualToValue:(l,p)=>l?.id===p?.id,getOptionLabel:l=>l.name?`${l.name} ( ${l.phone} )`:"",fetchFunction:async l=>(await la({keyword:l,page:1})).data})}),e.jsx(o,{xs:12,md:2,children:e.jsx(G,{variant:"outlined",disabled:!!t.customer,sx:{width:"100%",height:"100%"},onClick:a.onTrue,startIcon:e.jsx(E,{icon:"mingcute:add-line"}),children:"Customer"})}),e.jsx(o,{xs:12,children:e.jsx(ut,{caption:"Fill in the form above and correct it again correctly"})})]})}),e.jsx(ra,{onSubmit:()=>u(l=>l+1),onClose:()=>a.onFalse(),openDialog:a.value})]})}function za(){const{orderDetail:t,openDialogFormOrderItem:s,orderDetailCalculateRefreshFlagUpdate:i,valueProductInfoFormOrderItem:a,passingProductInfoFormOrderItem:n,valueEditFormOrderItem:u,passingValueEditFormOrderItem:d,orderDetailAddItem:j,orderDetailEditItem:c}=V(),l=M(!1),[p,f]=r.useState(""),[D,h]=r.useState([]),x=async()=>{if(u)l.onTrue(),await ta(u.product.id??"").then(y=>{if(y.length>0){const F=y[0].addons.map(Y=>({label:Y.name,value:Y.id}));n(y[0]),h(F)}}).finally(()=>{l.onFalse()});else if(a){const y=a.addons.map(F=>({label:F.name,value:F.id}));h(y)}};r.useEffect(()=>{s.value&&x()},[s.value]);const I=ie({resolver:ne(vs),defaultValues:jt}),{reset:w,setValue:k,handleSubmit:b,formState:{isSubmitting:R,isDirty:g,errors:q}}=I;r.useEffect(()=>{if(s.value)if(u){const y=Ns(t.id??"",u);w(y),f("Edit Item")}else f("New Item")},[s.value,u]);const N=()=>{d(null),s.onFalse(),w(jt)},P=y=>{k("arr_addons_id",y,{shouldDirty:!0});const F=a?.addons.filter(Y=>y.includes(Y.id));k("arr_addons_obj",F)},B=async y=>{if(a){const F=Hs(a,y),Y=Ls(t.id??"",F);await Ms(Y).then(T=>{Y.order_item_id==="new"?j({...F,item_id:T.id,item_id_temp:T.id}):c(F),i(),N()}).catch(()=>{})}};return e.jsx(fe,{open:s.value,fullWidth:!0,maxWidth:"sm",children:e.jsxs(re,{methods:I,onSubmit:b(B),children:[e.jsx(de,{children:p}),e.jsx(ce,{sx:{overflow:"visible"},children:e.jsx(C,{sx:{pt:1,overflowY:"auto",overflowX:"hidden",maxHeight:W.dialog.maxHeight},children:l.value?e.jsx(o,{container:!0,spacing:3,children:Array.from({length:8}).map((y,F)=>e.jsx(o,{xs:12,children:e.jsx(se,{variant:"rounded",sx:{width:"100%",height:50}})},F))}):e.jsxs(o,{container:!0,spacing:3,children:[e.jsxs(o,{xs:12,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"end",children:[e.jsx(Xe,{name:"is_bulk",label:"",sx:{mr:0}}),e.jsx(m,{variant:"body2",sx:{color:"text.disabled"},children:"bulk"})]}),I.watch("is_bulk")&&e.jsx(o,{xs:12,children:e.jsx(z,{name:"quantity",label:"Quantity",size:"medium",moneyFormat:!0,hideCurrency:!0,fullWidth:!0,inputProps:{inputMode:"numeric"}})}),e.jsx(o,{xs:12,children:e.jsx(da,{name:"remarks",label:"Remarks",disableCloseOnSelect:!0,getOptionLabel:y=>y.name,fetchFunction:async y=>(await ha({keyword:y,page:1})).data,isOptionEqualToValue:(y,F)=>y.id===F.id})}),e.jsx(o,{xs:12,children:e.jsx(Ve,{name:"brand",label:"Brand",debounceSearch:!0,getOptionLabel:y=>y?.name,isOptionEqualToValue:(y,F)=>y?.id===F?.id,fetchFunction:async y=>(await ma({keyword:y,page:1})).data})}),e.jsx(o,{xs:12,children:e.jsx(Ve,{name:"color",label:"Color",debounceSearch:!0,getOptionLabel:y=>y?.name,isOptionEqualToValue:(y,F)=>y?.id===F?.id,fetchFunction:async y=>(await ua({keyword:y,page:1})).data})}),e.jsx(o,{xs:12,children:e.jsx(z,{name:"notes",label:"Notes",size:"medium"})}),e.jsx(o,{xs:12,md:4,children:e.jsx(Xt,{name:"discount_type",label:"Discount Type",options:[{label:pt(te.absolute),value:te.absolute},{label:pt(te.percentage),value:te.percentage}],onChange:(y,F)=>I.setValue("discount_type",F?.value??"",{shouldDirty:!0})})}),e.jsx(o,{xs:12,md:8,children:e.jsx(z,{name:"discount_value",label:"Discount",size:"medium",moneyFormat:!0,hideCurrency:!0,fullWidth:!0,inputProps:{inputMode:"numeric"}})}),e.jsx(o,{xs:12,children:e.jsx(ca,{row:!0,sx:{px:1.5},label:"Add Ons",name:"arr_addons_id",options:D,onChange:()=>{const y=I.watch("arr_addons_id")||[];P(y)}})})]})})}),e.jsxs(ue,{children:[e.jsx(G,{onClick:N,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(ae,{size:"medium",type:"submit",variant:"contained",loading:R,children:"Save"})]})]})})}function qa(){const{orderDetail:t}=V(),[s,i]=r.useState("");return e.jsx(K,{children:e.jsxs(v,{spacing:3,sx:{p:2.3},children:[e.jsx(Ua,{}),e.jsx(nt,{timeout:"auto",unmountOnExit:!0,in:t.customer!==null,children:e.jsxs(v,{spacing:3,children:[e.jsx(Ha,{}),e.jsx(pa,{onChange:a=>i(a)}),s==="product"||s===""?e.jsx(ga,{}):e.jsx(Na,{}),e.jsx(za,{})]})})]})})}function Ga(){const t=M(),s=Qt(),i=M(),{checkAbilities:a}=at(),{orderDetail:n,openDialogRevokeOrder:u,passingValueRevoke:d}=V(),{showSweetDialog:j}=we(),c=M(!1),l=Ct("mobile-websocket-key");r.useEffect(()=>{n.order_status===ee.revoke&&c.onTrue()},[n]);const p=async()=>{i.onTrue(),wt()?(await Ws(n.id),i.onFalse()):await Dt({key:l,orderId:n.id}).then(f=>{j({title:"Order Print Receipt Success",icon:"success",description:f.message})}).catch(f=>console.error(f)).finally(async()=>{i.onFalse()})};return e.jsxs(e.Fragment,{children:[e.jsxs(o,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(o,{xs:12,md:6,order:{xs:2,md:1},children:e.jsxs(v,{spacing:1,alignItems:{xs:"flex-start"},children:[e.jsxs(v,{spacing:1,direction:"row",alignItems:"center",children:[e.jsx(m,{variant:"h6",children:n?.order_no}),e.jsx(Z,{variant:"soft",color:St(n.order_status??ee.final),children:Zt(n.order_status??ee.final)})]}),e.jsx(m,{variant:"body2",color:"text.disabled",children:Ne(Number(n?.order_date),"DD MMMM YYYY hh:mm a")}),e.jsx(Z,{variant:"soft",color:Jt(n.payment_status),children:rt(n.payment_status)})]})}),e.jsx(o,{xs:12,md:6,order:{xs:1,md:2},children:e.jsx(v,{spacing:2,alignItems:{xs:"flex-end"},children:e.jsxs(v,{direction:"row",spacing:1,children:[e.jsx(ae,{size:"small",variant:"outlined",loading:t.value,onClick:s.onOpen,startIcon:e.jsx(E,{icon:"material-symbols:share"}),endIcon:e.jsx(E,{icon:"eva:arrow-ios-downward-fill"}),children:"Share"}),e.jsx(ae,{size:"small",variant:"outlined",loading:i.value,startIcon:e.jsx(E,{icon:"ic:round-print"}),disabled:n.order_status===ee.draft||n.order_status===ee.revoke,onClick:p,children:"Receipt"}),a?.("order-detail:revoke")&&e.jsx(G,{size:"small",color:"error",variant:"outlined",disabled:c.value,onClick:()=>{c.value||(d({order_id:n.id??"",item_id:null}),u.onTrue())},children:"Revoke"})]})})})]}),e.jsx(es,{open:s.open,onClose:s.onClose,anchorEl:s.anchorEl,slotProps:{arrow:{placement:"top-right"}},children:e.jsx(ts,{children:$s.map(f=>e.jsxs(Ke,{onClick:()=>f.action(n.id??""),children:[e.jsx(E,{icon:f.icon_name}),Pe(f.title)]},f.title))})})]})}function Ya(){return e.jsx(C,{display:"flex",justifyContent:"end",children:e.jsx(mt,{showTotalItemPrice:!0,showTotalItemDiscount:!0,showTotalItemAddOnsPrice:!0,showTotalVoucherDiscount:!0,showDeliveryFee:!0,showTotalItemPriceFinal:!0,showAmountPaid:!0,sx:{minWidth:"30%"}})})}function Ka(){const t=ss(),[s,i]=r.useState([{id:"product_info",label:"Product"},{id:"color",label:"Color",width:"10%"},{id:"remarks",label:"Remark",width:"10%"},{id:"add_ons",label:"Add-Ons",width:"10%"},{id:"notes",label:"Notes",width:"10%"},{id:"qty",label:"Quantity",width:"10%"},{id:"total_price",label:"Total Price",width:"10%"},{id:"marker",label:"Marker",width:"10%"}]);return r.useEffect(()=>{new URLSearchParams(t.toString()).get("revoke")==="show"&&i(n=>[...n,{id:"revoke",label:"",width:"0%"}])},[t]),e.jsx(It,{tableHeads:s})}function Xa(){const{orderDetail:t}=V();return e.jsxs(v,{spacing:1,children:[e.jsx(m,{variant:"subtitle1",children:"Invoice to"}),e.jsx(m,{variant:"body2",color:"text.secondary",children:t.customer?.name??"-"}),e.jsx(m,{variant:"body2",color:"text.secondary",children:t.customer?.phone??"-"}),e.jsx(m,{variant:"body2",color:"text.secondary",children:t.customer?.email??"-"}),e.jsxs(m,{variant:"body2",color:"text.secondary",children:[`Type Pick Up (${t.type_pickup?Ge(t.type_pickup):"-"})`,e.jsx(C,{component:"span",color:"info.main",sx:{ml:.5,textDecoration:"underline"},children:"lihat detail"})]}),e.jsxs(m,{variant:"body2",color:"text.secondary",children:[`Type Shipping (${t.type_shipping?Ye(t.type_shipping):"-"})`,e.jsx(C,{component:"span",color:"info.main",sx:{ml:.5,textDecoration:"underline"},children:"lihat detail"})]})]})}function Qa(){const{showSweetDialog:t}=we(),{showConfirmDialogInputKey:s}=as(),{openDialogRevokeOrder:i,valueRevoke:a,orderDetailReloadFlagUpdate:n}=V(),u=ie({resolver:ne(bs),defaultValues:gt}),{reset:d,handleSubmit:j,formState:{isSubmitting:c}}=u;r.useEffect(()=>{i.value&&a&&d({...gt,order_id:a.order_id,order_item_id:a.item_id})},[i.value,a]);const l=()=>{i.onFalse()},p=async D=>{const h=Bs(D);await Us(h).then(()=>{t({icon:"success",title:"Request OTP",description:"Request otp send successfully"});const x=zs(D);f(x),l()}).catch(x=>{x instanceof ct&&Object.keys(x.validationErrors).forEach(I=>{qe.warning(x.validationErrors[I][0],{position:"top-center"})})})},f=D=>{s({title:D.order_product_id?"Revoke Item":"Revoke Order",confirmBtnText:"Confirm",onConfirm:async h=>{D.otp=h?.key??"",await qs(D).then(()=>{t({icon:"success",title:"Revoke successfully",description:"Order revoke successfully"}),n()}).catch(x=>{throw qe.warning(x.message,{position:"top-center"}),new Error(x.message)})}})};return e.jsx(fe,{open:i.value,fullWidth:!0,maxWidth:"sm",children:e.jsxs(re,{methods:u,onSubmit:j(p),children:[e.jsx(de,{children:"Revoke OTP"}),e.jsx(ce,{sx:{overflow:"visible"},children:e.jsx(C,{sx:{pt:0,overflowY:"auto",overflowX:"hidden",maxHeight:W.dialog.maxHeight},children:e.jsx(o,{container:!0,spacing:3,children:e.jsx(o,{xs:12,children:e.jsx(Ee,{row:!0,label:"Request Method",name:"request_method",sx:{px:.2},options:[{label:xt(Ie.email),value:Ie.email},{label:xt(Ie.whatsapp),value:Ie.whatsapp}]})})})})}),e.jsxs(ue,{children:[e.jsx(G,{onClick:l,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(ae,{size:"medium",type:"submit",variant:"contained",loading:c,children:"Process"})]})]})})}function Za(){const{orderDetail:t}=V();return e.jsxs(K,{sx:{p:3},children:[e.jsx(Ga,{}),e.jsxs(v,{spacing:3,children:[e.jsx(Xa,{}),e.jsx(Ka,{}),t.items.length>0&&e.jsx(et,{sx:{borderStyle:"dashed"}}),e.jsx(Ya,{})]}),e.jsx(Qa,{})]})}function Ja(){const{orderDetail:t,openDialogFormPayment:s}=V();return e.jsxs(v,{spacing:2,direction:{xs:"column",sm:"row"},justifyContent:"space-between",children:[e.jsxs(C,{children:[e.jsx(m,{gutterBottom:!0,variant:"subtitle1",children:"Payment History"}),e.jsx(m,{variant:"body2",color:"text.secondary",children:"Detail Payment History Customers"})]}),e.jsx(G,{size:"large",variant:"contained",onClick:s.onTrue,startIcon:e.jsx(E,{icon:"mingcute:add-line"}),disabled:Number(t.amount_be_paid??"0")>=Number(t.amount_to_paid??"0"),children:"Payment"})]})}function ei(){const{orderDetail:t}=V(),[s,i]=r.useState(0),[a,n]=r.useState(0),[u,d]=r.useState(15),[j,c]=r.useState(!1),[l,p]=r.useState([]),f=async()=>{c(!0),await Gs(t.id??"").then(x=>{p(x.data),n(x.total),i(x.current_page-1)}).finally(()=>{c(!1)})};r.useEffect(()=>{t.id!=""&&f()},[t.id]);const D=(x,I)=>{i(I)},h=x=>{d(parseInt(x.target.value,10)),i(0)};return e.jsxs(K,{sx:{boxShadow:"none"},children:[e.jsx(C,{sx:{position:"relative"},children:e.jsx(st,{children:e.jsxs(ot,{size:"medium",sx:{minWidth:0},children:[e.jsx(ti,{}),e.jsx(si,{rows:l,status:j?"loading":"finish"})]})})}),e.jsx(Tt,{dense:!1,page:s,count:a,rowsPerPage:u,rowsPerPageOptions:[15,25,100],onPageChange:D,onRowsPerPageChange:h})]})}const Ze=[{id:"payment_received",label:"Payment Received",width:100},{id:"payment_method",label:"Payment Method",width:100},{id:"amount",label:"Amount",width:100},{id:"deposit",label:"Deposit",width:100},{id:"point",label:"Point",width:100},{id:"total",label:"Total",width:100},{id:"status",label:"Status",width:100}];function ti(){return e.jsx(lt,{children:e.jsx(Se,{children:Ze.map(t=>e.jsx(H,{align:t.align||"left",sortDirection:!1,sx:{width:t.width,minWidth:0},children:t.label},t.id))})})}function si({rows:t,status:s}){return e.jsx(dt,{children:s==="loading"?e.jsx(ke,{colspan:Ze.length,text:"loading .."}):t.length===0?e.jsx(ke,{colspan:Ze.length,text:"data not found"}):t.map((i,a)=>e.jsx(ai,{row:i},a))})}function ai({no:t,row:s}){return e.jsxs(Se,{hover:!0,children:[e.jsx(H,{sx:{whiteSpace:"nowrap"},children:Ne(s.payment_received,tt.dateTime)}),e.jsx(H,{sx:{whiteSpace:"nowrap"},children:s.payment_method}),e.jsx(H,{sx:{whiteSpace:"nowrap"},children:$(s.amount)}),e.jsx(H,{sx:{whiteSpace:"nowrap"},children:$(s.deposit_amount)}),e.jsx(H,{sx:{whiteSpace:"nowrap"},children:$(s.point_amount)}),e.jsx(H,{sx:{whiteSpace:"nowrap"},children:$(Number(s.amount)+Number(s.deposit_amount)+Number(s.point_amount))}),e.jsx(H,{sx:{whiteSpace:"nowrap"},children:e.jsx(Z,{variant:"soft",color:s.status===Q.success&&"success"||s.status===Q.pending&&"warning"||s.status===Q.expired&&"error"||s.status===Q.cancel&&"default"||s.status===Q.cancel&&"error"||"default",children:s.status})})]})}function ii(){return e.jsxs(e.Fragment,{children:[e.jsx(K,{sx:{p:3},children:e.jsxs(v,{spacing:3,children:[e.jsx(Ja,{}),e.jsx(ei,{})]})}),e.jsx(Ft,{}),e.jsx(Ot,{showPaymentPlan:!1})]})}function ni(){return e.jsxs(v,{spacing:3,children:[e.jsx(Za,{}),e.jsx(ii,{})]})}function ri(){const{order_id:t=""}=Cs(),{checkAbilities:s}=at(),{orderDetail:i,orderDetailReloadFlag:a,orderDetailUpdate:n,orderDetailUpdateRefreshFlag:u,orderDetailUpdateRefreshFlagUpdate:d,orderDetailCalculateLoading:j,orderDetailCalculateRefreshFlag:c}=V(),l=M(!0),p=async h=>{l.onTrue(),await Ys(h).then(x=>{n(x)}).finally(()=>{l.onFalse()})};r.useEffect(()=>{t!==""&&t!="new"?p(t):a>0&&i.id?p(i.id):l.onFalse()},[t,a]);const f=async()=>{j.onTrue();const h=Ks(i);await Xs(h).then(x=>{n({...i,amount_to_paid:x.total_keseluruhan,voucher_amount:x.total_voucher_murni,delivery_fee:x.total_delivery_fee_setelah_voucher,total_billing:(Number(x.total_harga_murni)+Number(x.total_addons_murni)).toString()}),d()}).finally(()=>{j.onFalse()})};r.useEffect(()=>{c>0&&f()},[c]);const D=async()=>{if(i.id){const h=Qs(i);await Zs(h).then(()=>{}).finally(()=>{})}else{const h=Js(i);await ea(h).then(x=>{n({...i,id:x.id,order_no:x.order_no}),window.history.pushState({},"",is.dashboard.transaction.order.details(x.id))}).finally(()=>{})}};return r.useEffect(()=>{u>0&&D()},[u]),l.value?e.jsx(oi,{}):i.order_status===ee.draft&&s?.("order:create")?e.jsx(qa,{}):e.jsx(ni,{})}function oi(){return e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{xs:12,children:e.jsx(se,{variant:"rounded",sx:{width:"100%",height:236}})}),e.jsx(o,{xs:12,sm:7,children:e.jsx(se,{variant:"rounded",sx:{width:"100%",height:236}})}),e.jsx(o,{xs:12,sm:5,children:e.jsx(se,{variant:"rounded",sx:{width:"100%",height:236}})})]})}const li={title:`Transaction - Order List - ${W.site.name}`};function Xi(){return e.jsxs(e.Fragment,{children:[e.jsx(ns,{children:e.jsxs("title",{children:[" ",li.title]})}),e.jsx(rs,{maxWidth:"xl",children:e.jsx(_s,{children:e.jsx(ri,{})})})]})}export{Xi as default};
