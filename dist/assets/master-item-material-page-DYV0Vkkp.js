import{f as H,r as s,k as e,d as R,ag as I,n as C,a as T,e as F,q as v,v as y,i7 as N,g as V,t as B,c6 as z,F as O,dj as G,c8 as q,aF as M,ay as $,bZ as K,o as W,S as Q,I as U,cP as Z,cD as J,m as X,cQ as Y,cd as ee,cc as E,aw as te,az as ae,H as re,C as se,aE as oe}from"./index-DL1FC2Xw.js";import{C as ne}from"./custom-breadcrumbs-nJImJlyu.js";import{C as A}from"./errors-wZ747Yys.js";import{F as ie}from"./form-caption-DFg98poz.js";import{R as le}from"./rhf-autocomplete-on-enter-kdiwxQrI.js";import{T as ce}from"./table-pagination-custom-D4L-eNU7.js";import{a as de,b as D,c as ue,T as me}from"./TableRow-Dnp-F93Q.js";import{T as j}from"./TableCell--CDe426o.js";import{C as he}from"./Card-x9v4l8Wx.js";import"./TablePagination-Cu0e8Dmj.js";import"./LastPage-CNSkhtZT.js";import"./FormControlLabel-RF8C1zCS.js";const L=s.createContext(void 0),b=()=>{const t=s.useContext(L);if(t===void 0)throw new Error("useContextPage must be used within a PageContext.Provider");return t},xe=({children:t})=>{const a=H(),[r,d]=s.useState(0),o=()=>d(h=>h+1),[n,u]=s.useState(""),m=h=>{u(h)},[i,S]=s.useState(null),P=h=>{S(h)},[g,w]=s.useState(0),f=h=>{w(h)},[l,x]=s.useState(0),p=h=>{x(h)},c=s.useMemo(()=>({isDialogFormOpen:a,refreshFlag:r,triggerRefresh:o,keyword:n,updateKeyword:m,materialFormValues:i,updateMaterialFormValues:P,page:g,updatePage:f,rowsPerPage:l,updateRowsPerPage:p}),[a,r,n,i,g,l]);return e.jsx(L.Provider,{value:c,children:t})};function pe(){const{checkAbilities:t}=R(),{isDialogFormOpen:a}=b();return e.jsx(ne,{heading:"Material",links:[{name:"Master",href:"#"},{name:"Material",href:"#"}],action:t?.("material:create")&&e.jsx(I,{size:"medium",variant:"contained",onClick:a.onTrue,startIcon:e.jsx(C,{icon:"mingcute:add-line"}),children:"New Material"}),sx:{mb:{xs:3,md:5}}})}const ge=async({keyword:t,page:a})=>{try{return(await T.get(`${F.master_item.satuan}?search=${t}&page=${a}&order_by=created_at&order_direction=desc`)).data}catch(r){throw console.error("SatuanGetList - error : ",r),new Error("unexpected error occurred")}},we=async({keyword:t,page:a})=>{try{return(await T.get(`${F.master_item.material}?search=${t}&page=${a}&order_by=created_at&order_direction=desc`)).data}catch(r){throw console.error("MaterialGetList - error : ",r),new Error("unexpected error occurred")}},fe=async t=>{try{await T.post(`${F.master_item.material}/${t}?_method=DELETE`)}catch(a){throw console.error("MaterialDelete - error : ",a),new Error("Oops, an error occurred while delete data!")}},je=async t=>{try{t.id?await T.post(`${F.master_item.material}/${t.id}?_method=PUT`,t):await T.post(`${F.master_item.material}`,t)}catch(a){throw a.status===422?a.data&&a.data.errors?new A(a.data.errors):a:(console.error("MaterialFormSubmit - error : ",a),new Error("Oops, an error occurred while saving data!"))}},be=t=>({id:t.id??"",name:t.name,satuan_id:t.satuan.id??""}),Se=v({id:y().nullable(),name:y().min(1,{message:"Name is required!"}),satuan:v({id:y(),name:y()})}).refine(t=>t.satuan.id,{message:"Satuan is required",path:["satuan"]}),k={id:null,name:"",satuan:{id:"",name:""}},Pe=v({keyword:y()}),ye={keyword:""};function Ce(){const{showSweetDialog:t}=N(),{isDialogFormOpen:a,materialFormValues:r,updateMaterialFormValues:d,triggerRefresh:o}=b(),[n,u]=s.useState("New Material"),m=V({resolver:B(Se),defaultValues:k}),{reset:i,handleSubmit:S,formState:{isSubmitting:P,isDirty:g}}=m;s.useEffect(()=>{r?(u("Edit Material"),i({id:r.id,name:r.name,satuan:r.satuan?{id:r.satuan.id,name:r.satuan.name}:{id:"",name:""}})):u("New Material")},[r]);const w=()=>{i(k),d(null),a.onFalse()},f=async l=>{const x=be(l);await je(x).then(()=>{w(),o(),t({icon:"success",title:"Data saved successfully",description:"Saved successfully"})}).catch(p=>{p instanceof A&&Object.keys(p.validationErrors).forEach(c=>{m.setError(c,{type:"manual",message:p.validationErrors[c][0]})})})};return e.jsx(z,{open:a.value,children:e.jsxs(O,{methods:m,onSubmit:S(f),children:[e.jsx(G,{children:n}),e.jsx(q,{sx:{overflow:"visible"},children:e.jsxs(M,{container:!0,spacing:3,children:[e.jsx(M,{xs:12,children:e.jsx($,{name:"name",label:"Name",size:"medium"})}),e.jsx(M,{xs:12,children:e.jsx(le,{name:"satuan",label:"Satuan",debounceSearch:!0,getOptionLabel:l=>l?.name,isOptionEqualToValue:(l,x)=>l?.id===x?.id,fetchFunction:async l=>(await ge({keyword:l,page:1})).data})}),e.jsx(M,{xs:12,children:e.jsx(ie,{caption:"Fill in the form above and correct it again correctly"})})]})}),e.jsxs(K,{children:[e.jsx(I,{onClick:w,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(W,{size:"medium",type:"submit",disabled:!g,variant:"contained",loading:P,children:"Save"})]})]})})}function Te(){const{keyword:t,updateKeyword:a}=b(),r=V({resolver:B(Pe),defaultValues:ye}),{watch:d,reset:o,handleSubmit:n}=r;s.useEffect(()=>{o({keyword:t})},[t,o]);const u=d();s.useEffect(()=>{const i=setTimeout(()=>{u.keyword===""&&a("")},300);return()=>clearTimeout(i)},[u.keyword,a]);const m=async i=>{a(i.keyword)};return e.jsx(Q,{sx:{p:2.5},children:e.jsx(O,{methods:r,onSubmit:n(m),children:e.jsx($,{size:"medium",name:"keyword",tooltipTitle:"press enter",placeholder:"Search material...",InputProps:{startAdornment:e.jsx(U,{position:"start",children:e.jsx(C,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})})}function Fe(){const t=[{id:"no",label:"No",width:10},{id:"material",label:"Material",width:100},{id:"satuan",label:"Satuan",width:100},{id:"",width:10}];return e.jsx(de,{children:e.jsx(D,{children:t.map(a=>e.jsx(j,{align:a.align||"left",sortDirection:!1,sx:{width:a.width,minWidth:0},children:a.label},a.id))})})}function Me({no:t,row:a}){const r=Z(),{showConfirmDialog:d}=J(),{checkAbilities:o,checkAbilitiesMultiple:n}=R(),{isDialogFormOpen:u,updateMaterialFormValues:m,triggerRefresh:i}=b();return e.jsxs(D,{hover:!0,children:[e.jsx(j,{sx:{whiteSpace:"nowrap"},children:t}),e.jsx(j,{sx:{whiteSpace:"nowrap"},children:a.name}),e.jsx(j,{sx:{whiteSpace:"nowrap"},children:a.satuan?.name??"-"}),e.jsxs(j,{sx:{whiteSpace:"nowrap"},align:"right",children:[n?.(["material:delete","material:edit"])&&e.jsx(X,{color:r.open?"inherit":"default",onClick:r.onOpen,children:e.jsx(C,{icon:"eva:more-vertical-fill"})}),e.jsx(Y,{open:r.open,anchorEl:r.anchorEl,onClose:r.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(ee,{children:[o?.("material:delete")&&e.jsxs(E,{onClick:()=>{r.onClose(),d({title:"Delete Category",description:"Anda yakin? Data akan dihapus permanent.",confirmBtnText:"Delete",onConfirm:async()=>{await fe(a.id),i()}})},sx:{color:"error.main"},children:[e.jsx(C,{icon:"solar:trash-bin-trash-bold"}),"Delete"]}),o?.("material:edit")&&e.jsxs(E,{onClick:()=>{r.onClose(),u.onTrue(),m(a)},children:[e.jsx(C,{icon:"solar:pen-bold"}),"Edit"]})]})})]})]})}function _({text:t}){return e.jsx(D,{hover:!0,children:e.jsx(j,{sx:{whiteSpace:"nowrap"},align:"center",colSpan:4,children:t})})}function ve({rows:t,status:a}){const{page:r,rowsPerPage:d}=b();return e.jsx(ue,{children:a==="loading"?e.jsx(_,{text:"loading .."}):t.length===0?e.jsx(_,{text:"data not found"}):t.map((o,n)=>e.jsx(Me,{row:o,no:(r-1)*d+n+1},o.id))})}function De(){const{keyword:t,refreshFlag:a,updatePage:r,updateRowsPerPage:d}=b(),[o,n]=s.useState(0),[u,m]=s.useState(0),[i,S]=s.useState(15),[P,g]=s.useState([]),[w,f]=s.useState(!1),l=async()=>{f(!0);const c=await we({keyword:t,page:o+1});f(!1),g(c.data),m(c.total),n(c.current_page-1),r(c.current_page),d(i)};s.useEffect(()=>{l()},[t,a,o]);const x=(c,h)=>{n(h)},p=c=>{S(parseInt(c.target.value,10)),n(0)};return e.jsxs(he,{children:[e.jsx(Te,{}),e.jsx(te,{sx:{position:"relative"},children:e.jsx(ae,{children:e.jsxs(me,{size:"medium",sx:{minWidth:0},children:[e.jsx(Fe,{}),e.jsx(ve,{rows:P,status:w?"loading":"finish"})]})})}),e.jsx(ce,{dense:!1,page:o,count:u,rowsPerPage:i,rowsPerPageOptions:[15,25,100],onPageChange:x,onRowsPerPageChange:p})]})}const Ee={title:`Master Item - Material - ${se.site.name}`};function ze(){return e.jsxs(e.Fragment,{children:[e.jsx(re,{children:e.jsxs("title",{children:[" ",Ee.title]})}),e.jsx(oe,{maxWidth:"xl",children:e.jsxs(xe,{children:[e.jsx(pe,{}),e.jsx(De,{}),e.jsx(Ce,{})]})})]})}export{ze as default};
