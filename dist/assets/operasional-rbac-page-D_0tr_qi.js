import{r as n,f as ae,k as e,d as z,ag as G,n as D,cP as oe,cD as ne,m as ie,cQ as re,cd as le,cc as M,q as W,v as F,d$ as ce,g as q,t as K,S as _,F as X,ay as Y,I as de,aw as Q,az as me,i7 as ue,c6 as he,dj as pe,c8 as xe,C as A,aF as E,l as ge,bH as be,cs as fe,aC as je,aX as we,as as Ce,aY as Re,bZ as Pe,o as ve,dC as ye,H as Te,aE as Se}from"./index-DL1FC2Xw.js";import{C as ke}from"./custom-breadcrumbs-nJImJlyu.js";import{T as De}from"./table-pagination-custom-D4L-eNU7.js";import{a as Ee,R as Fe,M as _e,b as Ie,c as Be}from"./functions-CGlv3mdR.js";import{a as Ae,b as Z,c as Ve,T as He}from"./TableRow-Dnp-F93Q.js";import{T as k}from"./TableCell--CDe426o.js";import{T as N}from"./table-body-rowinfo-yZgQl4g3.js";import{C as Le}from"./Card-x9v4l8Wx.js";import{C as Me}from"./errors-wZ747Yys.js";import{D as Ne}from"./divider-oAQn-qZp.js";import{F as O}from"./FormControlLabel-RF8C1zCS.js";import"./TablePagination-Cu0e8Dmj.js";import"./LastPage-CNSkhtZT.js";const J=n.createContext(void 0),C=()=>{const s=n.useContext(J);if(s===void 0)throw new Error("useContextPage must be used within a PageContext.Provider");return s},Oe=({children:s})=>{const[t,a]=n.useState(""),m=c=>{a(c)},[r,l]=n.useState(0),u=()=>l(c=>c+1),[h,d]=n.useState(0),R=c=>{d(c)},[b,P]=n.useState(0),g=c=>{P(c)},x=ae(),[v,y]=n.useState(null),f=c=>{y(c)},p=n.useMemo(()=>({keyword:t,updateKeyword:m,refreshTable:r,triggerRefreshTable:u,page:h,updatePage:R,rowsPerPage:b,updateRowsPerPage:g,openDialogRole:x,valueFormRole:v,updateValueFormRole:f}),[t,r,h,b,x,v]);return e.jsx(J.Provider,{value:p,children:s})};function $e(){const{checkAbilities:s}=z(),{openDialogRole:t}=C();return e.jsx(ke,{heading:"Rbac",links:[{name:"Operasional",href:"#"},{name:"Rbac",href:"#"}],action:s?.("rbac:create")&&e.jsx(G,{size:"medium",variant:"contained",onClick:t.onTrue,startIcon:e.jsx(D,{icon:"mingcute:add-line"}),children:"New Rbac"}),sx:{mb:{xs:3,md:5}}})}const V=[{id:"no",label:"No",width:"5%"},{id:"name",label:"Name",width:"15%"},{id:"",width:""},{id:"",width:"10%"}];function ze(){return e.jsx(Ae,{children:e.jsx(Z,{children:V.map((s,t)=>e.jsx(k,{align:s.align||"left",sortDirection:!1,sx:{width:s.width,minWidth:0},children:s.label},t))})})}function Ge({no:s,row:t}){const a=oe(),{showConfirmDialog:m}=ne(),{checkAbilities:r,checkAbilitiesMultiple:l}=z(),{openDialogRole:u,updateValueFormRole:h,triggerRefreshTable:d}=C();return e.jsxs(Z,{hover:!0,children:[e.jsx(k,{sx:{whiteSpace:"nowrap"},children:s}),e.jsx(k,{sx:{whiteSpace:"nowrap"},children:t.name}),e.jsx(k,{sx:{whiteSpace:"nowrap"},children:`( ${t.permissions.length} ) permissions`}),e.jsxs(k,{sx:{whiteSpace:"nowrap"},align:"right",children:[l?.(["rbac:delete","rbac:edit"])&&e.jsx(ie,{color:a.open?"inherit":"default",onClick:a.onOpen,children:e.jsx(D,{icon:"eva:more-vertical-fill"})}),e.jsx(re,{open:a.open,anchorEl:a.anchorEl,onClose:a.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(le,{children:[r?.("rbac:delete")&&e.jsxs(M,{onClick:()=>{a.onClose(),m({title:"Delete Role",description:"Anda yakin? Data akan dihapus permanent.",confirmBtnText:"Delete",onConfirm:async()=>{await Ee(t.id),d()}})},sx:{color:"error.main"},children:[e.jsx(D,{icon:"solar:trash-bin-trash-bold"}),"Delete"]}),r?.("rbac:edit")&&e.jsxs(M,{onClick:()=>{a.onClose(),u.onTrue(),h(t)},children:[e.jsx(D,{icon:"solar:pen-bold"}),"Edit"]})]})})]})]})}function We({rows:s,status:t}){const{page:a,rowsPerPage:m}=C();return e.jsx(Ve,{children:t==="loading"?e.jsx(N,{colspan:V.length,text:"loading .."}):s.length===0?e.jsx(N,{colspan:V.length,text:"data not found"}):s.map((r,l)=>e.jsx(Ge,{row:r,no:(a-1)*m+l+1},l))})}const qe=W({keyword:F()}),Ke={keyword:""},Xe=W({id:F().nullable(),name:F().min(1,{message:"Name is required!"}),permission_ids:ce(F())}).refine(s=>s.permission_ids.length>0,{message:"Permissions is required",path:["permission_ids"]}),$={id:null,name:"",permission_ids:[]};function Ye(){const{keyword:s,updateKeyword:t}=C(),a=q({resolver:K(qe),defaultValues:Ke}),{watch:m,reset:r,handleSubmit:l}=a;n.useEffect(()=>{r({keyword:s})},[s,r]);const u=m();n.useEffect(()=>{const d=setTimeout(()=>{u.keyword===""&&t("")},300);return()=>clearTimeout(d)},[u.keyword,t]);const h=async d=>{t(d.keyword)};return e.jsx(_,{sx:{p:2.5},children:e.jsx(X,{methods:a,onSubmit:l(h),children:e.jsx(Y,{size:"medium",name:"keyword",tooltipTitle:"press enter",placeholder:"Search Rbac...",InputProps:{startAdornment:e.jsx(de,{position:"start",children:e.jsx(D,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})})}function Qe(){const{keyword:s,refreshTable:t,updatePage:a,updateRowsPerPage:m}=C(),[r,l]=n.useState(0),[u,h]=n.useState(0),[d,R]=n.useState(15),[b,P]=n.useState([]),[g,x]=n.useState(!1),v=async()=>{x(!0),await Fe({keyword:s,page:r+1}).then(p=>{P(p.data),h(p.total),l(p.current_page-1),a(p.current_page),m(d)}).finally(()=>{x(!1)})};n.useEffect(()=>{v()},[s,t,r]);const y=(p,c)=>{l(c)},f=p=>{l(0)};return e.jsxs(Le,{children:[e.jsx(Ye,{}),e.jsx(Q,{sx:{position:"relative"},children:e.jsx(me,{children:e.jsxs(He,{size:"medium",sx:{minWidth:0},children:[e.jsx(ze,{}),e.jsx(We,{rows:b,status:g?"loading":"finish"})]})})}),e.jsx(De,{dense:!1,page:r,count:u,rowsPerPage:15,rowsPerPageOptions:[15,25,100],onPageChange:y,onRowsPerPageChange:f})]})}function Ze(){const{showSweetDialog:s}=ue(),{openDialogRole:t,valueFormRole:a,updateValueFormRole:m,triggerRefreshTable:r}=C(),[l,u]=n.useState([]),[h,d]=n.useState("New Rbac"),[R,b]=n.useState([]),P=async()=>{await _e().then(o=>{b(o)}).catch(()=>{})};n.useEffect(()=>{P()},[]);const g=q({resolver:K(Xe),defaultValues:$}),{reset:x,watch:v,setValue:y,getValues:f,handleSubmit:p,formState:{isSubmitting:c,isDirty:U}}=g;n.useEffect(()=>{a?(x({permission_ids:a.permissions.map(o=>o.id),name:a.name,id:a.id}),d("Edit Rbac")):d("New Rbac")},[a]);const I=n.useCallback(o=>!!f("permission_ids").find(i=>i===o),[l]),H=(o,j)=>{let i=f("permission_ids");if(i.find(T=>T===o)){const T=[o];if(j==="page"){const S=R.find(B=>B.permission.id===o);if(S){const B=S.children.map(te=>te.permission.id);T.push(...B)}}i=i.filter(S=>!T.includes(S))}else i.push(o);u(i),y("permission_ids",i,{shouldDirty:!0,shouldValidate:!0})},ee=async o=>{o.permission_ids&&ye.warning(o.permission_ids.message,{position:"top-center"})},L=()=>{x($),m(null),t.onFalse()},se=async o=>{const j=Ie(o);await Be(j).then(()=>{L(),r(),s({icon:"success",title:"Data saved successfully",description:"Saved successfully"})}).catch(i=>{i instanceof Me&&Object.keys(i.validationErrors).forEach(w=>{g.setError(w,{type:"manual",message:i.validationErrors[w][0]})})})};return e.jsx(he,{open:t.value,fullWidth:!0,maxWidth:"lg",children:e.jsxs(X,{methods:g,onSubmit:p(se,ee),children:[e.jsx(pe,{children:h}),e.jsx(xe,{sx:{overflow:"visible"},children:e.jsx(Q,{sx:{pt:1,overflowY:"auto",overflowX:"hidden",maxHeight:A.dialog.maxHeight},children:e.jsxs(E,{container:!0,spacing:3,children:[e.jsx(E,{xs:12,md:6,children:e.jsx(Y,{name:"name",label:"Role Name",size:"medium"})}),e.jsx(E,{xs:12,children:e.jsx(Ne,{children:e.jsx(ge,{variant:"body2",color:"GrayText",children:"Permissions Section"})})}),R.map((o,j)=>e.jsx(E,{xs:12,md:6,children:e.jsx(be,{sx:{height:"100%",p:2,border:i=>`solid 2px ${i.vars.palette.background.neutral}`},children:e.jsxs(_,{spacing:1,children:[e.jsxs(_,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(_,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(fe,{sx:{color:"text.disabled"},src:`${A.site.basePath}/assets/icons/navbar/${o.default_icon}.svg`}),e.jsx(je,{children:o.permission_name})]}),e.jsx(O,{label:"",sx:{mr:0},control:e.jsx(we,{checked:I(o.permission.id),onChange:(i,w)=>H(o.permission.id,"page")})})]}),e.jsx(Ce,{}),o.children.map((i,w)=>e.jsx(O,{label:i.permission_name,control:e.jsx(Re,{checked:I(i.permission.id),disabled:!I(o.permission.id),onChange:(T,S)=>H(i.permission.id,"action")})},w))]})})},j))]})})}),e.jsxs(Pe,{children:[e.jsx(G,{onClick:L,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(ve,{size:"medium",type:"submit",disabled:!U,variant:"contained",loading:c,children:"Save"})]})]})})}const Je={title:`Operasional - RBAC - ${A.site.name}`};function us(){return e.jsxs(e.Fragment,{children:[e.jsx(Te,{children:e.jsxs("title",{children:[" ",Je.title]})}),e.jsx(Se,{maxWidth:"xl",children:e.jsxs(Oe,{children:[e.jsx($e,{}),e.jsx(Qe,{}),e.jsx(Ze,{})]})})]})}export{us as default};
