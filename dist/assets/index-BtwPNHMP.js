import{g3 as V,r as c,gs as ve,a as be,k as e,aw as I,S as h,b8 as te,c3 as ye,gt as M,n as u,du as B,c as U,p as O,dl as P,aL as w,ci as $,l as R,db as _,cP as oe,cQ as re,dg as Ce,m as g,as as ae,cd as ie,cc as A,dm as we,aV as ke,f7 as Ie,cT as Se,dk as le,fj as Re,fJ as ce,u as de,bE as he,I as Te,az as q,dH as xe,c6 as Ne,c8 as Ae,bI as S,f as K,fs as J,ch as Pe,aK as Le,da as Oe,fC as $e,gu as De,dD as Ee,bB as Me,bC as Ue,af as We,aE as Fe,C as ue,H as ze}from"./index-CtazL8yi.js";import{u as D}from"./use-mocked-user-D4Y0Hvke.js";import{u as Q,m as E}from"./index-DFKKx7j5.js";import{E as Ge}from"./empty-content-oGcGfW-8.js";import{A as pe}from"./AvatarGroup-KAyacIty.js";import{S as C}from"./Skeleton-fN5wJ-1g.js";import{C as He}from"./ClickAwayListener-C7IZGHa6.js";import{u as Ve,L as Be}from"./use-light-box-CftAMKOe.js";import{u as ee}from"./uuidv4-B4SGT1yQ.js";import"./index-QBukoXJl.js";const H=!1,T="",Y={revalidateIfStale:H,revalidateOnFocus:H,revalidateOnReconnect:H};function _e(){const s=[T,{params:{endpoint:"contacts"}}],{data:n,isLoading:r,error:o,isValidating:t}=Q(s,V,Y);return c.useMemo(()=>({contacts:n?.contacts||[],contactsLoading:r,contactsError:o,contactsValidating:t,contactsEmpty:!r&&!n?.contacts.length}),[n?.contacts,o,r,t])}function qe(){const s=[T,{params:{endpoint:"conversations"}}],{data:n,isLoading:r,error:o,isValidating:t}=Q(s,V,Y);return c.useMemo(()=>{const i=n?.conversations.length?ve(n.conversations,"id"):{},l=Object.keys(i);return{conversations:{byId:i,allIds:l},conversationsLoading:r,conversationsError:o,conversationsValidating:t,conversationsEmpty:!r&&!l.length}},[n?.conversations,o,r,t])}function Ke(s){const n=s?[T,{params:{conversationId:s,endpoint:"conversation"}}]:"",{data:r,isLoading:o,error:t,isValidating:a}=Q(n,V,Y);return c.useMemo(()=>({conversation:r?.conversation,conversationLoading:o,conversationError:t,conversationValidating:a}),[r?.conversation,t,o,a])}async function Je(s,n){const r=[T,{params:{endpoint:"conversations"}}];E([T,{params:{conversationId:s,endpoint:"conversation"}}],t=>{const a=t.conversation,i={...a,messages:[...a.messages,n]};return{...t,conversation:i}},!1),E(r,t=>{const i=t.conversations.map(l=>l.id===s?{...l,messages:[...l.messages,n]}:l);return{...t,conversations:i}},!1)}async function Qe(s){const n=[T,{params:{endpoint:"conversations"}}],r={conversationData:s},o=await be.post(T,r);return E(n,t=>{const i=[...t.conversations,s];return{...t,conversations:i}},!1),o.data}async function Ye(s){E([T,{params:{endpoint:"conversations"}}],n=>{const o=n.conversations.map(t=>t.id===s?{...t,unreadCount:0}:t);return{...n,conversations:o}},!1)}function Xe({slots:s,sx:n,...r}){const o=e.jsx(I,{display:"flex",flexDirection:"column",children:s.nav}),t=e.jsx(h,{direction:"row",alignItems:"center",sx:{py:1,pr:1,pl:2.5,height:72,flexShrink:0,borderBottom:l=>`solid 1px ${l.vars.palette.divider}`},children:s.header}),a=e.jsx(h,{sx:{flex:"1 1 auto",minWidth:0},children:s.main}),i=e.jsx(h,{sx:{minHeight:0},children:s.details});return e.jsxs(h,{direction:"row",sx:n,...r,children:[o,e.jsxs(h,{sx:{flex:"1 1 auto",minWidth:0},children:[t,e.jsxs(h,{direction:"row",sx:{flex:"1 1 auto",minHeight:0},children:[a,i]})]})]})}const X=te(({selected:s,children:n,disabled:r,...o})=>e.jsxs(M,{disabled:r,...o,children:[n,e.jsx(u,{width:16,icon:(!s||r)&&"eva:arrow-ios-forward-fill"||"eva:arrow-ios-downward-fill"})]}))(({theme:s})=>({...s.typography.overline,height:40,paddingLeft:s.spacing(2.5),justifyContent:"space-between",paddingRight:s.spacing(1.5),color:s.vars.palette.text.secondary,backgroundColor:s.vars.palette.background.neutral})),Ze=te(ye)(({theme:s})=>({top:84,left:0,zIndex:9,width:32,height:32,position:"absolute",borderRadius:"0 12px 12px 0",boxShadow:s.customShadows.primary,color:s.vars.palette.primary.contrastText,backgroundColor:s.vars.palette.primary.main,transition:s.transitions.create(["all"],{duration:s.transitions.duration.shorter}),"&:hover":{backgroundColor:s.vars.palette.primary.darker}}));function es({currentUserId:s,conversation:n}){const{messages:r,participants:o}=n,t=o.filter(x=>x.id!==s),a=r[r.length-1],i=t.length>1,l=t.map(x=>x.name).join(", "),d=i?t.map(x=>x.status).includes("online"):!1;let p="";if(a){const x=a.senderId===s?"You: ":"",m=a.contentType==="image"?"Sent a photo":a.body;p=`${x}${m}`}return{group:i,displayName:l,displayText:p,participants:t,lastActivity:a.createdAt,hasOnlineInGroup:d}}function ss({selected:s,collapse:n,conversation:r,onCloseMobile:o}){const{user:t}=D(),a=B("up","md"),i=U(),{group:l,displayName:d,displayText:p,participants:x,lastActivity:m,hasOnlineInGroup:j}=es({conversation:r,currentUserId:`${t?.id}`}),v=x[0],{name:f,avatarUrl:b,status:y}=v,W=c.useCallback(async()=>{try{a||o(),await Ye(r.id),i.push(`${O.dashboard.chat}?id=${r.id}`)}catch(N){console.error(N)}},[r.id,a,o,i]),F=e.jsx(P,{variant:j?"online":"invisible",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(pe,{variant:"compact",sx:{width:48,height:48},children:x.slice(0,2).map(N=>e.jsx(w,{alt:N.name,src:N.avatarUrl},N.id))})}),L=e.jsx(P,{variant:y,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(w,{alt:f,src:b,sx:{width:48,height:48}})},y);return e.jsx(I,{component:"li",sx:{display:"flex"},children:e.jsxs(M,{onClick:W,sx:{py:1.5,px:2.5,gap:2,...s&&{bgcolor:"action.selected"}},children:[e.jsx(P,{color:"error",overlap:"circular",badgeContent:n?r.unreadCount:0,children:l?F:L}),!n&&e.jsxs(e.Fragment,{children:[e.jsx($,{primary:d,primaryTypographyProps:{noWrap:!0,component:"span",variant:"subtitle2"},secondary:p,secondaryTypographyProps:{noWrap:!0,component:"span",variant:r.unreadCount?"subtitle2":"body2",color:r.unreadCount?"text.primary":"text.secondary"}}),e.jsxs(h,{alignItems:"flex-end",sx:{alignSelf:"stretch"},children:[e.jsx(R,{noWrap:!0,variant:"body2",component:"span",sx:{mb:1.5,fontSize:12,color:"text.disabled"},children:_(m)}),!!r.unreadCount&&e.jsx(I,{sx:{width:8,height:8,bgcolor:"info.main",borderRadius:"50%"}})]})]})]})})}function ns(){const{user:s}=D(),n=oe(),[r,o]=c.useState("online"),t=c.useCallback(a=>{o(a.target.value)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(P,{variant:r,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(w,{src:s?.photoURL,alt:s?.displayName,onClick:n.onOpen,sx:{cursor:"pointer",width:48,height:48},children:s?.displayName?.charAt(0).toUpperCase()})}),e.jsxs(re,{open:n.open,anchorEl:n.anchorEl,onClose:n.onClose,slotProps:{paper:{sx:{p:0}},arrow:{placement:"top-left"}},children:[e.jsxs(h,{direction:"row",alignItems:"center",spacing:2,sx:{py:2,pr:1,pl:2},children:[e.jsx($,{primary:s?.displayName,secondary:s?.email,secondaryTypographyProps:{component:"span"}}),e.jsx(Ce,{title:"Log out",children:e.jsx(g,{color:"error",children:e.jsx(u,{icon:"ic:round-power-settings-new"})})})]}),e.jsx(ae,{sx:{borderStyle:"dashed"}}),e.jsxs(ie,{sx:{my:.5,px:.5},children:[e.jsxs(A,{children:[e.jsx(P,{variant:r,sx:{[`& .${we.badge}`]:{m:.75,width:12,height:12,flexShrink:0,position:"static"}}}),e.jsx(ke,{fullWidth:!0,children:e.jsx(Ie,{native:!0,fullWidth:!0,value:r,onChange:t,input:e.jsx(le,{}),inputProps:{id:"chat-status-select",sx:{textTransform:"capitalize"}},sx:{[`& .${Se.root}`]:{right:0}},children:["online","alway","busy","offline"].map(a=>e.jsx("option",{value:a,children:a},a))})})]}),e.jsxs(A,{children:[e.jsx(u,{icon:"solar:user-id-bold",width:24}),"Profile"]}),e.jsxs(A,{children:[e.jsx(u,{icon:"eva:settings-2-fill",width:24}),"Settings"]})]})]})]})}function ts({sx:s,amount:n=6,...r}){return[...Array(n)].map((o,t)=>e.jsxs(h,{spacing:2,direction:"row",alignItems:"center",sx:{px:2.5,py:1.5,...s},...r,children:[e.jsx(C,{variant:"circular",sx:{width:48,height:48}}),e.jsxs(h,{spacing:1,flexGrow:1,children:[e.jsx(C,{sx:{width:.75,height:10}}),e.jsx(C,{sx:{width:.5,height:10}})]})]},t))}function os({sx:s,...n}){return e.jsxs(h,{direction:"row",alignItems:"center",sx:{width:1,...s},...n,children:[e.jsx(C,{variant:"circular",sx:{width:40,height:40}}),e.jsxs(h,{spacing:1,flexGrow:1,sx:{mx:2},children:[e.jsx(C,{sx:{width:96,height:10}}),e.jsx(C,{sx:{width:40,height:10}})]}),e.jsx(C,{variant:"circular",sx:{width:28,height:28}}),e.jsx(C,{variant:"circular",sx:{width:28,height:28,mx:1}}),e.jsx(C,{variant:"circular",sx:{width:28,height:28,mr:1}})]})}function rs({sx:s,...n}){return e.jsx(h,{flexGrow:1,sx:{pt:5,...s},...n,children:e.jsxs(h,{alignItems:"center",children:[e.jsx(C,{variant:"circular",sx:{width:96,height:96}}),e.jsx(C,{sx:{mb:1,mt:2,height:10,width:.65}}),e.jsx(C,{sx:{width:.35,height:10,mb:5}}),e.jsx(Re,{color:"inherit",thickness:2})]})})}function as({query:s,results:n,onClickResult:r}){const o=n.length,t=!o&&!!s,a=e.jsx(ce,{query:s,sx:{p:3,mx:"auto",width:"calc(100% - 40px)",bgcolor:"background.neutral"}}),i=e.jsx("nav",{children:e.jsx(I,{component:"ul",children:n.map(l=>e.jsx(I,{component:"li",sx:{display:"flex"},children:e.jsxs(M,{onClick:()=>r(l),sx:{gap:2,py:1.5,px:2.5,typography:"subtitle2"},children:[e.jsx(w,{alt:l.name,src:l.avatarUrl}),l.name]})},l.id))})});return e.jsxs(e.Fragment,{children:[e.jsxs(R,{variant:"h6",sx:{px:2.5,mb:2},children:["Contacts (",o,")"]}),t?a:i]})}const se=320,is=96;function ls({loading:s,contacts:n,conversations:r,collapseNav:o,selectedConversationId:t}){const a=de(),i=U(),l=B("up","md"),{openMobile:d,onOpenMobile:p,onCloseMobile:x,onCloseDesktop:m,collapseDesktop:j,onCollapseDesktop:v}=o,[f,b]=c.useState({query:"",results:[]});c.useEffect(()=>{l||m()},[m,l]);const y=c.useCallback(()=>{l?v():x()},[l,x,v]),W=c.useCallback(()=>{l||x(),i.push(O.dashboard.chat)},[l,x,i]),F=c.useCallback(k=>{if(b(z=>({...z,query:k})),k){const z=n.filter(G=>G.name.toLowerCase().includes(k));b(G=>({...G,results:z}))}},[n]),L=c.useCallback(()=>{b({query:"",results:[]})},[]),N=c.useCallback(k=>{L(),i.push(`${O.dashboard.chat}?id=${k.id}`)},[L,i]),me=e.jsx(ts,{}),ge=e.jsx("nav",{children:e.jsx(I,{component:"ul",children:r.allIds.map(k=>e.jsx(ss,{collapse:j,conversation:r.byId[k],selected:k===t,onCloseMobile:x},k))})}),je=e.jsx(as,{query:f.query,results:f.results,onClickResult:N}),fe=e.jsx(He,{onClickAway:L,children:e.jsx(he,{fullWidth:!0,value:f.query,onChange:k=>F(k.target.value),placeholder:"Search contacts...",InputProps:{startAdornment:e.jsx(Te,{position:"start",children:e.jsx(u,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},sx:{mt:2.5}})}),Z=e.jsxs(e.Fragment,{children:[e.jsxs(h,{direction:"row",alignItems:"center",justifyContent:"center",sx:{p:2.5,pb:0},children:[!j&&e.jsxs(e.Fragment,{children:[e.jsx(ns,{}),e.jsx(I,{sx:{flexGrow:1}})]}),e.jsx(g,{onClick:y,children:e.jsx(u,{icon:j?"eva:arrow-ios-forward-fill":"eva:arrow-ios-back-fill"})}),!j&&e.jsx(g,{onClick:W,children:e.jsx(u,{width:24,icon:"solar:user-plus-bold"})})]}),e.jsx(I,{sx:{p:2.5,pt:0},children:!j&&fe}),s?me:e.jsx(q,{sx:{pb:1},children:f.query&&r.allIds.length?je:ge})]});return e.jsxs(e.Fragment,{children:[e.jsx(Ze,{onClick:p,sx:{display:{md:"none"}},children:e.jsx(u,{width:16,icon:"solar:users-group-rounded-bold"})}),e.jsx(h,{sx:{minHeight:0,flex:"1 1 auto",width:se,display:{xs:"none",md:"flex"},borderRight:`solid 1px ${a.vars.palette.divider}`,transition:a.transitions.create(["width"],{duration:a.transitions.duration.shorter}),...j&&{width:is}},children:Z}),e.jsx(xe,{open:d,onClose:x,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:se}},children:Z})]})}function cs({participant:s,open:n,onClose:r}){return e.jsxs(Ne,{fullWidth:!0,maxWidth:"xs",open:n,onClose:r,children:[e.jsx(g,{onClick:r,sx:{position:"absolute",right:8,top:8},children:e.jsx(u,{icon:"mingcute:close-line"})}),e.jsxs(Ae,{sx:{py:5,px:3,display:"flex"},children:[e.jsx(w,{alt:s.name,src:s.avatarUrl,sx:{width:96,height:96,mr:3}}),e.jsxs(h,{spacing:1,children:[e.jsx(R,{variant:"caption",sx:{color:"primary.main"},children:s.role}),e.jsx(R,{variant:"subtitle1",children:s.name}),e.jsxs(h,{direction:"row",sx:{typography:"caption",color:"text.disabled"},children:[e.jsx(u,{icon:"mingcute:location-fill",width:16,sx:{flexShrink:0,mr:.5,mt:"2px"}}),s.address]}),e.jsxs(h,{spacing:1,direction:"row",sx:{pt:1.5},children:[e.jsx(g,{size:"small",color:"error",sx:{borderRadius:1,bgcolor:o=>S(o.vars.palette.error.mainChannel,.08),"&:hover":{bgcolor:o=>S(o.vars.palette.error.mainChannel,.16)}},children:e.jsx(u,{width:18,icon:"solar:phone-bold"})}),e.jsx(g,{size:"small",color:"info",sx:{borderRadius:1,bgcolor:o=>S(o.vars.palette.info.mainChannel,.08),"&:hover":{bgcolor:o=>S(o.vars.palette.info.mainChannel,.16)}},children:e.jsx(u,{width:18,icon:"solar:chat-round-dots-bold"})}),e.jsx(g,{size:"small",color:"primary",sx:{borderRadius:1,bgcolor:o=>S(o.vars.palette.primary.mainChannel,.08),"&:hover":{bgcolor:o=>S(o.vars.palette.primary.mainChannel,.16)}},children:e.jsx(u,{width:18,icon:"fluent:mail-24-filled"})}),e.jsx(g,{size:"small",color:"secondary",sx:{borderRadius:1,bgcolor:o=>S(o.vars.palette.secondary.mainChannel,.08),"&:hover":{bgcolor:o=>S(o.vars.palette.secondary.mainChannel,.16)}},children:e.jsx(u,{width:18,icon:"solar:videocamera-record-bold"})})]})]})]})]})}function ds({participants:s}){const n=K(!0),[r,o]=c.useState(null),t=c.useCallback(d=>{o(d)},[]),a=c.useCallback(()=>{o(null)},[]),i=s.length,l=e.jsx(e.Fragment,{children:s.map(d=>e.jsxs(M,{onClick:()=>t(d),children:[e.jsx(P,{variant:d.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(w,{alt:d.name,src:d.avatarUrl})}),e.jsx($,{sx:{ml:2},primary:d.name,secondary:d.role,primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{noWrap:!0,component:"span",typography:"caption"}})]},d.id))});return e.jsxs(e.Fragment,{children:[e.jsx(X,{selected:n.value,disabled:!i,onClick:n.onToggle,children:`In room (${i})`}),e.jsx(J,{in:n.value,children:l}),r&&e.jsx(cs,{participant:r,open:!!r,onClose:a})]})}function hs({participant:s}){const n=K(!0),r=e.jsxs(h,{alignItems:"center",sx:{py:5},children:[e.jsx(w,{alt:s?.name,src:s?.avatarUrl,sx:{width:96,height:96,mb:2}}),e.jsx(R,{variant:"subtitle1",children:s?.name}),e.jsx(R,{variant:"body2",sx:{color:"text.secondary",mt:.5},children:s?.role})]}),o=e.jsx(h,{spacing:2,sx:{px:2,py:2.5},children:[{icon:"mingcute:location-fill",value:s?.address},{icon:"solar:phone-bold",value:s?.phoneNumber},{icon:"fluent:mail-24-filled",value:s?.email}].map(t=>e.jsxs(h,{spacing:1,direction:"row",sx:{typography:"body2",wordBreak:"break-all"},children:[e.jsx(u,{icon:t.icon,sx:{flexShrink:0,color:"text.disabled"}}),t.value]},t.icon))});return e.jsxs(e.Fragment,{children:[r,e.jsx(X,{selected:n.value,onClick:n.onToggle,children:"Information"}),e.jsx(J,{in:n.value,children:o})]})}function xs({attachments:s}){const n=K(!0),r=s.length,o=s.map((t,a)=>e.jsxs(h,{spacing:1.5,direction:"row",alignItems:"center",children:[e.jsx(Pe,{imageView:!0,file:t.preview,onDownload:()=>console.info("DOWNLOAD"),slotProps:{icon:{width:24,height:24}},sx:{width:40,height:40,bgcolor:"background.neutral"}}),e.jsx($,{primary:t.name,secondary:Le(t.createdAt),primaryTypographyProps:{noWrap:!0,typography:"body2"},secondaryTypographyProps:{mt:.25,noWrap:!0,component:"span",typography:"caption",color:"text.disabled"}})]},t.name+a));return e.jsxs(e.Fragment,{children:[e.jsx(X,{selected:n.value,disabled:!r,onClick:n.onToggle,children:`Attachments (${r})`}),!!r&&e.jsx(J,{in:n.value,children:e.jsx(h,{spacing:2,sx:{p:2},children:o})})]})}const us=280,ps=320;function ms({collapseNav:s,participants:n,messages:r,loading:o}){const t=de(),{collapseDesktop:a,openMobile:i,onCloseMobile:l}=s,d=n.length>1,p=r.map(m=>m.attachments).flat(1)||[],x=o?e.jsx(rs,{}):e.jsx(q,{children:e.jsxs("div",{children:[d?e.jsx(ds,{participants:n}):e.jsx(hs,{participant:n[0]}),e.jsx(xs,{attachments:p})]})});return e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{minHeight:0,flex:"1 1 auto",width:us,display:{xs:"none",lg:"flex"},borderLeft:`solid 1px ${t.vars.palette.divider}`,transition:t.transitions.create(["width"],{duration:t.transitions.duration.shorter}),...a&&{width:0}},children:!a&&x}),e.jsx(xe,{anchor:"right",open:i,onClose:l,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:ps}},children:x})]})}function gs({message:s,participants:n,currentUserId:r}){const o=n.find(l=>l.id===s.senderId),t=s.senderId===r?{type:"me"}:{avatarUrl:o?.avatarUrl,firstName:o?.name.split(" ")[0]},a=t.type==="me";return{hasImage:s.contentType==="image",me:a,senderDetails:t}}function js({message:s,participants:n,onOpenLightbox:r}){const{user:o}=D(),{me:t,senderDetails:a,hasImage:i}=gs({message:s,participants:n,currentUserId:`${o?.id}`}),{firstName:l,avatarUrl:d}=a,{body:p,createdAt:x}=s,m=e.jsxs(R,{noWrap:!0,variant:"caption",sx:{mb:1,color:"text.disabled",...!t&&{mr:"auto"}},children:[!t&&`${l}, `,_(x)]}),j=e.jsx(h,{sx:{p:1.5,minWidth:48,maxWidth:320,borderRadius:1,typography:"body2",bgcolor:"background.neutral",...t&&{color:"grey.800",bgcolor:"primary.lighter"},...i&&{p:0,bgcolor:"transparent"}},children:i?e.jsx(I,{component:"img",alt:"attachment",src:p,onClick:()=>r(p),sx:{width:400,height:"auto",borderRadius:1.5,cursor:"pointer",objectFit:"cover",aspectRatio:"16/11","&:hover":{opacity:.9}}}):p}),v=e.jsxs(h,{direction:"row",className:"message-actions",sx:{pt:.5,left:0,opacity:0,top:"100%",position:"absolute",transition:f=>f.transitions.create(["opacity"],{duration:f.transitions.duration.shorter}),...t&&{right:0,left:"unset"}},children:[e.jsx(g,{size:"small",children:e.jsx(u,{icon:"solar:reply-bold",width:16})}),e.jsx(g,{size:"small",children:e.jsx(u,{icon:"eva:smiling-face-fill",width:16})}),e.jsx(g,{size:"small",children:e.jsx(u,{icon:"solar:trash-bin-trash-bold",width:16})})]});return e.jsxs(h,{direction:"row",justifyContent:t?"flex-end":"unset",sx:{mb:5},children:[!t&&e.jsx(w,{alt:l,src:d,sx:{width:32,height:32,mr:2}}),e.jsxs(h,{alignItems:t?"flex-end":"flex-start",children:[m,e.jsxs(h,{direction:"row",alignItems:"center",sx:{position:"relative","&:hover":{"& .message-actions":{opacity:1}}},children:[j,v]})]})]})}function fs(s){const n=c.useRef(null),r=c.useCallback(()=>{s&&n.current&&n.current&&(n.current.scrollTop=n.current.scrollHeight)},[s]);return c.useEffect(()=>{r()},[s]),{messagesEndRef:n}}function vs({messages:s=[],participants:n,loading:r}){const{messagesEndRef:o}=fs(s),t=s.filter(i=>i.contentType==="image").map(i=>({src:i.body})),a=Ve(t);return r?e.jsx(h,{sx:{flex:"1 1 auto",position:"relative"},children:e.jsx(Oe,{color:"inherit",sx:{top:0,left:0,width:1,height:2,borderRadius:0,position:"absolute"}})}):e.jsxs(e.Fragment,{children:[e.jsx(q,{ref:o,sx:{px:3,pt:5,pb:3,flex:"1 1 auto"},children:s.map(i=>e.jsx(js,{message:i,participants:n,onOpenLightbox:()=>a.onOpen(i.body)},i.id))}),e.jsx(Be,{slides:t,open:a.open,close:a.onClose,index:a.selected})]})}function bs({disabled:s,recipients:n,onAddRecipients:r,selectedConversationId:o}){const t=U(),{user:a}=D(),i=c.useRef(null),[l,d]=c.useState(""),p=c.useMemo(()=>({id:`${a?.id}`,role:`${a?.role}`,email:`${a?.email}`,address:`${a?.address}`,name:`${a?.displayName}`,lastActivity:$e(),avatarUrl:`${a?.photoURL}`,phoneNumber:`${a?.phoneNumber}`,status:"online"}),[a]),x=c.useMemo(()=>({id:ee(),attachments:[],body:l,contentType:"text",createdAt:De({minutes:1}),senderId:p.id}),[l,p.id]),m=c.useMemo(()=>({id:ee(),messages:[x],participants:[...n,p],type:n.length>1?"GROUP":"ONE_TO_ONE",unreadCount:0}),[x,p,n]),j=c.useCallback(()=>{i.current&&i.current.click()},[]),v=c.useCallback(b=>{d(b.target.value)},[]),f=c.useCallback(async b=>{try{if(b.key==="Enter"){if(l)if(o)await Je(o,x);else{const y=await Qe(m);t.push(`${O.dashboard.chat}?id=${y.conversation.id}`),r([])}d("")}}catch(y){console.error(y)}},[m,l,x,r,t,o]);return e.jsxs(e.Fragment,{children:[e.jsx(le,{name:"chat-message",id:"chat-message-input",value:l,onKeyUp:f,onChange:v,placeholder:"Type a message",disabled:s,startAdornment:e.jsx(g,{children:e.jsx(u,{icon:"eva:smiling-face-fill"})}),endAdornment:e.jsxs(h,{direction:"row",sx:{flexShrink:0},children:[e.jsx(g,{onClick:j,children:e.jsx(u,{icon:"solar:gallery-add-bold"})}),e.jsx(g,{onClick:j,children:e.jsx(u,{icon:"eva:attach-2-fill"})}),e.jsx(g,{children:e.jsx(u,{icon:"solar:microphone-bold"})})]}),sx:{px:1,height:56,flexShrink:0,borderTop:b=>`solid 1px ${b.vars.palette.divider}`}}),e.jsx("input",{type:"file",ref:i,style:{display:"none"}})]})}function ys({collapseNav:s,participants:n,loading:r}){const o=oe(),t=B("up","lg"),a=n.length>1,i=n[0],{collapseDesktop:l,onCollapseDesktop:d,onOpenMobile:p}=s,x=c.useCallback(()=>{t?d():p()},[t]),m=e.jsx(pe,{max:3,sx:{[`& .${Ee.avatar}`]:{width:32,height:32}},children:n.map(v=>e.jsx(w,{alt:v.name,src:v.avatarUrl},v.id))}),j=e.jsxs(h,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(P,{variant:i?.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(w,{src:i?.avatarUrl,alt:i?.name})}),e.jsx($,{primary:i?.name,secondary:i?.status==="offline"?_(i?.lastActivity):i?.status,secondaryTypographyProps:{component:"span",...i?.status!=="offline"&&{textTransform:"capitalize"}}})]});return r?e.jsx(os,{}):e.jsxs(e.Fragment,{children:[a?m:j,e.jsxs(h,{direction:"row",flexGrow:1,justifyContent:"flex-end",children:[e.jsx(g,{children:e.jsx(u,{icon:"solar:phone-bold"})}),e.jsx(g,{children:e.jsx(u,{icon:"solar:videocamera-record-bold"})}),e.jsx(g,{onClick:x,children:e.jsx(u,{icon:l?"ri:sidebar-fold-fill":"ri:sidebar-unfold-fill"})}),e.jsx(g,{onClick:o.onOpen,children:e.jsx(u,{icon:"eva:more-vertical-fill"})})]}),e.jsx(re,{open:o.open,anchorEl:o.anchorEl,onClose:o.onClose,children:e.jsxs(ie,{children:[e.jsxs(A,{onClick:()=>{o.onClose()},children:[e.jsx(u,{icon:"solar:bell-off-bold"}),"Hide notifications"]}),e.jsxs(A,{onClick:()=>{o.onClose()},children:[e.jsx(u,{icon:"solar:forbidden-circle-bold"}),"Block"]}),e.jsxs(A,{onClick:()=>{o.onClose()},children:[e.jsx(u,{icon:"solar:danger-triangle-bold"}),"Report"]}),e.jsx(ae,{sx:{borderStyle:"dashed"}}),e.jsxs(A,{onClick:()=>{o.onClose()},sx:{color:"error.main"},children:[e.jsx(u,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})})]})}function Cs({contacts:s,onAddRecipients:n}){const[r,o]=c.useState(""),t=c.useCallback(a=>{o(""),n(a)},[n]);return e.jsxs(e.Fragment,{children:[e.jsx(R,{variant:"subtitle2",sx:{color:"text.primary",mr:2},children:"To:"}),e.jsx(Me,{sx:{minWidth:{md:320},flexGrow:{xs:1,md:"unset"}},multiple:!0,limitTags:3,popupIcon:null,defaultValue:[],disableCloseOnSelect:!0,noOptionsText:e.jsx(ce,{query:r}),onChange:(a,i)=>t(i),onInputChange:(a,i)=>o(i),options:s,getOptionLabel:a=>a.name,isOptionEqualToValue:(a,i)=>a.id===i.id,renderInput:a=>e.jsx(he,{...a,placeholder:"+ Recipients"}),renderOption:(a,i,{selected:l})=>c.createElement("li",{...a,key:i.id},e.jsxs(I,{sx:{mr:1,width:32,height:32,overflow:"hidden",borderRadius:"50%",position:"relative"},children:[e.jsx(w,{alt:i.name,src:i.avatarUrl,sx:{width:1,height:1}}),e.jsx(h,{alignItems:"center",justifyContent:"center",sx:{top:0,left:0,width:1,height:1,opacity:0,position:"absolute",bgcolor:d=>S(d.vars.palette.grey["900Channel"],.8),transition:d=>d.transitions.create(["opacity"],{easing:d.transitions.easing.easeInOut,duration:d.transitions.duration.shorter}),...l&&{opacity:1,color:"primary.main"}},children:e.jsx(u,{icon:"eva:checkmark-fill"})})]},i.id),i.name),renderTags:(a,i)=>a.map((l,d)=>c.createElement(Ue,{...i({index:d}),key:l.id,label:l.name,avatar:e.jsx(w,{alt:l.name,src:l.avatarUrl}),size:"small",variant:"soft"}))})]})}function ne(){const[s,n]=c.useState(!1),[r,o]=c.useState(!1),t=c.useCallback(()=>{o(d=>!d)},[]),a=c.useCallback(()=>{o(!1)},[]),i=c.useCallback(()=>{n(!0)},[]),l=c.useCallback(()=>{n(!1)},[]);return{collapseDesktop:r,onCloseDesktop:a,onCollapseDesktop:t,openMobile:s,onOpenMobile:i,onCloseMobile:l}}function ws(){const s=U(),{user:n}=D(),{contacts:r}=_e(),t=We().get("id")||"",[a,i]=c.useState([]),{conversations:l,conversationsLoading:d}=qe(),{conversation:p,conversationError:x,conversationLoading:m}=Ke(`${t}`),j=ne(),v=ne(),f=p?p.participants.filter(y=>y.id!==`${n?.id}`):[];c.useEffect(()=>{(x||!t)&&s.push(O.dashboard.chat)},[x,s,t]);const b=c.useCallback(y=>{i(y)},[]);return e.jsxs(Fe,{maxWidth:!1,sx:{display:"flex",flex:"1 1 auto",flexDirection:"column"},children:[e.jsx(R,{variant:"h4",sx:{mb:{xs:3,md:5}},children:"Chat"}),e.jsx(Xe,{sx:{minHeight:0,flex:"1 1 0",borderRadius:2,position:"relative",bgcolor:"background.paper",boxShadow:y=>y.customShadows.card},slots:{header:t?e.jsx(ys,{collapseNav:j,participants:f,loading:m}):e.jsx(Cs,{contacts:r,onAddRecipients:b}),nav:e.jsx(ls,{contacts:r,conversations:l,loading:d,selectedConversationId:t,collapseNav:v}),main:e.jsxs(e.Fragment,{children:[t?e.jsx(vs,{messages:p?.messages??[],participants:f,loading:m}):e.jsx(Ge,{imgUrl:`${ue.site.basePath}/assets/icons/empty/ic-chat-active.svg`,title:"Good morning!",description:"Write something awesome..."}),e.jsx(bs,{recipients:a,onAddRecipients:b,selectedConversationId:t,disabled:!a.length&&!t})]}),details:t&&e.jsx(ms,{collapseNav:j,participants:f,loading:m,messages:p?.messages??[]})}})]})}const ks={title:`Chat | Dashboard - ${ue.site.name}`};function Ds(){return e.jsxs(e.Fragment,{children:[e.jsx(ze,{children:e.jsxs("title",{children:[" ",ks.title]})}),e.jsx(ws,{})]})}export{Ds as default};
