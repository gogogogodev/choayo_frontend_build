import{d as X,ia as M,k as e,ag as v,n as m,r as x,f as P,g as O,t as H,S as R,F as V,aF as h,ay as J,I as K,dg as Q,gN as U,cc as E,o as F,l as k,dC as ee,aI as g,c as A,p as W,L as te,aZ as ae,aC as se,iz as _,aw as G,az as ie,i7 as ne,c6 as oe,dj as re,c8 as le,C as N,bZ as ce,iw as de,H as he,aE as pe}from"./index-DL1FC2Xw.js";import{u as y,T as ue,a as me,S as I,b as xe,P as ge}from"./schemas-DfOOnHbp.js";import{C as fe}from"./custom-breadcrumbs-nJImJlyu.js";import{T as je}from"./table-pagination-custom-D4L-eNU7.js";import{S as L,a as be,P as Se,b as we}from"./functions-anUTkds4.js";import{R as B}from"./rhf-date-picker-CcRSy6lj.js";import{B as ve}from"./ButtonGroup-vK33_kGx.js";import{a as ye,b as $,c as Ce,T as Te}from"./TableRow-Dnp-F93Q.js";import{T as S}from"./TableCell--CDe426o.js";import{T as z}from"./table-body-rowinfo-yZgQl4g3.js";import{C as De}from"./Card-x9v4l8Wx.js";import{C as Pe}from"./errors-wZ747Yys.js";import{F as _e}from"./form-caption-DFg98poz.js";import{R as Fe}from"./rhf-autocomplete-on-enter-kdiwxQrI.js";import{C as Ye}from"./functions-BoFIsn5X.js";import"./TablePagination-Cu0e8Dmj.js";import"./LastPage-CNSkhtZT.js";import"./FormControlLabel-RF8C1zCS.js";import"./DatePicker-x3rEWLr9.js";import"./ListItem-ByRhTH_M.js";import"./MobileDateTimePicker-DRzd3izO.js";import"./getValidReactChildren-BsnWJZZF.js";function Re(){const{checkAbilities:s}=X(),{isDialogFormOpen:t}=y(),i=M(a=>a.activeStore);return e.jsx(fe,{heading:"Shipping",links:[{name:"Transaction",href:"#"},{name:"Shipping",href:"#"}],action:s?.("shipping:create")&&e.jsx(v,{size:"medium",variant:"contained",disabled:i?.id==="",onClick:t.onTrue,startIcon:e.jsx(m,{icon:"mingcute:add-line"}),children:"New Shipping"}),sx:{mb:{xs:3,md:5}}})}function Ee(){const s=x.useRef(null),t=P(!1),i=P(!1),a=P(!1),{triggerRefresh:l,updateToolbarSearchValue:r}=y(),p=O({resolver:H(me),defaultValues:ue}),{watch:f,reset:C,handleSubmit:j,formState:{errors:b}}=p,w=async n=>{r(n),l()},o=async n=>{n.start_date?.message&&ee.warning(n.start_date?.message,{position:"top-center"})},d=async n=>{i.onTrue(),await L({start_date:g(n.start_date,"YYYY-M-D")??"",end_date:g(n.end_date,"YYYY-M-D")??"",file_type:"pdf"}).finally(()=>{i.onFalse()})},c=async n=>{a.onTrue(),await L({start_date:g(n.start_date,"YYYY-M-D")??"",end_date:g(n.end_date,"YYYY-M-D")??"",file_type:"xlsx"}).finally(()=>{a.onFalse()})};return e.jsxs(e.Fragment,{children:[e.jsx(R,{sx:{p:2.5},children:e.jsx(V,{methods:p,children:e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{xs:12,lg:4,children:e.jsx(J,{size:"medium",name:"keyword",placeholder:"Search shipping...",InputProps:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(m,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})}),e.jsx(h,{xs:12,lg:3,children:e.jsx(B,{name:"start_date",label:"Start Date",hideErrorMessage:!0})}),e.jsx(h,{xs:12,lg:3,children:e.jsx(B,{name:"end_date",label:"End Date"})}),e.jsx(h,{xs:12,lg:2,children:e.jsxs(R,{spacing:1,direction:"row",sx:{height:"100%",alignItems:"stretch"},children:[e.jsx(Q,{title:"search",arrow:!0,children:e.jsx("span",{style:{display:"flex",flex:1},children:e.jsx(v,{fullWidth:!0,color:"info",variant:"outlined",sx:{height:"100%"},onClick:j(w,o),children:e.jsx(m,{icon:"material-symbols:search-rounded"})})})}),e.jsxs(ve,{variant:"outlined","aria-label":"Print actions",color:"primary",ref:s,onClick:t.onToggle,children:[e.jsx(v,{size:"medium",startIcon:e.jsx(m,{icon:"hugeicons:printer"}),children:"Print"}),e.jsx(v,{size:"medium",children:e.jsx(m,{icon:"ion:md-arrow-dropdown"})})]})]})})]})})}),e.jsxs(U,{open:t.value,anchorEl:s.current,onClose:t.onFalse,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{mt:1,borderRadius:1,minWidth:s.current?.offsetWidth||160}}},children:[e.jsx(E,{sx:{p:0},children:e.jsx(F,{disabled:!0,fullWidth:!0,size:"medium",type:"submit",variant:"contained",color:"info",sx:{height:"100%"},loading:i.value,startIcon:e.jsx(m,{icon:"mingcute:pdf-fill"}),onClick:j(d,o),children:e.jsx(k,{variant:"subtitle2",children:"Pdf"})})}),e.jsx(E,{sx:{p:0},children:e.jsx(F,{fullWidth:!0,size:"medium",type:"submit",variant:"contained",color:"info",sx:{height:"100%"},loading:a.value,startIcon:e.jsx(m,{icon:"ri:file-excel-2-fill"}),onClick:j(c,o),children:e.jsx(k,{variant:"subtitle2",children:"Excel"})})})]})]})}const Y=[{id:"shipping_id",label:"Shipping ID",width:"20%"},{id:"customer_name",label:"Customer",width:"20%"},{id:"received_date",label:"Received Date",width:"20%"},{id:"received_by",label:"Received By",width:"20%"},{id:"status",label:"Status",width:"20%"}];function ke(){return e.jsx(ye,{children:e.jsx($,{children:Y.map(s=>e.jsx(S,{align:s.align||"left",sortDirection:!1,sx:{width:s.width,minWidth:0},children:s.label},s.id))})})}function Ie({no:s,row:t}){const i=A(),a=x.useCallback(l=>{i.push(`${W.dashboard.transaction.shipping.details(l)}`)},[i]);return e.jsxs($,{hover:!0,children:[e.jsx(S,{sx:{whiteSpace:"nowrap"},children:e.jsx(te,{color:"inherit",onClick:()=>a(t.id),underline:"always",sx:{cursor:"pointer"},children:t.shipping_no})}),e.jsx(S,{sx:{whiteSpace:"nowrap"},children:t.customer_name}),e.jsx(S,{sx:{whiteSpace:"nowrap"},children:t.received_date?g(Number(t.received_date),ae.dateTime):"-"}),e.jsx(S,{sx:{whiteSpace:"nowrap"},children:t.received_by?t.received_by:"-"}),e.jsx(S,{sx:{whiteSpace:"nowrap"},children:e.jsx(se,{variant:"soft",color:t.status===_.draft&&"warning"||t.status===_.progress&&"info"||t.status===_.success&&"success"||"default",children:t.status})})]})}function Le({rows:s,status:t}){const{page:i,rowsPerPage:a}=y();return e.jsx(Ce,{children:t==="loading"?e.jsx(z,{text:"loading ..",colspan:Y.length}):s.length===0?e.jsx(z,{text:"data not found",colspan:Y.length}):s.map((l,r)=>e.jsx(Ie,{row:l,no:(i-1)*a+r+1},r))})}function Be(){const{refreshFlag:s,updatePage:t,updateRowsPerPage:i,toolbarSearchValue:a}=y(),l=M(u=>u.activeStore),r=P(),[p,f]=x.useState(0),[C,j]=x.useState(0),[b,w]=x.useState(15),[o,d]=x.useState([]),c=async()=>{r.onTrue();const u=a?g(a.start_date,"YYYY-MM-DD"):"",T=a?g(a.end_date,"YYYY-MM-DD"):"",q=a?a.keyword:"";await be({start_date:u?`${u} 00:00:01`:"",end_date:T?`${T} 23:59:59`:"",page:p+1,keyword:q}).then(D=>{d(D.data),j(D.total),f(D.current_page-1),t(D.current_page),i(b)}).finally(()=>{r.onFalse()})};x.useEffect(()=>{c()},[s,p,l]);const n=(u,T)=>{f(T)},Z=u=>{w(parseInt(u.target.value,10)),f(0)};return e.jsxs(De,{children:[e.jsx(Ee,{}),e.jsx(G,{sx:{position:"relative"},children:e.jsx(ie,{children:e.jsxs(Te,{size:"medium",sx:{minWidth:0},children:[e.jsx(ke,{}),e.jsx(Le,{rows:o,status:r.value?"loading":"finish"})]})})}),e.jsx(je,{dense:!1,page:p,count:C,rowsPerPage:b,rowsPerPageOptions:[15,25,100],onPageChange:n,onRowsPerPageChange:Z})]})}function ze(){const s=A(),{showSweetDialog:t}=ne(),{isDialogFormOpen:i}=y(),a=O({resolver:H(xe),defaultValues:I}),{reset:l,handleSubmit:r,watch:p,formState:{isSubmitting:f,isDirty:C,errors:j}}=a,b=()=>{l(I),i.onFalse()},w=async o=>{const d=Se(o);await we(d).then(async c=>{b(),t({icon:"success",title:"Data saved successfully",description:"Saved successfully"}),await de(1e3),s.push(`${W.dashboard.transaction.shipping.details(c.id)}`)}).catch(c=>{c instanceof Pe&&Object.keys(c.validationErrors).forEach(n=>{a.setError(n,{type:"manual",message:c.validationErrors[n][0]})})})};return e.jsx(oe,{open:i.value,children:e.jsxs(V,{methods:a,onSubmit:r(w),children:[e.jsx(re,{children:"New Shipping"}),e.jsx(le,{sx:{overflow:"visible"},children:e.jsx(G,{sx:{pt:1,overflowY:"auto",overflowX:"hidden",maxHeight:N.dialog.maxHeight},children:e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{xs:12,children:e.jsx(Fe,{name:"customer",debounceSearch:!0,label:"Customer",getOptionLabel:o=>o?.name,isOptionEqualToValue:(o,d)=>o?.id===d?.id,fetchFunction:async o=>(await Ye({keyword:o,page:1})).data})}),e.jsx(h,{xs:12,children:e.jsx(_e,{caption:"Fill in the form above and correct it again correctly"})})]})})}),e.jsxs(ce,{children:[e.jsx(v,{onClick:b,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(F,{size:"medium",type:"submit",disabled:!C,variant:"contained",loading:f,children:"Save"})]})]})})}const Me={title:`Transaction - Shipping - ${N.site.name}`};function rt(){return e.jsxs(e.Fragment,{children:[e.jsx(he,{children:e.jsxs("title",{children:[" ",Me.title]})}),e.jsx(pe,{maxWidth:"xl",children:e.jsxs(ge,{children:[e.jsx(Re,{}),e.jsx(Be,{}),e.jsx(ze,{})]})})]})}export{rt as default};
