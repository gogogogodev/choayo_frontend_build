import{f as te,r as i,k as e,d as q,ag as N,n as v,il as W,ik as _,a as O,e as A,aI as Y,q as b,v as t,cC as ne,d$ as B,d_ as ie,g as K,t as Z,S as Q,F as U,ay as f,I as le,cP as de,cD as ce,aZ as me,m as pe,cQ as ue,cd as he,cc as z,aw as X,az as xe,i7 as fe,c6 as ge,dj as be,c8 as ye,C as J,aF as n,l as R,im as _e,io as je,ip as H,i8 as we,bZ as Ee,o as Se,H as ve,aE as Pe}from"./index-DL1FC2Xw.js";import{C as Te}from"./custom-breadcrumbs-nJImJlyu.js";import{T as ke}from"./table-pagination-custom-D4L-eNU7.js";import{C as ee}from"./errors-wZ747Yys.js";import{a as Ce,b as se,c as Fe,T as De}from"./TableRow-Dnp-F93Q.js";import{T as y}from"./TableCell--CDe426o.js";import{T as M}from"./table-body-rowinfo-yZgQl4g3.js";import{T as Re}from"./text-divider-CeTsOEqe.js";import{C as Oe}from"./Card-x9v4l8Wx.js";import{D as V}from"./divider-oAQn-qZp.js";import{F as Ae}from"./form-caption-DFg98poz.js";import{R as L}from"./rhf-autocomplete-on-enter-kdiwxQrI.js";import{R as Ve}from"./rhf-radio-group-c3xmrwMe.js";import{a as Le}from"./rhf-checkbox-DHrzNFCH.js";import{R as Ie}from"./rhf-date-picker-CcRSy6lj.js";import{R as $}from"./rhf-autocomplete-checkboxes-BAgVzsEP.js";import{g as Ge}from"./functions-_nuXFB4v.js";import{R as Be}from"./functions-CGlv3mdR.js";import"./TablePagination-Cu0e8Dmj.js";import"./LastPage-CNSkhtZT.js";import"./FormControlLabel-RF8C1zCS.js";import"./RadioGroup-DjJiUtpj.js";import"./FormGroup-dr7_GDnD.js";import"./DatePicker-x3rEWLr9.js";import"./ListItem-ByRhTH_M.js";import"./MobileDateTimePicker-DRzd3izO.js";const oe=i.createContext(void 0),P=()=>{const s=i.useContext(oe);if(s===void 0)throw new Error("useContextPage must be used within a PageContext.Provider");return s},ze=({children:s})=>{const r=te(),[a,u]=i.useState(0),l=()=>u(o=>o+1),[c,h]=i.useState(""),m=o=>{h(o)},[p,g]=i.useState(null),T=o=>{g(o)},[j,k]=i.useState(0),w=o=>{k(o)},[E,F]=i.useState(0),S=o=>{F(o)},x=i.useMemo(()=>({isDialogFormOpen:r,refreshFlag:a,triggerRefresh:l,keyword:c,updateKeyword:m,employeeFormValues:p,updateEmployeeFormValues:T,page:j,updatePage:w,rowsPerPage:E,updateRowsPerPage:S}),[r,a,c,p,j,E]);return e.jsx(oe.Provider,{value:x,children:s})};function He(){const{checkAbilities:s}=q(),{isDialogFormOpen:r}=P();return e.jsx(Te,{heading:"Employee",links:[{name:"Operasional",href:"#"},{name:"Employee",href:"#"}],action:s?.("employee:create")&&e.jsx(N,{size:"medium",variant:"contained",onClick:r.onTrue,startIcon:e.jsx(v,{icon:"mingcute:add-line"}),children:"New Employee"}),sx:{mb:{xs:3,md:5}}})}const Me=async({keyword:s,page:r})=>{try{return(await O.get(`${A.operasional.employee}?search=${s}&page=${r}&order_by=created_at&order_direction=desc`)).data}catch(a){throw console.error("EmployeeGetList - error : ",a),new Error("something wrong")}},$e=async s=>{try{await O.post(`${A.operasional.employee}/${s}?_method=DELETE`)}catch(r){throw console.error("EmployeeDelete - error : ",r),new Error("something wrong")}},qe=async s=>{try{s.id?await O.post(`${A.operasional.employee}/${s.id}?_method=PUT`,s):await O.post(`${A.operasional.employee}`,s)}catch(r){throw r.status===422?r.data&&r.data.errors?new ee(r.data.errors):r:(console.error("EmployeeFormSubmit - error : ",r),new Error("something wrong"))}},Ne=s=>({id:s.id??"",all_store:s.all_store,store_ids:s.stores.map(r=>r.id),email:s.email,password:s.password??void 0,role_ids:s.roles.map(r=>r.id),name_prefix:s.name_prefix.value,name:s.name,name_suffix:s.name_suffix.value,gender:s.gender,birth_date:Y(s.birth_date,"YYYY-MM-DD")??"",birth_place:s.birth_place,phone:s.phone!==""?`62${s.phone}`:"",address:s.wilayah.full_name!==""?{name:s.address_name,kecamatan_id:s.wilayah.kecamatan_id??"",kelurahan_id:s.wilayah.kelurahan_id,full_name:s.wilayah.full_name,text:s.address_text,description:s.address_description,kode_pos:s.address_kode_pos,latitude:"0",longitude:"0"}:null}),We=(s,r)=>({id:s.id,all_store:s.all_store,stores:s.stores,email:s.login_access.email,password:null,roles:s.roles,name_prefix:{label:s.person?.name_prefix??"",value:s.person?.name_prefix??""},name:s.person?.name??"",name_suffix:{label:s.person?.name_suffix??"",value:s.person?.name_suffix??""},gender:s.person?.gender??_.M,birth_date:s.person?.birth_date??"",birth_place:s.person?.birth_place??"",phone:W(s.person?.phone??""),address_text:s.person?.address?.text??"",address_description:s.person?.address?.description??"",address_kode_pos:s.person?.address?.kode_pos??"0",address_name:s.person?.address?.name??"",wilayah:s.person?.address?{kecamatan_id:String(s.person?.address.kecamatan_id??""),kelurahan_id:String(s.person?.address.kelurahan_id??""),full_name:String(s.person?.address.full_name??"")}:r.wilayah}),Ye=b({keyword:t()}),Ke={keyword:""},Ze=b({id:t().nullable(),all_store:ie(),stores:B(b({id:t(),name:t()})),email:t().min(1,{message:"Email is required!"}),password:t().nullable(),roles:B(b({id:t(),name:t()})),name_prefix:b({label:t(),value:t()}),name:t(),name_suffix:b({label:t(),value:t()}),gender:ne(Object.values(_),{message:'Gender must be either "M" or "F"!'}),birth_date:t(),birth_place:t(),phone:t(),address_text:t(),address_description:t(),address_kode_pos:t(),address_name:t(),wilayah:b({kecamatan_id:t(),kelurahan_id:t(),full_name:t()})}).refine(s=>s.roles.length>0,{message:"Roles is required",path:["roles"]}).refine(s=>s.name!=="",{message:"Name is required",path:["name"]}).refine(s=>!(s.stores.length===0&&!s.all_store),{message:"Stores is required",path:["stores"]}).refine(s=>!((s.address_text!==""||s.address_description!==""||s.address_name!=="")&&s.wilayah.full_name===""),{message:"Address is required",path:["wilayah"]}),I={id:"",all_store:!1,stores:[],email:"",password:null,roles:[],name_prefix:{label:"",value:""},name:"",name_suffix:{label:"",value:""},gender:_.M,birth_date:"",birth_place:"",phone:"",address_text:"",address_description:"",address_kode_pos:"",address_name:"",wilayah:{kecamatan_id:"",kelurahan_id:"",full_name:""}};function Qe(){const{keyword:s,updateKeyword:r}=P(),a=K({resolver:Z(Ye),defaultValues:Ke}),{watch:u,reset:l,handleSubmit:c}=a;i.useEffect(()=>{l({keyword:s})},[s,l]);const h=u();i.useEffect(()=>{const p=setTimeout(()=>{h.keyword===""&&r("")},300);return()=>clearTimeout(p)},[h.keyword,r]);const m=async p=>{r(p.keyword)};return e.jsx(Q,{sx:{p:2.5},children:e.jsx(U,{methods:a,onSubmit:c(m),children:e.jsx(f,{size:"medium",name:"keyword",tooltipTitle:"press enter",placeholder:"Search store...",InputProps:{startAdornment:e.jsx(le,{position:"start",children:e.jsx(v,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})})}const G=[{id:"no",label:"No",width:10},{id:"name",label:"Name",width:100},{id:"store",label:"Assigned Store",width:100},{id:"birth_date",label:"Birth Date",width:100},{id:"role",label:"Role",width:100},{id:"",width:10}];function Ue(){return e.jsx(Ce,{children:e.jsx(se,{children:G.map(s=>e.jsx(y,{align:s.align||"left",sortDirection:!1,sx:{width:s.width,minWidth:0},children:s.label},s.id))})})}function Xe({no:s,row:r}){const a=de(),{showConfirmDialog:u}=ce(),{checkAbilities:l,checkAbilitiesMultiple:c}=q(),{isDialogFormOpen:h,updateEmployeeFormValues:m,triggerRefresh:p}=P();return e.jsxs(se,{hover:!0,children:[e.jsx(y,{sx:{whiteSpace:"nowrap"},children:s}),e.jsx(y,{sx:{whiteSpace:"nowrap"},children:e.jsx(Re,{type:"normal",disableDivider:!0,upperText:r.person?.name??"-",lowerText:r.person?.email??"-",lowerTextProps:{variant:"caption",color:"text.disabled"}})}),e.jsx(y,{sx:{whiteSpace:"nowrap"},children:`( ${r.stores.length} ) stores`}),e.jsx(y,{sx:{whiteSpace:"nowrap"},children:r.person?.birth_date?Y(r.person?.birth_date,me.dateTime):"-"}),e.jsx(y,{sx:{whiteSpace:"nowrap"},children:r.roles.map(g=>g.name).join(", ")}),e.jsxs(y,{sx:{whiteSpace:"nowrap"},align:"right",children:[c?.(["employee:delete","employee:edit"])&&e.jsx(pe,{color:a.open?"inherit":"default",onClick:a.onOpen,children:e.jsx(v,{icon:"eva:more-vertical-fill"})}),e.jsx(ue,{open:a.open,anchorEl:a.anchorEl,onClose:a.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(he,{children:[l?.("employee:delete")&&e.jsxs(z,{onClick:()=>{a.onClose(),u({title:"Delete Employee",description:"Anda yakin? Data akan dihapus permanent.",confirmBtnText:"Delete",onConfirm:async()=>{await $e(r.id),p()}})},sx:{color:"error.main"},children:[e.jsx(v,{icon:"solar:trash-bin-trash-bold"}),"Delete"]}),l?.("employee:edit")&&e.jsxs(z,{onClick:()=>{a.onClose(),h.onTrue(),m(r)},children:[e.jsx(v,{icon:"solar:pen-bold"}),"Edit"]})]})})]})]})}function Je({rows:s,status:r}){const{page:a,rowsPerPage:u}=P();return e.jsx(Fe,{children:r==="loading"?e.jsx(M,{colspan:G.length,text:"loading .."}):s.length===0?e.jsx(M,{colspan:G.length,text:"data not found"}):s.map((l,c)=>e.jsx(Xe,{row:l,no:(a-1)*u+c+1},l.id))})}function es(){const{keyword:s,refreshFlag:r,updatePage:a,updateRowsPerPage:u}=P(),[l,c]=i.useState(0),[h,m]=i.useState(0),[p,g]=i.useState(15),[T,j]=i.useState([]),[k,w]=i.useState(!1),E=async()=>{w(!0),await Me({keyword:s,page:l+1}).then(x=>{j(x.data),m(x.total),c(x.current_page-1),a(x.current_page),u(p)}).finally(()=>{w(!1)})};i.useEffect(()=>{E()},[s,r,l]);const F=(x,o)=>{c(o)},S=x=>{c(0)};return e.jsxs(Oe,{children:[e.jsx(Qe,{}),e.jsx(X,{sx:{position:"relative"},children:e.jsx(xe,{children:e.jsxs(De,{size:"medium",sx:{minWidth:0},children:[e.jsx(Ue,{}),e.jsx(Je,{rows:T,status:k?"loading":"finish"})]})})}),e.jsx(ke,{dense:!1,page:l,count:h,rowsPerPage:15,rowsPerPageOptions:[15,25,100],onPageChange:F,onRowsPerPageChange:S})]})}function ss(){const{showSweetDialog:s}=fe(),{isDialogFormOpen:r,employeeFormValues:a,updateEmployeeFormValues:u,triggerRefresh:l}=P(),[c,h]=i.useState("New Employee"),m=K({resolver:Z(Ze),defaultValues:I}),{reset:p,watch:g,setValue:T,getValues:j,handleSubmit:k,formState:{isSubmitting:w,isDirty:E,errors:F}}=m;i.useEffect(()=>{a?(h("Edit Employee"),p(We(a,I))):h("New Employee")},[a]),i.useEffect(()=>{j("all_store")?m.setValue("stores",[]):m.setValue("stores",a?.stores??[])},[g("all_store")]);const S=()=>{p(I),u(null),r.onFalse()},x=async o=>{const d=Ne(o);await qe(d).then(()=>{S(),l(),s({icon:"success",title:"Data saved successfully",description:"Saved successfully"})}).catch(C=>{C instanceof ee&&Object.keys(C.validationErrors).forEach(D=>{m.setError(D,{type:"manual",message:C.validationErrors[D][0]})})})};return e.jsx(ge,{open:r.value,fullWidth:!0,maxWidth:"md",children:e.jsxs(U,{methods:m,onSubmit:k(x),children:[e.jsx(be,{children:c}),e.jsx(ye,{sx:{overflow:"visible"},children:e.jsx(X,{sx:{pt:1,overflowY:"auto",overflowX:"hidden",maxHeight:J.dialog.maxHeight},children:e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{xs:12,children:e.jsx(V,{children:e.jsx(R,{variant:"body2",color:"GrayText",children:"Login Section"})})}),e.jsx(n,{xs:12,children:e.jsxs(Q,{spacing:2,children:[e.jsx(Le,{name:"all_store",label:"All Stores",sx:{pl:.5}}),e.jsx($,{label:"Stores",name:"stores",disableCloseOnSelect:!0,disabled:m.watch("all_store"),fetchFunction:async o=>(await Ge({keyword:o,page:1})).data,getOptionLabel:o=>o.name,isOptionEqualToValue:(o,d)=>o.id===d.id})]})}),e.jsx(n,{xs:12,md:6,children:e.jsx(f,{name:"email",label:"Email",size:"medium"})}),e.jsx(n,{xs:12,md:6,children:e.jsx(f,{name:"password",label:"Password",size:"medium",disabled:g("id")===""})}),e.jsx(n,{xs:12,children:e.jsx($,{name:"roles",label:"Roles",disableCloseOnSelect:!0,getOptionLabel:o=>o.name,fetchFunction:async o=>(await Be({keyword:o,page:1})).data,isOptionEqualToValue:(o,d)=>o.id===d.id})}),e.jsx(n,{xs:12,children:e.jsx(V,{children:e.jsx(R,{variant:"body2",color:"GrayText",children:"Profile Section"})})}),e.jsx(n,{xs:12,md:4,children:e.jsx(L,{name:"name_prefix",debounceSearch:!0,label:"Prefix",isOptionEqualToValue:(o,d)=>o?.value===d?.value,getOptionLabel:o=>o?.label,fetchFunction:async o=>await _e()})}),e.jsx(n,{xs:12,md:4,children:e.jsx(f,{name:"name",label:"Name",size:"medium"})}),e.jsx(n,{xs:12,md:4,children:e.jsx(L,{name:"name_suffix",debounceSearch:!0,label:"Suffix",isOptionEqualToValue:(o,d)=>o?.value===d?.value,getOptionLabel:o=>o?.label,fetchFunction:async()=>await je()})}),e.jsx(n,{xs:12,children:e.jsx(Ve,{row:!0,sx:{px:.2},name:"gender",label:"Gender",options:[{label:H(_.M),value:_.M},{label:H(_.F),value:_.F}]})}),e.jsx(n,{xs:12,md:6,children:e.jsx(Ie,{name:"birth_date",label:"Birth Date"})}),e.jsx(n,{xs:12,md:6,children:e.jsx(f,{name:"birth_place",label:"Birth Place",size:"medium"})}),e.jsx(n,{xs:12,children:e.jsx(f,{name:"phone",label:"Phone",size:"medium",onChange:o=>{T("phone",W(o.target.value),{shouldDirty:!0})},InputProps:{startAdornment:e.jsx(R,{sx:{pr:2},color:"text.disabled",children:"+62"})}})}),e.jsx(n,{xs:12,children:e.jsx(V,{children:e.jsx(R,{variant:"body2",color:"GrayText",children:"Address Section"})})}),e.jsx(n,{xs:12,children:e.jsx(L,{name:"wilayah",debounceSearch:!0,label:"Address",getOptionLabel:o=>o?.full_name,sx:{"& .MuiAutocomplete-popupIndicator":{transform:"none"}},popupIcon:e.jsx(v,{icon:"eva:search-fill",sx:{color:"text.disabled"}}),fetchFunction:async o=>await we({keyword:o}),isOptionEqualToValue:(o,d)=>o?.kelurahan_id===d?.kelurahan_id,filterOptions:(o,d)=>{const C=d.inputValue.toLowerCase().trim().replace(/,/g,"").split(/\s+/);return o.filter(D=>{const re=D.full_name.toLowerCase().replace(/,/g,"");return C.every(ae=>new RegExp(`\\b${ae}`,"i").test(re))})}})}),e.jsx(n,{xs:12,children:e.jsx(f,{name:"address_text",label:"Address Full",size:"medium"})}),e.jsx(n,{xs:12,children:e.jsx(f,{name:"address_description",label:"Address Description",size:"medium"})}),e.jsx(n,{xs:6,children:e.jsx(f,{name:"address_kode_pos",label:"Address Postal Code",size:"medium"})}),e.jsx(n,{xs:6,children:e.jsx(f,{name:"address_name",label:"Address Name",size:"medium"})}),e.jsx(n,{xs:12,children:e.jsx(Ae,{caption:"Fill in the form above and correct it again correctly"})})]})})}),e.jsxs(Ee,{children:[e.jsx(N,{onClick:S,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(Se,{size:"medium",type:"submit",disabled:!E,variant:"contained",loading:w,children:"Save"})]})]})})}const os={title:`Operasional - Employee - ${J.site.name}`};function Cs(){return e.jsxs(e.Fragment,{children:[e.jsx(ve,{children:e.jsxs("title",{children:[" ",os.title]})}),e.jsx(Pe,{maxWidth:"xl",children:e.jsxs(ze,{children:[e.jsx(He,{}),e.jsx(es,{}),e.jsx(ss,{})]})})]})}export{Cs as default};
