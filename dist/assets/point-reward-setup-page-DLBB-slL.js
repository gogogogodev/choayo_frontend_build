import{f as W,r as o,k as e,d as O,ag as V,n as D,q as B,v as p,g as $,t as A,S as G,F as N,ay as v,I as K,a as y,e as T,aI as b,cP as Q,cD as U,m as X,cQ as Z,cd as J,cc as Y,aw as H,az as ee,i7 as te,c6 as re,dj as ae,c8 as oe,C as L,aF as x,bZ as ne,o as se,H as ie,aE as de}from"./index-DL1FC2Xw.js";import{C as le}from"./custom-breadcrumbs-nJImJlyu.js";import{T as ce}from"./table-pagination-custom-D4L-eNU7.js";import{a as me,b as E,c as ue,T as pe}from"./TableRow-Dnp-F93Q.js";import{T as h}from"./TableCell--CDe426o.js";import{f as k}from"./format-number-CnUv9gu0.js";import{C as z}from"./errors-wZ747Yys.js";import{C as he}from"./Card-x9v4l8Wx.js";import{R as F}from"./rhf-date-picker-CcRSy6lj.js";import"./TablePagination-Cu0e8Dmj.js";import"./LastPage-CNSkhtZT.js";import"./FormControlLabel-RF8C1zCS.js";import"./DatePicker-x3rEWLr9.js";import"./ListItem-ByRhTH_M.js";import"./MobileDateTimePicker-DRzd3izO.js";const q=o.createContext(void 0),_=()=>{const r=o.useContext(q);if(r===void 0)throw new Error("useContextPage must be used within a PageContext.Provider");return r},xe=({children:r})=>{const t=W(),[a,d]=o.useState(0),n=()=>d(u=>u+1),[s,l]=o.useState(""),c=u=>{l(u)},[i,C]=o.useState(null),R=u=>{C(u)},[g,f]=o.useState(0),j=u=>{f(u)},[P,S]=o.useState(0),w=u=>{S(u)},m=o.useMemo(()=>({isDialogFormOpen:t,refreshFlag:a,triggerRefresh:n,keyword:s,updateKeyword:c,pointRewardFormValues:i,updatePointRewardFormValues:R,page:g,updatePage:j,rowsPerPage:P,updateRowsPerPage:w}),[t,a,s,i,g,P]);return e.jsx(q.Provider,{value:m,children:r})};function we(){const{checkAbilities:r}=O(),{isDialogFormOpen:t}=_();return e.jsx(le,{heading:"Point Reward Setup",links:[{name:"Others",href:"#"},{name:"Point Reward Setup",href:"#"}],action:r?.("point-reward-setup:create")&&e.jsx(V,{size:"medium",variant:"contained",onClick:t.onTrue,startIcon:e.jsx(D,{icon:"mingcute:add-line"}),children:"New Point Reward"}),sx:{mb:{xs:3,md:5}}})}const ge=B({id:p().nullable(),name:p().min(1,{message:"Name is required!"}),start_at:p().min(1,{message:"Start date is required!"}),end_at:p().min(1,{message:"End at is required!"}),description:p().min(1,{message:"Notes at is required!"}),minimal_order:p(),amount_conversion:p(),expired_date:p().min(1,{message:"Expired date is required!"})}),M={id:null,name:"",start_at:"",end_at:"",description:"",minimal_order:"0",amount_conversion:"0",expired_date:""},fe=B({keyword:p()}),je={keyword:""};function Pe(){const{keyword:r,updateKeyword:t}=_(),a=$({resolver:A(fe),defaultValues:je}),{watch:d,reset:n,handleSubmit:s}=a;o.useEffect(()=>{n({keyword:r})},[r,n]);const l=d();o.useEffect(()=>{const i=setTimeout(()=>{l.keyword===""&&t("")},300);return()=>clearTimeout(i)},[l.keyword,t]);const c=async i=>{t(i.keyword)};return e.jsx(G,{sx:{p:2.5},children:e.jsx(N,{methods:a,onSubmit:s(c),children:e.jsx(v,{size:"medium",name:"keyword",tooltipTitle:"press enter",placeholder:"Search point reward...",InputProps:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(D,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})})}function be(){const r=[{id:"event_name",label:"Event Name",width:100},{id:"period",label:"Period",width:100},{id:"expired_date",label:"Expired Date",width:100},{id:"notes",label:"Notes",width:100},{id:"amount_conversion",label:"Amount Conversion",width:100},{id:"minimal_order",label:"Minimal Order",width:100},{id:"",width:10}];return e.jsx(me,{children:e.jsx(E,{children:r.map(t=>e.jsx(h,{align:t.align||"left",sortDirection:!1,sx:{width:t.width,minWidth:0},children:t.label},t.id))})})}const _e=async({keyword:r,page:t})=>{try{return(await y.get(`${T.other.point_reward}?search=${r}&page=${t}&order_by=created_at&order_direction=desc`)).data}catch(a){throw console.error("PointRewardGetList - error : ",a),new Error("unexpected error occurred")}},Re=async r=>{try{await y.post(`${T.other.point_reward}/${r}?_method=DELETE`)}catch(t){throw console.error("PointRewardDelete - error : ",t),new Error("Oops, an error occurred while delete data!")}},Se=async r=>{try{r.id?await y.post(`${T.other.point_reward}/${r.id}?_method=PUT`,r):await y.post(`${T.other.point_reward}`,r)}catch(t){throw t.status===422?t.data&&t.data.errors?new z(t.data.errors):t:(console.error("PointRewardFormSubmit - error : ",t),new Error("Oops, an error occurred while saving data!"))}},ve=r=>({id:r.id??"",name:r.name,start_at:b(r.start_at,"YYYY-MM-DD")??"",end_at:b(r.end_at,"YYYY-MM-DD")??"",description:r.description,minimal_order:Number(r.minimal_order.replace(",","")??0),amount_conversion:Number(r.amount_conversion.replace(",","")??0),expired_date:b(r.expired_date,"YYYY-MM-DD")??""});function De({no:r,row:t}){const a=Q(),{showConfirmDialog:d}=U(),{checkAbilities:n,checkAbilitiesMultiple:s}=O(),{isDialogFormOpen:l,updatePointRewardFormValues:c,triggerRefresh:i}=_();return e.jsxs(E,{hover:!0,children:[e.jsx(h,{sx:{whiteSpace:"nowrap"},children:t.name}),e.jsx(h,{sx:{whiteSpace:"nowrap"},children:`${b(t.start_at,"DD/MM/YYYY")} - ${b(t.end_at,"DD/MM/YYYY")}`}),e.jsx(h,{sx:{whiteSpace:"nowrap"},children:t.expired_date?b(t.expired_date,"DD/MM/YYYY"):"-"}),e.jsx(h,{sx:{whiteSpace:"nowrap"},children:t.description}),e.jsx(h,{sx:{whiteSpace:"nowrap"},children:`Rp. ${k(t.amount_conversion??"0")}`}),e.jsx(h,{sx:{whiteSpace:"nowrap"},children:`Rp. ${k(t.minimal_order??"0")}`}),e.jsxs(h,{sx:{whiteSpace:"nowrap"},align:"right",children:[s?.(["point-reward-setup:delete","point-reward-setup:edit"])&&e.jsx(X,{color:a.open?"inherit":"default",onClick:a.onOpen,children:e.jsx(D,{icon:"eva:more-vertical-fill"})}),e.jsx(Z,{open:a.open,anchorEl:a.anchorEl,onClose:a.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(J,{children:[n?.("point-reward-setup:delete")&&e.jsxs(Y,{onClick:()=>{a.onClose(),d({title:"Delete PointReward",description:"Anda yakin? Data akan dihapus permanent.",confirmBtnText:"Delete",onConfirm:async()=>{await Re(t.id),i()}})},sx:{color:"error.main"},children:[e.jsx(D,{icon:"solar:trash-bin-trash-bold"}),"Delete"]}),n?.("point-reward-setup:edit")&&e.jsxs(Y,{onClick:()=>{a.onClose(),l.onTrue(),c(t)},children:[e.jsx(D,{icon:"solar:pen-bold"}),"Edit"]})]})})]})]})}function I({text:r}){return e.jsx(E,{hover:!0,children:e.jsx(h,{sx:{whiteSpace:"nowrap"},align:"center",colSpan:7,children:r})})}function Ce({rows:r,status:t}){const{page:a,rowsPerPage:d}=_();return e.jsx(ue,{children:t==="loading"?e.jsx(I,{text:"loading .."}):r.length===0?e.jsx(I,{text:"data not found"}):r.map((n,s)=>e.jsx(De,{row:n,no:(a-1)*d+s+1},n.id))})}function ye(){const{keyword:r,refreshFlag:t,updatePage:a,updateRowsPerPage:d}=_(),[n,s]=o.useState(0),[l,c]=o.useState(0),[i,C]=o.useState(15),[R,g]=o.useState([]),[f,j]=o.useState(!1),P=async()=>{j(!0),await _e({keyword:r,page:n+1}).then(m=>{g(m.data),c(m.total),s(m.current_page-1),a(m.current_page),d(i)}).finally(()=>{j(!1)})};o.useEffect(()=>{P()},[r,t,n]);const S=(m,u)=>{s(u)},w=m=>{s(0)};return e.jsxs(he,{children:[e.jsx(Pe,{}),e.jsx(H,{sx:{position:"relative"},children:e.jsx(ee,{children:e.jsxs(pe,{size:"medium",sx:{minWidth:0},children:[e.jsx(be,{}),e.jsx(Ce,{rows:R,status:f?"loading":"finish"})]})})}),e.jsx(ce,{dense:!1,page:n,count:l,rowsPerPage:15,rowsPerPageOptions:[15,25,100],onPageChange:S,onRowsPerPageChange:w})]})}function Te(){const{showSweetDialog:r}=te(),{isDialogFormOpen:t,pointRewardFormValues:a,updatePointRewardFormValues:d,triggerRefresh:n}=_(),[s,l]=o.useState("New PointReward"),c=$({resolver:A(ge),defaultValues:M}),{reset:i,handleSubmit:C,formState:{isSubmitting:R,isDirty:g}}=c;o.useEffect(()=>{a?(l("Edit Point Reward"),console.log("pointRewardFormValues",a),i({id:a.id,name:a.name,start_at:a.start_at,end_at:a.end_at,description:a.description,minimal_order:String(a.minimal_order??"0"),amount_conversion:String(a.amount_conversion??"0"),expired_date:a.expired_date??""})):l("New Point Reward")},[a]);const f=()=>{i(M),d(null),t.onFalse()},j=async P=>{const S=ve(P);await Se(S).then(()=>{f(),n(),r({icon:"success",title:"Data saved successfully",description:"Saved successfully"})}).catch(w=>{w instanceof z&&Object.keys(w.validationErrors).forEach(m=>{c.setError(m,{type:"manual",message:w.validationErrors[m][0]})})})};return e.jsx(re,{open:t.value,children:e.jsxs(N,{methods:c,onSubmit:C(j),children:[e.jsx(ae,{children:s}),e.jsx(oe,{sx:{overflow:"visible"},children:e.jsx(H,{sx:{pt:1,overflowY:"auto",overflowX:"hidden",maxHeight:L.dialog.maxHeight},children:e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{xs:12,children:e.jsx(v,{name:"name",label:"Event name",size:"medium"})}),e.jsx(x,{xs:6,children:e.jsx(F,{name:"start_at",label:"Start date"})}),e.jsx(x,{xs:6,children:e.jsx(F,{name:"end_at",label:"End date"})}),e.jsx(x,{xs:12,children:e.jsx(v,{name:"description",label:"Notes",size:"medium"})}),e.jsx(x,{xs:12,children:e.jsx(v,{name:"minimal_order",label:"Minimal Order (Rp)",fullWidth:!0,moneyFormat:!0})}),e.jsx(x,{xs:12,children:e.jsx(v,{name:"amount_conversion",label:"Amount Conversion (Rp)",fullWidth:!0,moneyFormat:!0})}),e.jsx(x,{xs:12,children:e.jsx(F,{name:"expired_date",label:"Expired date"})})]})})}),e.jsxs(ne,{children:[e.jsx(V,{onClick:f,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(se,{size:"medium",type:"submit",disabled:!g,variant:"contained",loading:R,children:"Save"})]})]})})}const Fe={title:`Others - Point Reward Setup - ${L.site.name}`};function We(){return e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:e.jsxs("title",{children:[" ",Fe.title]})}),e.jsx(de,{maxWidth:"xl",children:e.jsxs(xe,{children:[e.jsx(we,{}),e.jsx(ye,{}),e.jsx(Te,{})]})})]})}export{We as default};
