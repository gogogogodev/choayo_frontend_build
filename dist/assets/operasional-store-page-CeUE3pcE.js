import{r as i,f as B,k as e,q as D,v as r,iG as x,cC as be,d as I,iJ as R,c6 as W,dj as $,c8 as K,aw as Y,C as Z,S as se,bI as Se,c9 as ye,cb as we,ag as O,n as P,bZ as X,bH as ve,az as ae,g as J,t as Q,F as U,aF as m,iZ as Pe,ay as S,o as ne,dC as _e,cP as oe,aC as Ce,m as ie,cQ as re,cd as le,cc as V,i7 as Te,as as ke,l as Fe,i8 as De,I as Me,cD as Ae,H as Ee,aE as Ve}from"./index-DL1FC2Xw.js";import{F as ce}from"./form-caption-DFg98poz.js";import{T as ee}from"./table-body-rowinfo-yZgQl4g3.js";import{R as de}from"./rhf-autocomplete-on-enter-kdiwxQrI.js";import{C as ue}from"./errors-wZ747Yys.js";import{a as Oe,S as Ne,b as Be,c as Ie,s as Re,d as ze,e as Le,f as He,g as qe}from"./functions-_nuXFB4v.js";import{T as Ge,a as We,b as z}from"./TabPanel-Cp8S9lXE.js";import{T as me,a as he,b as N,c as xe}from"./TableRow-Dnp-F93Q.js";import{T as b}from"./TableCell--CDe426o.js";import{C as $e}from"./custom-breadcrumbs-nJImJlyu.js";import{T as Ke}from"./table-pagination-custom-D4L-eNU7.js";import{T as Ye}from"./product-table-head-C434sUSW.js";import{C as Ze}from"./Card-x9v4l8Wx.js";import"./TablePagination-Cu0e8Dmj.js";import"./LastPage-CNSkhtZT.js";import"./FormControlLabel-RF8C1zCS.js";const pe=i.createContext(void 0),_=()=>{const t=i.useContext(pe);if(t===void 0)throw new Error("useContextPage must be used within a PageContext.Provider");return t},Xe=({children:t})=>{const[a,s]=i.useState(0),n=f=>{s(f)},[o,l]=i.useState(0),c=f=>{l(f)},[d,u]=i.useState(""),j=f=>{u(f)},[g,T]=i.useState(0),F=()=>T(f=>f+1),[C,p]=i.useState(0),y=()=>p(f=>f+1),w=B(),h=B(),k=B(),[v,M]=i.useState(null),A=f=>{M(f)},[E,ge]=i.useState(null),je=f=>{ge(f)},fe=i.useMemo(()=>({page:a,updatePage:n,rowsPerPage:o,updateRowsPerPage:c,keyword:d,updateKeyword:j,refreshFlag:g,triggerRefresh:F,refreshFlagPaymentMethod:C,triggerRefreshPaymentMethod:y,isDialogFormOpen:w,isDialogPaymentMethodsOpen:h,isDialogFormPaymentMethodsOpen:k,storeFormValues:v,updateStoreFormValues:A,storePaymentMethodFormValues:E,updateStorePaymentMethodFormValues:je}),[a,o,d,g,C,w,h,k,v,E]);return e.jsx(pe.Provider,{value:fe,children:t})},Je=D({keyword:r()}),Qe={keyword:""};D({id:r(),name:r().min(1,{message:"Name is required!"})});const Ue=D({id:r().nullable(),store_cd:r().min(1,{message:"Required!"}).max(4,{message:"Max 4 char!"}).regex(/^[A-Za-z0-9]+$/,{message:"Invalid format!"}),name:r().min(1,{message:"Store Name is required!"}),address_text:r().min(1,{message:"Address full is required!"}),address_description:r().min(1,{message:"Address description is required!"}),address_kode_pos:r().min(1,{message:"Address Postal Code is required!"}),wilayah:D({kecamatan_id:r(),kelurahan_id:r(),full_name:r()})}).refine(t=>t.wilayah.kelurahan_id,{message:"Wilayah is required",path:["wilayah"]}),L={id:null,store_cd:"",name:"",address_text:"",address_description:"",address_kode_pos:"",wilayah:{kecamatan_id:"",kelurahan_id:"",full_name:""}},et=D({id:r().nullable(),store_id:r(),group_code:be(Object.values(x),{message:"invalid pickup type!"}),slug:D({slug:r(),name:r()}),account_number:r().min(1,{message:"Account Number is required!"}),account_name:r().min(1,{message:"Account Name is required!"}),coa_account:r(),branch:r(),branch_address:r(),merchant_id:r()}).refine(t=>t.slug.slug!="",{message:"Slug is required",path:["slug"]}).refine(t=>!(t.merchant_id==""&&(t.group_code===x.credit||t.group_code===x.debit)),{message:"Merchant ID is required",path:["merchant_id"]}),H={id:null,store_id:"",group_code:x.bank_transfer,slug:{slug:"",name:""},account_number:"",account_name:"",coa_account:"",branch:"",branch_address:"",merchant_id:""};function tt(){const t=[{value:x.bank_transfer,label:R(x.bank_transfer)},{value:x.credit,label:R(x.credit)},{value:x.debit,label:R(x.debit)}],{checkAbilities:a}=I(),{isDialogPaymentMethodsOpen:s,isDialogFormPaymentMethodsOpen:n,storeFormValues:o,updateStoreFormValues:l}=_(),[c,d]=i.useState(t[0].value),u=(g,T)=>{d(T)},j=()=>{l(null),s.onFalse()};return e.jsxs(W,{open:s.value,fullWidth:!0,maxWidth:"lg",children:[e.jsx($,{children:o?.name}),e.jsxs(K,{sx:{overflow:"visible"},children:[e.jsx(Y,{sx:{pt:1,overflowY:"auto",overflowX:"hidden",maxHeight:Z.dialog.maxHeight},children:e.jsx(Ge,{value:c,children:e.jsxs(se,{spacing:2,alignItems:"start",children:[e.jsx(We,{onChange:u,sx:{width:"100%",boxShadow:g=>`inset 0 -2px 0 0 ${Se(g.vars.palette.grey["500Channel"],.08)}`,[`& .${we.scrollButtons}`]:{"&.Mui-disabled":{opacity:.3}}},children:t.map(g=>e.jsx(ye,{value:g.value,label:g.label},g.value))}),a?.("store-payment-method:create")&&e.jsx(O,{size:"medium",variant:"contained",onClick:n.onTrue,startIcon:e.jsx(P,{icon:"mingcute:add-line"}),children:"New Data"}),e.jsx(z,{value:x.bank_transfer,sx:{p:0,width:"100%"},children:e.jsx(q,{paymentMethodGroup:x.bank_transfer})}),e.jsx(z,{value:x.credit,sx:{p:0,width:"100%"},children:e.jsx(q,{paymentMethodGroup:x.credit})}),e.jsx(z,{value:x.debit,sx:{p:0,width:"100%"},children:e.jsx(q,{paymentMethodGroup:x.debit})})]})})}),e.jsx(ot,{payment_method_group:c})]}),e.jsx(X,{children:e.jsx(O,{onClick:j,variant:"outlined",color:"inherit",children:"Close"})})]})}function q({paymentMethodGroup:t}){const{storeFormValues:a,refreshFlagPaymentMethod:s}=_(),n=B(!0),[o,l]=i.useState([]),c=()=>{n.onTrue(),Ne(a?.id??"",t).then(d=>{l(d.data)}).finally(()=>{n.onFalse()})};return i.useEffect(()=>{c()},[t,s]),e.jsx(ve,{sx:{position:"relative",overflow:"hidden"},children:e.jsx(ae,{children:e.jsxs(me,{size:"medium",sx:{minWidth:0},children:[e.jsx(st,{}),e.jsx(at,{rows:o,status:n.value?"loading":"finish"})]})})})}const G=[{id:"no",label:"No",width:"5%"},{id:"slug",label:"Slug",width:"20%",align:"center"},{id:"account_name",label:"Account Name",width:"20%",align:"center"},{id:"account_number",label:"Account Number",width:"20%",align:"center"},{id:"is_active",label:"Status",width:"20%",align:"center"},{id:"action",label:"",width:"55%",align:"center"}];function st(){return e.jsx(he,{children:e.jsx(N,{children:G.map(t=>e.jsx(b,{align:t.align||"left",sortDirection:!1,sx:{width:t.width,minWidth:0},children:t.label},t.id))})})}function at({rows:t,status:a}){return e.jsx(xe,{children:a==="loading"?e.jsx(ee,{colspan:G.length,text:"loading .."}):t.length===0?e.jsx(ee,{colspan:G.length,text:"data not found"}):t.map((s,n)=>e.jsx(nt,{row:s,no:n+1},n))})}function nt({no:t,row:a}){const s=oe(),{checkAbilities:n,checkAbilitiesMultiple:o}=I(),{isDialogFormPaymentMethodsOpen:l,updateStorePaymentMethodFormValues:c}=_();return e.jsxs(N,{hover:!0,children:[e.jsx(b,{sx:{whiteSpace:"nowrap"},children:t}),e.jsx(b,{sx:{whiteSpace:"nowrap"},align:"center",children:a.slug}),e.jsx(b,{sx:{whiteSpace:"nowrap"},align:"center",children:a.account_name}),e.jsx(b,{sx:{whiteSpace:"nowrap"},align:"center",children:a.account_number}),e.jsx(b,{sx:{whiteSpace:"nowrap"},align:"center",children:e.jsx(Ce,{variant:"soft",color:a.is_active&&"success"||!a.is_active&&"secondary"||"default",children:a.is_active?"active":"in-active"})}),e.jsxs(b,{sx:{whiteSpace:"nowrap"},align:"right",children:[o?.(["store-payment-method:edit"])&&e.jsx(ie,{color:s.open?"inherit":"default",onClick:s.onOpen,children:e.jsx(P,{icon:"eva:more-vertical-fill"})}),e.jsx(re,{open:s.open,anchorEl:s.anchorEl,onClose:s.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsx(le,{children:n?.("store-payment-method:edit")&&e.jsxs(V,{onClick:()=>{s.onClose(),l.onTrue(),c(a)},children:[e.jsx(P,{icon:"solar:pen-bold"}),"Edit"]})})})]})]})}function ot({payment_method_group:t}){const{isDialogFormPaymentMethodsOpen:a,storeFormValues:s,storePaymentMethodFormValues:n,updateStorePaymentMethodFormValues:o,triggerRefreshPaymentMethod:l}=_(),[c,d]=i.useState("New Payment"),u=J({resolver:Q(et),defaultValues:H}),{reset:j,watch:g,setValue:T,getValues:F,handleSubmit:C,formState:{isSubmitting:p,isDirty:y,errors:w}}=u;i.useEffect(()=>{n?(d("Edit Payment"),j(Oe(n))):(d("New Payment"),j({...H,group_code:t,store_id:s?.id}))},[n,t]);const h=()=>{j(H),o(null),a.onFalse()},k=async v=>{const M=Be(v);await Ie(M).then(()=>{h(),l(),_e.success("Data saved successfully!",{position:"top-center"})}).catch(A=>{A instanceof ue&&Object.keys(A.validationErrors).forEach(E=>{u.setError(E,{type:"manual",message:A.validationErrors[E][0]})})})};return e.jsx(W,{open:a.value,fullWidth:!0,maxWidth:"sm",children:e.jsxs(U,{methods:u,onSubmit:C(k),children:[e.jsx($,{children:c}),e.jsx(K,{sx:{overflow:"visible"},children:e.jsx(Y,{sx:{pt:1,overflowY:"auto",overflowX:"hidden",maxHeight:Z.dialog.maxHeight},children:e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{xs:12,children:e.jsx(de,{name:"slug",label:"Slug",getOptionLabel:v=>v?.name,fetchFunction:async v=>await Pe(),isOptionEqualToValue:(v,M)=>v?.slug===M?.slug})}),e.jsx(m,{xs:12,md:6,children:e.jsx(S,{name:"account_number",label:"Account Number",size:"medium"})}),e.jsx(m,{xs:12,md:6,children:e.jsx(S,{name:"account_name",label:"Account Name",size:"medium"})}),e.jsx(m,{xs:12,md:6,children:e.jsx(S,{name:"coa_account",label:"Coa Account",size:"medium"})}),e.jsx(m,{xs:12,md:6,children:e.jsx(S,{name:"branch",label:"Branch",size:"medium"})}),e.jsx(m,{xs:12,md:6,children:e.jsx(S,{name:"branch_address",label:"Branch Address",size:"medium"})}),e.jsx(m,{xs:12,md:6,children:e.jsx(S,{name:"merchant_id",label:"Merchant Id",size:"medium"})}),e.jsx(m,{xs:12,children:e.jsx(ce,{caption:"Fill in the form above and correct it again correctly"})})]})})}),e.jsxs(X,{children:[e.jsx(O,{onClick:h,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(ne,{size:"medium",type:"submit",disabled:!y,variant:"contained",loading:p,children:"Save"})]})]})})}function it(){const{checkAbilities:t}=I(),{isDialogFormOpen:a}=_();return e.jsx($e,{heading:"Store",links:[{name:"Operasional",href:"#"},{name:"Store",href:"#"}],action:t?.("store:create")&&e.jsx(O,{size:"medium",variant:"contained",onClick:a.onTrue,startIcon:e.jsx(P,{icon:"mingcute:add-line"}),children:"New Store"}),sx:{mb:{xs:3,md:5}}})}function rt(){const{showSweetDialog:t}=Te(),{isDialogFormOpen:a,storeFormValues:s,updateStoreFormValues:n,triggerRefresh:o}=_(),[l,c]=i.useState("New Store"),d=J({resolver:Q(Ue),defaultValues:L}),{reset:u,handleSubmit:j,formState:{isSubmitting:g,isDirty:T}}=d;i.useEffect(()=>{s?(c("Edit Store"),u({id:s.id,store_cd:s.store_cd??"",name:s.name,address_text:s.address?.text??"",address_description:s.address?.description??"",address_kode_pos:s.address?.kode_pos??"0",wilayah:s.address?{kecamatan_id:String(s.address.kecamatan_id??""),kelurahan_id:String(s.address.kelurahan_id??""),full_name:String(s.address.full_name??"")}:L.wilayah})):c("New Store")},[s]);const F=()=>{u(L),n(null),a.onFalse()},C=async p=>{const y=Re(p);await ze(y).then(()=>{F(),o(),t({icon:"success",title:"Data saved successfully",description:"Saved successfully"})}).catch(w=>{w instanceof ue&&Object.keys(w.validationErrors).forEach(h=>{d.setError(h,{type:"manual",message:w.validationErrors[h][0]})})})};return e.jsx(W,{open:a.value,children:e.jsxs(U,{methods:d,onSubmit:j(C),children:[e.jsx($,{children:l}),e.jsx(K,{sx:{overflow:"visible"},children:e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{xs:3,children:e.jsx(S,{name:"store_cd",label:"Code",size:"medium",disabled:s!==null})}),e.jsx(m,{xs:9,children:e.jsx(S,{name:"name",label:"Name",size:"medium"})}),e.jsx(m,{xs:12,children:e.jsx(ke,{children:e.jsx(Fe,{variant:"body2",color:"GrayText",children:"Address Section"})})}),e.jsx(m,{xs:12,children:e.jsx(de,{name:"wilayah",label:"Address",debounceSearch:!0,getOptionLabel:p=>p?.full_name,sx:{"& .MuiAutocomplete-popupIndicator":{transform:"none"}},popupIcon:e.jsx(P,{icon:"eva:search-fill",sx:{color:"text.disabled"}}),isOptionEqualToValue:(p,y)=>p?.kelurahan_id===y?.kelurahan_id,fetchFunction:async p=>De({keyword:p}),filterOptions:(p,y)=>{const w=y.inputValue.toLowerCase().trim().replace(/,/g,"").split(/\s+/);return p.filter(h=>{const k=h.full_name.toLowerCase().replace(/,/g,"");return w.every(v=>new RegExp(`\\b${v}`,"i").test(k))})}})}),e.jsx(m,{xs:12,children:e.jsx(S,{name:"address_text",label:"Address Full",size:"medium"})}),e.jsx(m,{xs:12,children:e.jsx(S,{name:"address_description",label:"Address Description",size:"medium"})}),e.jsx(m,{xs:12,children:e.jsx(S,{name:"address_kode_pos",label:"Address Postal Code",size:"medium"})}),e.jsx(m,{xs:12,children:e.jsx(ce,{caption:"Fill in the form above and correct it again correctly"})})]})}),e.jsxs(X,{children:[e.jsx(O,{onClick:F,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(ne,{size:"medium",type:"submit",disabled:!T,variant:"contained",loading:g,children:"Save"})]})]})})}function lt(){const{keyword:t,updateKeyword:a}=_(),s=J({resolver:Q(Je),defaultValues:Qe}),{watch:n,reset:o,handleSubmit:l}=s;i.useEffect(()=>{o({keyword:t})},[t,o]);const c=n();i.useEffect(()=>{const u=setTimeout(()=>{c.keyword===""&&a("")},300);return()=>clearTimeout(u)},[c.keyword,a]);const d=async u=>{a(u.keyword)};return e.jsx(se,{sx:{p:2.5},children:e.jsx(U,{methods:s,onSubmit:l(d),children:e.jsx(S,{size:"medium",name:"keyword",tooltipTitle:"press enter",placeholder:"Search store...",InputProps:{startAdornment:e.jsx(Me,{position:"start",children:e.jsx(P,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})})}const ct=[{id:"no",label:"No",width:10},{id:"code",label:"Code",width:100},{id:"name",label:"Name",width:100},{id:"",width:10}];function dt(){return e.jsx(he,{children:e.jsx(N,{children:ct.map(t=>e.jsx(b,{align:t.align||"left",sortDirection:!1,sx:{width:t.width,minWidth:0},children:t.label},t.id))})})}function ut({no:t,row:a}){const s=oe(),{showConfirmDialog:n}=Ae(),{checkAbilities:o,checkAbilitiesMultiple:l}=I(),{isDialogFormOpen:c,isDialogPaymentMethodsOpen:d,updateStoreFormValues:u,triggerRefresh:j}=_();return e.jsxs(N,{hover:!0,children:[e.jsx(b,{sx:{whiteSpace:"nowrap"},children:t}),e.jsx(b,{sx:{whiteSpace:"nowrap"},children:a.store_cd??"-"}),e.jsx(b,{sx:{whiteSpace:"nowrap"},children:a.name}),e.jsxs(b,{sx:{whiteSpace:"nowrap"},align:"right",children:[l?.(["store:delete","store:activate","store:edit"])&&e.jsx(ie,{color:s.open?"inherit":"default",onClick:s.onOpen,children:e.jsx(P,{icon:"eva:more-vertical-fill"})}),e.jsx(re,{open:s.open,anchorEl:s.anchorEl,onClose:s.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(le,{children:[o?.("store:delete")&&e.jsxs(V,{onClick:()=>{s.onClose(),n({title:"Delete Store",description:"Anda yakin? Data akan dihapus permanent.",confirmBtnText:"Delete",onConfirm:async()=>{await Le(a.id),j()}})},sx:{color:"error.main"},children:[e.jsx(P,{icon:"solar:trash-bin-trash-bold"}),"Delete"]}),o?.("store:edit")&&e.jsxs(V,{onClick:()=>{s.onClose(),c.onTrue(),u(a)},children:[e.jsx(P,{icon:"solar:pen-bold"}),"Edit"]}),o?.("store:activate")&&e.jsxs(V,{onClick:()=>{s.onClose(),n({title:"Non-Activate Store",description:"Anda yakin? Menonaktifkan toko ini.",confirmBtnText:"Non-Activate",onConfirm:async()=>{await He(a.id),j()}})},sx:{color:"warning.main"},children:[e.jsx(P,{icon:"mi:unlock"}),"Non-Activate"]}),o?.("store-payment-method:view")&&e.jsxs(V,{onClick:()=>{s.onClose(),d.onTrue(),u(a)},sx:{color:"info.main"},children:[e.jsx(P,{icon:"fluent:payment-28-regular"}),"Payment Methods"]})]})})]})]})}function te({text:t}){return e.jsx(N,{hover:!0,children:e.jsx(b,{sx:{whiteSpace:"nowrap"},align:"center",colSpan:Ye.length,children:t})})}function mt({rows:t,status:a}){const{page:s,rowsPerPage:n}=_();return e.jsx(xe,{children:a==="loading"?e.jsx(te,{text:"loading .."}):t.length===0?e.jsx(te,{text:"data not found"}):t.map((o,l)=>e.jsx(ut,{row:o,no:(s-1)*n+l+1},o.id))})}function ht(){const{keyword:t,refreshFlag:a,updatePage:s,updateRowsPerPage:n}=_(),[o,l]=i.useState(0),[c,d]=i.useState(0),[u,j]=i.useState(15),[g,T]=i.useState([]),[F,C]=i.useState(!1),p=async()=>{C(!0),await qe({keyword:t,page:o+1}).then(h=>{T(h.data),d(h.total),l(h.current_page-1),s(h.current_page),n(u)}).finally(()=>{C(!1)})};i.useEffect(()=>{p()},[t,a,o]);const y=(h,k)=>{l(k)},w=h=>{l(0)};return e.jsxs(Ze,{children:[e.jsx(lt,{}),e.jsx(Y,{sx:{position:"relative"},children:e.jsx(ae,{children:e.jsxs(me,{size:"medium",sx:{minWidth:0},children:[e.jsx(dt,{}),e.jsx(mt,{rows:g,status:F?"loading":"finish"})]})})}),e.jsx(Ke,{dense:!1,page:o,count:c,rowsPerPage:15,rowsPerPageOptions:[15,25,100],onPageChange:y,onRowsPerPageChange:w})]})}const xt={title:`Operasional - Store - ${Z.site.name}`};function Mt(){return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{children:e.jsxs("title",{children:[" ",xt.title]})}),e.jsx(Ve,{maxWidth:"xl",children:e.jsxs(Xe,{children:[e.jsx(it,{}),e.jsx(ht,{}),e.jsx(rt,{}),e.jsx(tt,{})]})})]})}export{Mt as default};
