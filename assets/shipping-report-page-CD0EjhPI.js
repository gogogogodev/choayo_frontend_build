import{r as n,fC as P,k as e,c as V,p as L,L as H,aI as b,aZ as O,aC as W,iz as y,q as v,v as _,a as z,e as A,d as q,f as G,g as N,t as K,S as M,F as U,aF as S,aU as Z,dg as Y,ag as F,n as C,o as J,dC as Q,aw as X,az as ee,H as te,C as ae,aE as se}from"./index-DtP58muJ.js";import{C as ne}from"./custom-breadcrumbs-C-JLSHAz.js";import{T as re}from"./table-pagination-custom-DoMFqUCQ.js";import{a as oe,b as $,c as ie,T as le}from"./TableRow-BeGZSEnl.js";import{T as m}from"./TableCell-BYy3h6md.js";import{T as E}from"./table-body-rowinfo-3iCgRhmq.js";import{R as k}from"./rhf-date-picker-CTkMAX-z.js";import{a as de}from"./functions-CuWmdxMV.js";import{C as ce}from"./Card-DhhypByC.js";import"./TablePagination-DcwzPYld.js";import"./LastPage-CTPAXkYQ.js";import"./FormControlLabel-aYt4PlDo.js";import"./DatePicker-C3EXuF80.js";import"./ListItem-B8SR2-3G.js";import"./MobileDateTimePicker-CzOngS04.js";import"./errors-wZ747Yys.js";const I=n.createContext(void 0),D=()=>{const a=n.useContext(I);if(a===void 0)throw new Error("useContextSearch must be used within a PageContext.Provider");return a},he=({children:a})=>{const[t,r]=n.useState(0),o=()=>r(s=>s+1),[i,l]=n.useState({store:{id:"all",name:""},start_date:`${P("YYYY-MM")}-01`,end_date:`${P("YYYY-MM-DD")}`}),c=s=>{l(s)},[h,p]=n.useState(0),f=s=>{p(s)},[u,g]=n.useState(0),j=s=>{g(s)},x=n.useMemo(()=>({refreshFlag:t,triggerRefresh:o,toolbarSearchValue:i,updateToolbarSearchValue:c,page:h,updatePage:f,rowsPerPage:u,updateRowsPerPage:j}),[t,i,h,u]);return e.jsx(I.Provider,{value:x,children:a})};function pe(){return e.jsx(ne,{heading:"Shipping Report",links:[{name:"Reports",href:"#"},{name:"Shipping",href:"#"}],sx:{mb:{xs:3,md:5}}})}const T=[{id:"shipping_id",label:"Shipping ID",width:"20%"},{id:"customer_name",label:"Customer",width:"20%"},{id:"received_date",label:"Received Date",width:"20%"},{id:"received_by",label:"Received By",width:"20%"},{id:"status",label:"Status",width:"20%"}];function ue(){return e.jsx(oe,{children:e.jsx($,{children:T.map(a=>e.jsx(m,{align:a.align||"left",sortDirection:!1,sx:{width:a.width,minWidth:0},children:a.label},a.id))})})}function ge({no:a,row:t}){const r=V(),o=n.useCallback(i=>{r.push(`${L.dashboard.transaction.shipping.details(i)}`)},[r]);return e.jsxs($,{hover:!0,children:[e.jsx(m,{sx:{whiteSpace:"nowrap"},children:e.jsx(H,{color:"inherit",onClick:()=>o(t.id),underline:"always",sx:{cursor:"pointer"},children:t.shipping_no})}),e.jsx(m,{sx:{whiteSpace:"nowrap"},children:t.customer_name}),e.jsx(m,{sx:{whiteSpace:"nowrap"},children:t.received_date?b(Number(t.received_date),O.dateTime):"-"}),e.jsx(m,{sx:{whiteSpace:"nowrap"},children:t.received_by?t.received_by:"-"}),e.jsx(m,{sx:{whiteSpace:"nowrap"},children:e.jsx(W,{variant:"soft",color:t.status===y.draft&&"warning"||t.status===y.progress&&"info"||t.status===y.success&&"success"||"default",children:t.status})})]})}function xe({rows:a,status:t}){const{page:r,rowsPerPage:o}=D();return e.jsx(ie,{children:t==="loading"?e.jsx(E,{text:"loading ..",colspan:T.length}):a.length===0?e.jsx(E,{text:"data not found",colspan:T.length}):a.map((i,l)=>e.jsx(ge,{row:i,no:(r-1)*o+l+1},l))})}const me=v({store:v({id:_(),name:_()}).nullable(),start_date:_(),end_date:_()}).refine(a=>!(a.end_date&&!a.start_date),{message:"Start date is required",path:["start_date"]}),B={store:null,start_date:`${P("YYYY-MM")}-01`,end_date:P("YYYY-MM-DD")},fe=async a=>{try{const t=b(a.start_date,"YYYY-M-D"),r=b(a.end_date,"YYYY-M-D"),o=await z.get(`${A.report.shipping}?start_at=${t}&end_at=${r}&store_id=${a.store?.id??""}&mode=url`);window.open(o.data,"__blank")}catch(t){throw console.error("ShippingReportDownload - error : ",t),new Error("something wrong")}};function je(){const{loginInfo:a}=q(),{triggerRefresh:t,updateToolbarSearchValue:r}=D(),o=G(!1),[i,l]=n.useState([]);n.useEffect(()=>{a&&l(a.stores)},[a]);const c=N({resolver:K(me),defaultValues:B}),{reset:h,handleSubmit:p,formState:{isDirty:f}}=c,u=async s=>{r(s),t()},g=async()=>{h(B),r(null),t()},j=async s=>{o.onTrue(),await fe(s).finally(()=>{o.onFalse()})},x=async s=>{s.start_date?.message&&Q.warning(s.start_date?.message,{position:"top-center"})};return e.jsx(M,{sx:{p:2.5},children:e.jsx(U,{methods:c,children:e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{xs:12,lg:3,children:e.jsx(Z,{options:i,name:"store",label:"Store",getOptionKey:s=>s.id,getOptionLabel:s=>s.name,isOptionEqualToValue:(s,d)=>s.id===d.id})}),e.jsx(S,{xs:12,lg:3,children:e.jsx(k,{name:"start_date",label:"Start Date",hideErrorMessage:!0})}),e.jsx(S,{xs:12,lg:3,children:e.jsx(k,{name:"end_date",label:"End Date"})}),e.jsx(S,{xs:12,lg:3,children:e.jsxs(M,{spacing:2,direction:"row",sx:{height:"100%",alignItems:"stretch"},children:[e.jsx(Y,{title:"reset",arrow:!0,children:e.jsx("span",{style:{display:"flex",flex:1},children:e.jsx(F,{fullWidth:!0,onClick:g,variant:"outlined",color:"warning",sx:{height:"100%"},children:e.jsx(C,{icon:"system-uicons:reset-alt"})})})}),e.jsx(Y,{title:"search",arrow:!0,children:e.jsx("span",{style:{display:"flex",flex:1},children:e.jsx(F,{fullWidth:!0,onClick:p(u,x),variant:"outlined",color:"info",sx:{height:"100%"},children:e.jsx(C,{icon:"material-symbols:search-rounded"})})})}),e.jsx(Y,{title:"download",arrow:!0,children:e.jsx("span",{style:{display:"flex",flex:1},children:e.jsx(J,{onClick:p(j,x),fullWidth:!0,size:"medium",type:"submit",variant:"outlined",loading:o.value,sx:{height:"100%"},children:e.jsx(C,{icon:"material-symbols:download"})})})})]})})]})})})}function Se(){const{refreshFlag:a,toolbarSearchValue:t}=D(),[r,o]=n.useState(0),[i,l]=n.useState(0),[c,h]=n.useState(15),[p,f]=n.useState([]),[u,g]=n.useState(!1),j=async()=>{if(t===null)f([]);else{g(!0);const d=b(t.start_date,"YYYY-MM-DD"),w=b(t.end_date,"YYYY-MM-DD");await de({page:r+1,start_date:d?`${d} 00:00:01`:"",end_date:w?`${w} 23:59:59`:"",store_id:t.store?.id??"all"}).then(R=>{f(R.data),l(R.total),o(R.current_page-1)}).finally(()=>{g(!1)})}};n.useEffect(()=>{j()},[t,a,r]);const x=(d,w)=>{o(w)},s=d=>{h(parseInt(d.target.value,10)),o(0)};return e.jsxs(ce,{children:[e.jsx(je,{}),e.jsx(X,{sx:{position:"relative"},children:e.jsx(ee,{children:e.jsxs(le,{size:"medium",sx:{minWidth:0},children:[e.jsx(ue,{}),e.jsx(xe,{rows:p,status:u?"loading":"finish"})]})})}),e.jsx(re,{dense:!1,page:r,count:i,rowsPerPage:c,rowsPerPageOptions:[15,25,100],onPageChange:x,onRowsPerPageChange:s})]})}const be={title:`Reports - Shipping Report - ${ae.site.name}`};function Ie(){return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsxs("title",{children:[" ",be.title]})}),e.jsx(se,{maxWidth:"xl",children:e.jsxs(he,{children:[e.jsx(pe,{}),e.jsx(Se,{})]})})]})}export{Ie as default};
