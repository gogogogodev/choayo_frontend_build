import{k as e,ax as k,cx as W,aw as N,cy as I,cz as O,cL as B,l as P,r as h,aM as R,fA as Q,aF as a,S as v,bH as X,aC as J,iX as w,j0 as K,ay as f,aA as C,aU as A,is as Y,iV as $,a_ as E,j1 as Z,aW as ee,ij as F,j2 as L,c as se,i7 as ae,f as M,g as te,t as re,F as ie,o as oe,iw as ne,p as q,H as le,C as ce,aE as ue}from"./index-DtP58muJ.js";import{V as me,b as he,P as de}from"./schemas-B_3toXYO.js";import{u as z}from"./use-params-x5Ny5RF3.js";import{C as xe}from"./errors-wZ747Yys.js";import{b as _e,C as pe}from"./functions-CtLgfECa.js";import{f as ge}from"./product-icon-P7cd-ly2.js";import{R as T}from"./rhf-autocomplete-checkboxes-DzCsowBl.js";import{R as G}from"./rhf-radio-group-BrOd8CM7.js";import{a as y}from"./rhf-checkbox-DPISWm_F.js";import{R as U}from"./rhf-date-picker-CTkMAX-z.js";import{C as fe}from"./functions-BjzhM4yz.js";import{g as je}from"./functions-BO07r0AC.js";import{c as ve,d as be,e as ye,f as Ve}from"./functions-D1MMkUMs.js";import{S}from"./Skeleton-2yIQyMsS.js";import{C as we}from"./custom-breadcrumbs-C-JLSHAz.js";import{C as De}from"./Card-DhhypByC.js";import"./RadioGroup-xNsl4cpV.js";import"./FormGroup-BxqFH-77.js";import"./FormControlLabel-aYt4PlDo.js";import"./DatePicker-C3EXuF80.js";import"./ListItem-B8SR2-3G.js";import"./MobileDateTimePicker-CzOngS04.js";function Fe(){return e.jsx(k,{component:W,children:e.jsxs(N,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mt:{xs:5,sm:10},mb:{xs:5,sm:10}},children:[e.jsx(I.div,{variants:O().in,children:e.jsx(B,{sx:{mb:{xs:3,sm:8}}})}),e.jsx(I.div,{variants:O().in,children:e.jsx(P,{variant:"h5",sx:{color:"text.secondary"},children:"Sorry, page not found!"})})]})})}function Se(){const[s,o]=h.useState(0),n=R(),{formState:{defaultValues:d}}=n,{fields:_}=Q({control:n.control,name:"voucher_items"});return e.jsx(a,{xs:12,children:e.jsx(v,{spacing:2,children:_.map((b,t)=>{const m=n.watch(`voucher_items.${t}.type`),V=d?.voucher_items?.[t]?.type,j=n.watch(`voucher_items.${t}.has_voucher_max`),p=n.watch(`voucher_items.${t}.all_item_targets`),D=d?.voucher_items?.[t]?.has_voucher_max,r=d?.voucher_items?.[t]?.all_item_targets,l=d?.voucher_items?.[t]?.voucher_max_value,u=d?.voucher_items?.[t]?.voucher_item_targets,g=i=>i?.map((c,Oe)=>({id:c?.id??"",targetable_id:c?.targetable_id??"",voucher_item_id:c?.voucher_item_id??"",targetable_type:c?.targetable_type??"",targetable_data:{id:c?.targetable_data?.id??"",name:c?.targetable_data?.name??""}}))??[],x=i=>i.map(c=>({id:"",voucher_item_id:"",targetable_id:"",targetable_type:"",targetable_data:{id:c.id,name:c.name}}));return h.useEffect(()=>{j!==D?n.setValue(`voucher_items.${t}.voucher_max_value`,"0"):n.setValue(`voucher_items.${t}.voucher_max_value`,l??"0")},[j]),h.useEffect(()=>{m!==V||p!=r?n.setValue(`voucher_items.${t}.voucher_item_targets`,[]):n.setValue(`voucher_items.${t}.voucher_item_targets`,g(u)),o(i=>i+1)},[m,p]),e.jsx(X,{sx:{p:2,border:i=>`solid 2px ${i.vars.palette.background.neutral}`},children:e.jsxs(a,{container:!0,spacing:3,children:[e.jsx(a,{xs:12,order:1,children:e.jsx(J,{children:"Voucher Items"})}),e.jsx(a,{xs:12,order:2,children:e.jsx(G,{row:!0,sx:{px:.2},label:"Type",name:`voucher_items.${t}.type`,options:Object.values(w).map(i=>({label:K(i),value:i}))})}),e.jsx(a,{xs:12,md:8,order:3,display:"flex",alignItems:"center",children:e.jsx(P,{color:"text.main",children:"Nominal"})}),e.jsx(a,{xs:12,md:4,order:{xs:6,md:4},children:e.jsx(y,{name:`voucher_items.${t}.has_voucher_max`,label:"Has Max Nominal"})}),e.jsx(a,{xs:6,md:5,order:{xs:4,md:5},children:e.jsx(f,{name:`voucher_items.${t}.voucher_value`,label:"Value",size:"medium",moneyFormat:n.watch(`voucher_items.${t}.voucher_type`)===C.absolute,fullWidth:!0})}),e.jsx(a,{xs:6,md:3,order:{xs:5,md:6},children:e.jsx(A,{name:`voucher_items.${t}.voucher_type`,label:"Type",options:Object.values(C),getOptionLabel:Y,onChange:(i,c)=>n.setValue(`voucher_items.${t}.voucher_type`,c,{shouldDirty:!0})})}),e.jsx(a,{xs:12,md:4,order:7,children:e.jsx(f,{disabled:!n.watch(`voucher_items.${t}.has_voucher_max`),name:`voucher_items.${t}.voucher_max_value`,label:"Value",size:"medium",moneyFormat:n.watch(`voucher_items.${t}.voucher_max_type`)===C.absolute,fullWidth:!0})}),e.jsx(a,{xs:12,order:8,children:e.jsx(v,{spacing:{xs:3,md:2},children:e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{pl:.5},label:"All Items Target",name:`voucher_items.${t}.all_item_targets`,disabled:m===w.shipping}),e.jsx(T,{label:"Items Target",disableCloseOnSelect:!0,refreshTrigger:s,name:`voucher_items.${t}.voucher_item_targets`,disabled:p||m===w.shipping,fetchFunction:async i=>{if(m===w.product){const c=await ge({keyword:i,page:1});return x(c.data)}else if(m===w.add_ons){const c=await _e({keyword:i,page:1});return x(c.data)}else if(m===w.category){const c=await pe({keyword:i,page:1});return x(c.data)}return[]},getOptionLabel:i=>i.targetable_data.name,isOptionEqualToValue:(i,c)=>i.targetable_data.id===c.targetable_data.id})]})})})]})},t)})})})}function Ce(){const s=R(),{formState:{defaultValues:o}}=s;o?.usage;const n=s.watch("all_stores"),d=o?.customers,_=s.watch("all_customers"),b=s.watch("has_usage_limit"),t=s.watch("is_unlimited_qty"),m=o?.voucher_stores,V=s.watch("has_min_transaction"),j=r=>r?.map(l=>({store_id:l?.store_id??"",voucher_id:l?.voucher_id??"",store:{id:l?.store?.id??"",name:l?.store?.name??""}}))??[],p=r=>({limit:r?.limit??"0",duration:r?.duration??"",unit:r?.unit??$.day}),D=r=>r?.map(l=>({id:l?.id??"",name:l?.name??""}))??[];return h.useEffect(()=>{n!==o?.all_stores?s.setValue("voucher_stores",[]):s.setValue("voucher_stores",j(m))},[n]),h.useEffect(()=>{t!==o?.is_unlimited_qty?s.setValue("qty","0"):s.setValue("qty",o?.qty??"0")},[t]),h.useEffect(()=>{b!==o?.has_usage_limit?s.setValue("usage",p(void 0)):s.setValue("usage",p(o?.usage))},[b]),h.useEffect(()=>{V!==o?.has_min_transaction?s.setValue("min_transaction.value","0"):s.setValue("min_transaction.value",o?.min_transaction?.value??"0")},[V]),h.useEffect(()=>{_!==o?.all_customers?s.setValue("customers",[]):s.setValue("customers",D(d))},[_]),e.jsxs(e.Fragment,{children:[e.jsx(a,{xs:12,spacing:1,children:e.jsxs(v,{spacing:2,children:[e.jsx(y,{name:"all_stores",label:"All Stores",sx:{pl:.5}}),e.jsx(T,{label:"Stores",name:"voucher_stores",disableCloseOnSelect:!0,disabled:s.watch("all_stores"),fetchFunction:async r=>(await je({keyword:r,page:1})).data.map(u=>({voucher_id:"",store_id:"",store:{id:u.id,name:u.name||""}})),getOptionLabel:r=>r.store.name,isOptionEqualToValue:(r,l)=>r.store.id===l.store.id})]})}),e.jsx(a,{xs:12,md:6,children:e.jsx(f,{name:"name",label:"Name",size:"medium"})}),e.jsx(a,{xs:12,md:6,children:e.jsx(f,{name:"code",label:"Code",size:"medium"})}),e.jsx(a,{xs:12,md:6,children:e.jsx(U,{name:"start_at",label:"Period Start",minDate:E()})}),e.jsx(a,{xs:12,md:6,children:e.jsx(U,{name:"end_at",label:"Period End",minDate:E(s.watch("start_at"))})}),e.jsx(a,{xs:12,children:e.jsxs(v,{spacing:2,children:[e.jsx(y,{name:"is_unlimited_qty",label:"Unlimited Quota",sx:{pl:.5}}),e.jsxs(a,{container:!0,spacing:5,children:[e.jsx(a,{xs:12,md:6,children:e.jsx(f,{name:"qty",label:"Quota",size:"medium",disabled:s.watch("is_unlimited_qty"),fullWidth:!0})}),e.jsx(a,{xs:12,md:6,children:e.jsx(f,{name:"description",label:"Description",size:"medium",multiline:!0,rows:4})})]})]})}),e.jsx(a,{xs:12,children:e.jsxs(v,{spacing:2,children:[e.jsx(y,{name:"has_usage_limit",label:"Has Usage Limit",sx:{pl:.5}}),e.jsxs(a,{container:!0,spacing:5,children:[e.jsx(a,{xs:12,md:6,children:e.jsx(f,{name:"usage.limit",label:"Usage Limit",size:"medium",disabled:!s.watch("has_usage_limit"),fullWidth:!0})}),e.jsx(a,{xs:6,md:3,children:e.jsx(f,{name:"usage.duration",label:"Usage Duration",size:"medium",disabled:!s.watch("has_usage_limit"),fullWidth:!0})}),e.jsx(a,{xs:6,md:3,children:e.jsx(A,{name:"usage.unit",label:"Usage Unit",disabled:!s.watch("has_usage_limit"),options:Object.values($),getOptionLabel:r=>Z(r),onChange:(r,l)=>s.setValue("usage.unit",l,{shouldDirty:!0})})})]})]})}),e.jsx(a,{xs:12,md:6,children:e.jsxs(v,{spacing:2,children:[e.jsx(y,{name:"has_min_transaction",label:"Has Minimum Transaction",sx:{pl:.5}}),e.jsx(f,{name:"min_transaction.value",label:"Min Transaction Value",size:"medium",disabled:!s.watch("has_min_transaction"),fullWidth:!0,moneyFormat:s.watch("min_transaction.type")===C.absolute})]})}),e.jsx(a,{xs:12,md:6,children:e.jsxs(v,{spacing:2,pt:{md:.5},children:[e.jsx(ee,{component:"legend",sx:{typography:"body2",color:"inherit"},children:"Hide Voucher"}),e.jsx(G,{row:!0,name:"type",options:[{label:L(F.private),value:F.private},{label:L(F.public),value:F.public}]})]})}),e.jsx(a,{xs:12,children:e.jsxs(v,{spacing:2,children:[e.jsx(y,{name:"all_customers",label:"All Customers",sx:{pl:.5}}),e.jsx(T,{label:"Customers",name:"customers",disableCloseOnSelect:!0,disabled:s.watch("all_customers"),getOptionLabel:r=>r.name,isOptionEqualToValue:(r,l)=>r.id===l.id,fetchFunction:async r=>(await fe({keyword:r,page:1})).data})]})})]})}function Ee(){const s=se(),{voucher_id:o=""}=z(),{showSweetDialog:n}=ae(),d=M(!1),_=M(!0),b=te({resolver:re(he),defaultValues:me}),{handleSubmit:t,formState:{isSubmitting:m,isDirty:V},setValue:j,watch:p,reset:D}=b;h.useEffect(()=>{const u=p((g,{name:x})=>{x==="start_at"&&E(String(g.start_at)).isAfter(String(g.end_at))&&j("end_at",String(g.start_at)),x==="all_stores"&&j("voucher_stores",[])});return()=>u.unsubscribe()},[p,j]);const r=async()=>{_.onTrue(),await ve(o).then(async u=>{const g=await be(u);D(g)}).catch(u=>{u.status===404&&d.onTrue()}).finally(()=>{_.onFalse()})};h.useEffect(()=>{o&&o!=="new"?r():_.onFalse()},[o]);const l=async u=>{const g=ye(u);await Ve(g).then(async()=>{n({icon:"success",title:"Data saved successfully",description:"Saved successfully"}),o==="new"?(await ne(1e3),s.push(`${q.dashboard.others.voucher_management.main}`)):r()}).catch(x=>{x instanceof xe&&Object.keys(x.validationErrors).forEach(i=>{b.setError(i,{type:"manual",message:x.validationErrors[i][0]})})})};return e.jsx(ie,{methods:b,onSubmit:t(l),children:_.value?e.jsxs(a,{container:!0,spacing:3,children:[e.jsx(a,{xs:12,children:e.jsx(S,{variant:"rounded",sx:{width:"100%",height:60}})}),e.jsx(a,{xs:12,children:e.jsx(S,{variant:"rounded",sx:{width:"100%",height:60}})}),e.jsx(a,{xs:6,children:e.jsx(S,{variant:"rounded",sx:{width:"100%",height:60}})}),e.jsx(a,{xs:6,children:e.jsx(S,{variant:"rounded",sx:{width:"100%",height:60}})})]}):d.value?e.jsx(Fe,{}):e.jsxs(a,{container:!0,spacing:5,children:[e.jsx(Ce,{}),e.jsx(Se,{}),e.jsx(a,{xs:12,children:e.jsx(oe,{fullWidth:!0,size:"large",type:"submit",disabled:!V,variant:"contained",loading:m,children:"Save Voucher"})})]})})}const H=[{name:"Others",href:"#"},{name:"Voucher Management",href:q.dashboard.others.voucher_management.main}];function Te(){const{voucher_id:s=""}=z(),o="Voucher Management",n=h.useMemo(()=>s?[...H,s==="new"?{name:"New",href:"#"}:{name:"Edit",href:"#"}]:H,[s]);return e.jsx(we,{heading:o,links:n,sx:{mb:{xs:3,md:5}}})}const Ie={title:`Others - Voucher Management - ${ce.site.name}`};function ss(){return e.jsxs(e.Fragment,{children:[e.jsx(le,{children:e.jsx("title",{children:Ie.title})}),e.jsx(ue,{maxWidth:"xl",children:e.jsxs(de,{children:[e.jsx(Te,{}),e.jsx(De,{sx:{p:3},children:e.jsx(Ee,{})})]})})]})}export{ss as default};
