import{c as ce,r as l,p as K,k as e,S as D,l as Q,aC as de,iA as pe,iz as S,bE as he,ag as y,cP as ue,cD as Z,m as me,n as W,cQ as ge,cd as xe,cc as fe,i7 as G,f as P,c6 as J,dj as U,c8 as ee,aw as M,C as q,bH as je,az as te,bZ as ie,iw as A,aY as we,g as Se,t as be,F as De,aF as H,ay as Ie,o as se,h as Ce,iB as Pe,H as ye,aE as ve}from"./index-DtP58muJ.js";import{u as f,c as O,d as Te,P as _e}from"./schemas-DYd3kpf0.js";import{u as V}from"./use-params-x5Ny5RF3.js";import{C as ke}from"./custom-breadcrumbs-C-JLSHAz.js";import{T as ae}from"./table-pagination-custom-DoMFqUCQ.js";import{c as Fe,d as Re,e as Be,f as Ee,g as Le,h as He,i as Oe,j as We,W as Ae,M as $e}from"./functions-CuWmdxMV.js";import{S as Y}from"./Skeleton-2yIQyMsS.js";import{a as ze,b as N,c as ne,T as oe}from"./TableRow-BeGZSEnl.js";import{T as p}from"./TableCell-BYy3h6md.js";import{T as k}from"./table-body-rowinfo-3iCgRhmq.js";import{f as re}from"./format-number-Ds7vlrjD.js";import{T as Ge}from"./table-head-custom-CkAC_7gM.js";import{T as Me}from"./table-selected-action-06aluIIx.js";import{C as qe}from"./errors-wZ747Yys.js";import{F as Ve}from"./form-caption-DmEucZqR.js";import{C as Ne}from"./Card-DhhypByC.js";import"./TablePagination-DcwzPYld.js";import"./LastPage-CTPAXkYQ.js";import"./FormControlLabel-aYt4PlDo.js";const X=[{name:"Transaction",href:"#"},{name:"Shipping",href:K.dashboard.transaction.shipping.main}];function Qe(){const t=ce(),{shipping_id:i=""}=V(),a="Shipping",s=l.useMemo(()=>i?[...X,{name:"Detail",href:"#"}]:X,[i]);return e.jsx(ke,{links:s,heading:a,sx:{mb:{xs:3,md:5}},backButton:()=>t.push(`${K.dashboard.transaction.shipping.main}`)})}function Ye(t){const{isDialogImportOpen:i}=f();return e.jsx(D,{spacing:3,sx:{p:2.5},children:t.status=="loading"?e.jsx(e.Fragment,{children:e.jsxs(D,{spacing:2,children:[e.jsx(Y,{variant:"rectangular",width:200,height:30}),e.jsx(Y,{variant:"rectangular",width:"100%",height:40})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(D,{spacing:2,direction:"row",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Q,{variant:"h6",children:t?.shippingDetail?.shipping_no}),e.jsx(de,{variant:"soft",color:t.shippingDetail?.status===S.draft&&"warning"||t.shippingDetail?.status===S.progress&&"info"||t.shippingDetail?.status===S.success&&"success"||"default",children:pe(t.shippingDetail?.status??S.draft)})]}),e.jsxs(D,{spacing:1,children:[e.jsx(Q,{variant:"subtitle2",children:"Customer"}),e.jsxs(D,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(he,{fullWidth:!0,disabled:!0,value:t.shippingDetail?.customer_name??"-"}),e.jsx(y,{variant:"outlined",onClick:i.onTrue,sx:{py:1.6,height:"100%",minWidth:"max-content"},disabled:t.shippingDetail?.status===S.success,children:"Import Order"})]})]})]})})}const $=[{id:"order_id",label:"Order ID",width:100},{id:"item",label:"Item",width:100},{id:"total_price",label:"Price",width:100},{id:"quantity",label:"Quantity",width:100},{id:"brand",label:"Brand",width:100},{id:"color",label:"Color",width:100},{id:"",width:10}];function Xe(){return e.jsx(ze,{children:e.jsx(N,{children:$.map(t=>e.jsx(p,{align:t.align||"left",sortDirection:!1,sx:{width:t.width,minWidth:0},children:t.label},t.id))})})}function Ke({no:t,row:i,shippingDetail:a}){const s=ue(),{showConfirmDialog:c}=Z(),{triggerRefresh:n,updateRowsPerPage:d}=f();return e.jsxs(N,{hover:!0,children:[e.jsx(p,{sx:{whiteSpace:"nowrap"},children:i.order_no}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:i.product}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:`Rp. ${re(Number(i.product_price??"0"))}`}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:i.qty}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:i.brand??"-"}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:i.color??"-"}),e.jsxs(p,{sx:{whiteSpace:"nowrap"},align:"right",children:[e.jsx(me,{color:s.open?"inherit":"default",onClick:s.onOpen,disabled:a?.status===S.success,children:e.jsx(W,{icon:"eva:more-vertical-fill"})}),e.jsx(ge,{open:s.open,anchorEl:s.anchorEl,onClose:s.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsx(xe,{children:e.jsxs(fe,{onClick:()=>{s.onClose(),c({title:"Delete Item",description:"Anda yakin? Data akan dihapus permanent.",confirmBtnText:"Delete",onConfirm:async()=>{await Fe(i.order_product_id??""),n()}})},sx:{color:"error.main"},children:[e.jsx(W,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})})})]})]})}function Ze({rows:t,status:i,shippingDetail:a}){const{page:s,rowsPerPage:c}=f();return e.jsx(ne,{children:i==="loading"?e.jsx(k,{text:"loading ..",colspan:$.length}):t.length===0?e.jsx(k,{text:"data not found",colspan:$.length}):t.map((n,d)=>e.jsx(Ke,{shippingDetail:a,row:n,no:(s-1)*c+d+1},d))})}function Je(t){const{showSweetDialog:i}=G(),{showConfirmDialog:a}=Z(),{isDialogImportOpen:s,selectedItemImport:c,updateSelectedItemImport:n,triggerRefreshDetailItems:d}=f(),[o,g]=l.useState(0),[j,I]=l.useState(0),w=P(!1),x=P(!0),[u,b]=l.useState(5),[v,C]=l.useState([]),[m,T]=l.useState([]),F=async()=>{x.onTrue(),await A(1e3),await Re(t.shippingDetail?.customer_id??"").then(h=>{I(h.length),T(h),C(h.slice(0,u))}).finally(()=>{x.onFalse()})};l.useEffect(()=>{s.value&&t.shippingDetail&&F()},[s.value,t.shippingDetail]),l.useEffect(()=>{const h=o*u,r=h+u;C(m.slice(h,r))},[o,u,m]);const R=(h,r)=>{g(r)},B=h=>{b(parseInt(h.target.value,10)),g(0)},_=()=>{s.onFalse(),n([]),T([]),C([])},E=async()=>{if(t.shippingDetail){w.onTrue(),console.log(t.shippingDetail);const h=Be(t.shippingDetail,c);await Ee(h).then(()=>{_(),i({icon:"success",title:"Data saved successfully",description:"Saved successfully"})}).finally(()=>w.onFalse())}},L=()=>{a({title:"Import Item",description:`Anda yakin? (${c.length}) item akan diimport.`,confirmBtnText:"Import",onConfirm:async()=>{await E(),d()}})};return e.jsxs(J,{open:s.value,fullWidth:!0,maxWidth:"md",children:[e.jsx(U,{children:"List Order"}),e.jsx(ee,{sx:{overflow:"visible"},children:e.jsxs(M,{sx:{pt:1,overflowY:"auto",overflowX:"hidden",maxHeight:q.dialog.maxHeight},children:[e.jsxs(je,{sx:{position:"relative",overflow:"hidden"},children:[e.jsx(et,{listItem:m}),e.jsx(te,{children:e.jsxs(oe,{size:"medium",sx:{minWidth:0},children:[e.jsx(Ue,{listItem:m}),e.jsx(tt,{listItem:v,status:x.value?"loading":"finish"})]})})]}),e.jsx(ae,{dense:!1,page:o,count:j,rowsPerPage:u,rowsPerPageOptions:[5],onPageChange:R,onRowsPerPageChange:B})]})}),e.jsxs(ie,{children:[e.jsx(y,{onClick:_,variant:"outlined",color:"inherit",children:"Close"}),e.jsx(y,{variant:"contained",onClick:L,disabled:c.length===0,children:"Import"})]})]})}const z=[{id:"order_id",label:"Order ID",width:100},{id:"item",label:"Item",width:100},{id:"total_price",label:"Price",width:100},{id:"quantity",label:"Quantity",width:100},{id:"brand",label:"Brand",width:100},{id:"color",label:"Color",width:100}];function Ue({listItem:t}){const{selectedItemImport:i,updateSelectedItemImport:a}=f();return e.jsx(Ge,{headLabel:z,rowCount:t.length,numSelected:i.length,onSelectAllRows:s=>{a(s?t:[])}})}function et({listItem:t}){const{selectedItemImport:i,updateSelectedItemImport:a}=f();return e.jsx(Me,{rowCount:t.length,numSelected:i.length,onSelectAllRows:s=>{a(s?t:[])}})}function tt({listItem:t,status:i}){const{selectedItemImport:a,updateSelectedItemImport:s}=f(),c=n=>{if(a.find(o=>o.order_product_id===n)){const o=a.filter(g=>g.order_product_id!==n);s(o)}else{const o=t.find(g=>g.order_product_id===n);o&&s([...a,o])}};return e.jsx(ne,{children:i==="loading"?e.jsx(k,{text:"loading ..",colspan:z.length+1}):t.length===0?e.jsx(k,{text:"data not found",colspan:z.length+1}):t.map((n,d)=>e.jsx(it,{item:n,onSelectRow:()=>c(n.order_product_id),selected:!!a.find(o=>o.order_product_id===n.order_product_id)},d))})}function it({no:t,item:i,selected:a,onSelectRow:s}){return e.jsxs(N,{hover:!0,children:[e.jsx(p,{padding:"checkbox",children:e.jsx(we,{checked:a,onClick:s,inputProps:{id:`row-checkbox-${i.order_product_id}`,"aria-label":"Row checkbox"}})}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:i.order_no}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:i.product}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:`Rp. ${re(Number(i.product_price))}`}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:i.qty}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:i.brand}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:i.color})]})}function st(){const{shipping_id:t=""}=V(),{showSweetDialog:i}=G(),{isDialogCompletingOpen:a,triggerRefreshDetail:s}=f(),c=Se({resolver:be(Te),defaultValues:O}),{reset:n,handleSubmit:d,formState:{isSubmitting:o,isDirty:g}}=c;l.useEffect(()=>{t!==""&&n({...O,shipping_id:t})},[t]);const j=()=>{n(O),a.onFalse()},I=async w=>{const x=Le(w);await He(x).then(async u=>{j(),s(),i({icon:"success",title:"Data saved successfully",description:"Saved successfully"})}).catch(u=>{u instanceof qe&&Object.keys(u.validationErrors).forEach(b=>{c.setError(b,{type:"manual",message:u.validationErrors[b][0]})})})};return e.jsx(J,{open:a.value,children:e.jsxs(De,{methods:c,onSubmit:d(I),children:[e.jsx(U,{children:"Completing Shipping"}),e.jsx(ee,{sx:{overflow:"visible"},children:e.jsx(M,{sx:{pt:1,overflowY:"auto",overflowX:"hidden",maxHeight:q.dialog.maxHeight},children:e.jsxs(H,{container:!0,spacing:3,children:[e.jsx(H,{xs:12,children:e.jsx(Ie,{label:"Received By",name:"received_by",size:"medium"})}),e.jsx(H,{xs:12,children:e.jsx(Ve,{caption:"Fill in the form above and correct it again correctly"})})]})})}),e.jsxs(ie,{children:[e.jsx(y,{onClick:j,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(se,{size:"medium",type:"submit",disabled:!g,variant:"contained",loading:o,children:"Save"})]})]})})}function at(){const{shipping_id:t=""}=V(),{refreshFlagDetail:i,refreshFlagDetailItems:a,updatePage:s,updateRowsPerPage:c,isDialogCompletingOpen:n}=f(),d=P(!1),o=P(!0),{showSweetDialog:g}=G(),j=P(!0),I=Ce("mobile-websocket-key"),[w,x]=l.useState(0),[u,b]=l.useState(0),[v,C]=l.useState(15),[m,T]=l.useState(null),[F,R]=l.useState([]),B=async()=>{o.onTrue(),await A(2e3),await Oe(t).then(r=>{T(r)}).finally(()=>{o.onFalse()})};l.useEffect(()=>{(i>0||t!=="")&&B()},[i,t]);const _=async()=>{j.onTrue(),await A(2e3),await We({shipping_id:t,page:w+1}).then(r=>{b(r.total),x(r.current_page-1),R(r.data),s(r.current_page),c(v)}).finally(()=>{j.onFalse()})};l.useEffect(()=>{_()},[a,w]);const E=(r,le)=>{x(le)},L=r=>{C(parseInt(r.target.value,10)),x(0)},h=async()=>{d.onTrue(),Pe()?(await Ae(m?.id??""),d.onFalse()):await $e({key:I,id:m?.id??""}).then(r=>{g({title:"Print Shipping Success!",icon:"success",description:r.message})}).catch(r=>console.error(r)).finally(async()=>{d.onFalse()})};return e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{children:[e.jsx(Ye,{shippingDetail:m,status:o.value?"loading":"finish"}),e.jsx(M,{sx:{position:"relative"},children:e.jsx(te,{children:e.jsxs(oe,{size:"medium",sx:{minWidth:0},children:[e.jsx(Xe,{}),e.jsx(Ze,{shippingDetail:m,rows:F,status:j.value?"loading":"finish"})]})})}),e.jsx(ae,{dense:!1,page:w,count:u,rowsPerPage:v,rowsPerPageOptions:[15,25,100],onPageChange:E,onRowsPerPageChange:L})]}),e.jsxs(D,{spacing:3,mt:3,direction:"row",justifyContent:"end",children:[e.jsx(se,{variant:"outlined",onClick:h,loading:d.value,startIcon:e.jsx(W,{icon:"subway:print"}),sx:{py:1.6,height:"100%",minWidth:"max-content"},children:"Print"}),e.jsx(y,{variant:"contained",onClick:n.onTrue,sx:{py:1.6,height:"100%",minWidth:"max-content"},disabled:m?.status===S.success,children:"Complete Shipping"})]}),e.jsx(Je,{shippingDetail:m}),e.jsx(st,{})]})}const nt={title:`Transaction - Shipping - ${q.site.name}`};function Pt(){return e.jsxs(e.Fragment,{children:[e.jsx(ye,{children:e.jsxs("title",{children:[" ",nt.title]})}),e.jsx(ve,{maxWidth:"xl",children:e.jsxs(_e,{children:[e.jsx(Qe,{}),e.jsx(at,{})]})})]})}export{Pt as default};
