import{r as c,k as e,a as E,e as I,aF as m,ax as O,cx as D,aw as b,cy as F,cz as S,cA as U,S as d,l as i,cB as n,q as H,v as P,cC as B,cD as V,g as G,t as L,F as W,ay as N,ag as _,A as M,bH as q,as as z,cE as K,f as g,C as T,ch as J,bI as Q,cF as X,aC as Y,cG as Z,cH as ee,H as te}from"./index-CtazL8yi.js";import{u as re}from"./use-params-Bum5sHW6.js";import{a as R,C as $}from"./errors-wZ747Yys.js";import{S as j}from"./Skeleton-fN5wJ-1g.js";import{C}from"./Card-DTCuhoee.js";const A=c.createContext(void 0),p=()=>{const t=c.useContext(A);if(t===void 0)throw new Error("useContextPage must be used within a PageContext.Provider");return t},se=({children:t})=>{const[r,l]=c.useState(0),s=()=>l(x=>x+1),[a,u]=c.useState(null),h=x=>{u(x)},o=c.useMemo(()=>({refreshFlag:r,triggerRefresh:s,productSurveyFeedback:a,productSurveyFeedbackSet:h}),[r,a]);return e.jsx(A.Provider,{value:o,children:t})},ae=async t=>{try{return(await E.get(`${I.product_survey.confirm_survey}/${t}`)).data}catch(r){throw r.status===404?new R(r.data):(console.error("ProductSurveyFeedbackGet - error : ",r),new Error("something wrong"))}},ne=async t=>{try{await E.post(`${I.product_survey.user_feedback}`,t)}catch(r){if(r.status===422){if(r.data&&r.data.errors)throw new $(r.data.errors)}else throw console.error("ProductSurveyFeedbackSubmit - error : ",r),new Error("Oops, an error occurred while saving data!")}},oe=t=>({order_product_id:t.order_product_id,feedback_status:t.feedback_status,feedback_notes:t.feedback_notes});function ie(){return e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{xs:12,children:e.jsx(j,{variant:"rounded",sx:{width:"100%",height:236}})}),e.jsx(m,{xs:12,sm:7,children:e.jsx(j,{variant:"rounded",sx:{width:"100%",height:236}})}),e.jsx(m,{xs:12,sm:5,children:e.jsx(j,{variant:"rounded",sx:{width:"100%",height:236}})})]})}function ce(){return e.jsx(O,{component:D,children:e.jsxs(b,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(F.div,{variants:S().in,children:e.jsx(U,{sx:{mt:{xs:5,sm:10},mb:{xs:3,sm:8}}})}),e.jsx(F.div,{variants:S().in,children:e.jsx(d,{spacing:2,alignItems:"center",children:e.jsx(i,{variant:"h5",sx:{color:"text.secondary"},children:"Ups, data not found"})})})]})})}const de=H({order_product_id:P(),feedback_status:B(Object.values(n),{message:"invalid survey feedback status!"}),feedback_notes:P().min(1,"feedback wajib diisi").max(255,"maksimal 255 huruf")}),w={order_product_id:"",feedback_status:n.approved,feedback_notes:""};function le(){const{showConfirmDialog:t}=V(),{productSurveyFeedback:r,triggerRefresh:l}=p(),s=G({resolver:L(de),defaultValues:w}),{setValue:a,reset:u,handleSubmit:h,formState:{isDirty:o}}=s;c.useEffect(()=>{r&&u({...w,order_product_id:r.order_product_id,feedback_notes:r.feedback_notes})},[r]);const x=async f=>{await ne(oe(f)).then(()=>{l()}).catch(v=>{v instanceof $&&Object.keys(v.validationErrors).forEach(y=>{s.setError(y,{type:"manual",message:v.validationErrors[y][0]})})})},k=f=>{a("feedback_status",f),t({description:`Anda yakin? ${f===n.approved?"Proses akan dilanjutkan":"Proses tidak akan dilanjutkan"}`,title:f===n.approved?"Approve Item":"Reject Item",confirmBtnText:f===n.approved?"Approve":"Reject",onConfirm:h(x)})};return e.jsx(W,{methods:s,children:e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{xs:12,children:e.jsx(N,{name:"feedback_notes",label:"Feedback",disabled:r?.status!==n.need_confirmation,multiline:!0,rows:4})}),e.jsx(m,{xs:12,children:e.jsxs(d,{spacing:1,direction:"row",justifyContent:"end",children:[e.jsx(_,{variant:"outlined",color:"error",disabled:!o,onClick:()=>k(n.rejected),children:"Reject"}),e.jsx(_,{variant:"contained",color:"primary",disabled:!o,onClick:()=>k(n.approved),children:"Approve"})]})})]})})}function ue(){const{productSurveyFeedback:t}=p();return e.jsxs(d,{spacing:3,children:[t?.status!==n.need_confirmation&&e.jsx(M,{severity:"info",children:"Terimakasih atas feedback anda. Produk akan diproses sesuai dengan catatan yang diberikan."}),e.jsxs(b,{children:[e.jsx(i,{variant:"h6",children:`Hi, ${t?.customer_name}`}),e.jsx(i,{variant:"subtitle2",color:"text.disabled",fontWeight:300,children:"Konfirmasi item bermasalah"})]})]})}function xe(){const{productSurveyFeedback:t}=p();return e.jsx(q,{sx:{p:2,border:r=>`dashed 2px ${r.vars.palette.background.neutral}`},children:e.jsxs(d,{spacing:2,children:[e.jsxs(d,{children:[e.jsx(i,{variant:"subtitle2",children:"Note:"}),e.jsx(i,{variant:"subtitle2",color:"text.disabled",fontWeight:300,children:t?.production_note==""?"- - - -":t?.production_note})]}),t?.files.length==0?e.jsx(e.Fragment,{}):e.jsx(z,{sx:{borderStyle:"dashed",bgcolor:"grey.200"}}),e.jsx(he,{})]})})}function he(){const{productSurveyFeedback:t}=p();return!t||t.files.length===0?e.jsx(e.Fragment,{}):e.jsx(b,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"flex-start"},children:t.files.map((r,l)=>e.jsx(b,{sx:{flex:"0 0 60px",display:"inline-flex"},children:e.jsx(me,{url:r.url??"",name:r.original_name??"",extention:r.extention??""})},r.url??l))})}function me({url:t,name:r,extention:l}){const{openPicture:s}=K(),a=g(!0),[u,h]=c.useState(`${T.site.basePath}/assets/icons/files/ic-folder.svg`),o=async()=>{a.onTrue(),await X(t,r,`image/${l}`).then(x=>{h(URL.createObjectURL(x))}).catch(()=>{}).finally(()=>{a.onFalse()})};return c.useEffect(()=>{o()},[]),a.value?e.jsx(j,{variant:"rounded",sx:{width:60,height:60}}):e.jsx(e.Fragment,{children:e.jsx(J,{isObjUrl:!0,imageView:!0,file:u,onClick:()=>s(u),sx:{width:60,height:60,cursor:"pointer",border:x=>`solid 1px ${Q(x.vars.palette.grey["500Channel"],.16)}`}})})}function fe(){const{productSurveyFeedback:t}=p();return e.jsxs(d,{spacing:5,children:[e.jsxs(d,{alignItems:"center",children:[e.jsx(i,{variant:"h6",children:"Item Order Confirmation"}),e.jsx(i,{variant:"h6",color:"text.disabled",children:t?.order_no}),e.jsx(Y,{sx:{mt:.5},variant:"soft",color:ee(t?.status??n.normal),children:Z(t?.status??n.normal)})]}),e.jsxs(d,{alignItems:"center",children:[e.jsx(i,{variant:"subtitle2",children:t?.product_name}),e.jsx(i,{variant:"subtitle2",fontWeight:100,color:"text.disabled",children:t?.email}),e.jsxs(i,{variant:"subtitle2",fontWeight:100,color:"text.disabled",children:[e.jsx(b,{component:"span",color:"black",children:"Alamat: "}),t?.customer_address.text]})]})]})}function pe(){const{order_product_id:t=""}=re(),{refreshFlag:r,productSurveyFeedbackSet:l}=p(),s=g(!1),a=g(!1),u=async h=>{s.onTrue(),await ae(h).then(o=>{l(o)}).catch(o=>{o instanceof R&&a.onTrue()}).finally(()=>{s.onFalse()})};return c.useEffect(()=>{t!==""&&u(t)},[t]),c.useEffect(()=>{r>0&&u(t)},[r]),e.jsx(d,{spacing:3,sx:{p:3},children:s.value?e.jsx(ie,{}):e.jsx(e.Fragment,{children:a.value?e.jsx(ce,{}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{}),e.jsx(C,{sx:{p:3},children:e.jsxs(d,{spacing:6,children:[e.jsx(fe,{}),e.jsx(xe,{})]})}),e.jsx(C,{sx:{p:3},children:e.jsx(le,{})})]})})})}const be={title:`Product Survey Feedback - ${T.site.name}`};function Fe(){return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsxs("title",{children:[" ",be.title]})}),e.jsx(se,{children:e.jsx(pe,{})})]})}export{Fe as default};
