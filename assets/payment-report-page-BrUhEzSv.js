import{r as n,fC as _,k as e,c as V,p as H,aI as P,aZ as L,aC as O,iy as b,q as D,v as y,a as W,e as A,d as N,f as q,g as z,t as G,S as v,F as K,aF as w,aU as U,dg as R,ag as M,n as Y,o as Z,dC as J,aw as Q,az as X,H as ee,C as te,aE as ae}from"./index-DtP58muJ.js";import{C as se}from"./custom-breadcrumbs-C-JLSHAz.js";import{T as ne}from"./table-pagination-custom-DoMFqUCQ.js";import{a as oe,b as k,c as re,T as ie}from"./TableRow-BeGZSEnl.js";import{T as i}from"./TableCell-BYy3h6md.js";import{T as F}from"./table-body-rowinfo-3iCgRhmq.js";import{f as S}from"./format-number-Ds7vlrjD.js";import{R as E}from"./rhf-date-picker-CTkMAX-z.js";import{d as le}from"./functions-CH5u1xRj.js";import{C as de}from"./Card-DhhypByC.js";import"./TablePagination-DcwzPYld.js";import"./LastPage-CTPAXkYQ.js";import"./FormControlLabel-aYt4PlDo.js";import"./DatePicker-C3EXuF80.js";import"./ListItem-B8SR2-3G.js";import"./MobileDateTimePicker-CzOngS04.js";const B=n.createContext(void 0),C=()=>{const a=n.useContext(B);if(a===void 0)throw new Error("useContextSearch must be used within a PageContext.Provider");return a},ce=({children:a})=>{const[t,o]=n.useState(0),r=()=>o(s=>s+1),[l,d]=n.useState({store:{id:"all",name:""},start_date:`${_("YYYY-MM")}-01`,end_date:`${_("YYYY-MM-DD")}`}),u=s=>{d(s)},[h,m]=n.useState(0),f=s=>{m(s)},[p,x]=n.useState(0),j=s=>{x(s)},g=n.useMemo(()=>({refreshFlag:t,triggerRefresh:r,toolbarSearchValue:l,updateToolbarSearchValue:u,page:h,updatePage:f,rowsPerPage:p,updateRowsPerPage:j}),[t,l,h,p]);return e.jsx(B.Provider,{value:g,children:a})};function ue(){return e.jsx(se,{heading:"Payment Report",links:[{name:"Reports",href:"#"},{name:"Payment",href:"#"}],sx:{mb:{xs:3,md:5}}})}const T=[{id:"no_kwitansi",label:"Receipt number",width:"10%"},{id:"payment_received",label:"Received Date",width:"10%"},{id:"amount",label:"Amount",width:"10%"},{id:"deposit",label:"Deposit",width:"10%"},{id:"point",label:"Point",width:"10%"},{id:"total",label:"Total",width:"10%"},{id:"payment_method",label:"Payment Method"},{id:"status",label:"Status",width:"10%"}];function he(){return e.jsx(oe,{children:e.jsx(k,{children:T.map(a=>e.jsx(i,{align:a.align||"left",sortDirection:!1,sx:{width:a.width,minWidth:0},children:a.label},a.id))})})}function me({no:a,row:t}){const o=V();return n.useCallback(r=>{o.push(`${H.dashboard.transaction.shipping.details(r)}`)},[o]),e.jsxs(k,{hover:!0,children:[e.jsx(i,{sx:{whiteSpace:"nowrap"},children:t.no_kwitansi}),e.jsx(i,{sx:{whiteSpace:"nowrap"},children:P(t.paid_at,L.dateTime)}),e.jsx(i,{sx:{whiteSpace:"nowrap"},children:`Rp. ${S(t.amount)}`}),e.jsx(i,{sx:{whiteSpace:"nowrap"},children:`Rp. ${S(t.deposit_amount)}`}),e.jsx(i,{sx:{whiteSpace:"nowrap"},children:`Rp. ${S(t.point_amount)}`}),e.jsx(i,{sx:{whiteSpace:"nowrap"},children:`Rp. ${S(Number(t.amount)+Number(t.deposit_amount)+Number(t.point_amount))}`}),e.jsx(i,{sx:{whiteSpace:"nowrap"},children:t.payment_method}),e.jsx(i,{sx:{whiteSpace:"nowrap"},children:e.jsx(O,{variant:"soft",color:t.status===b.success&&"success"||t.status===b.pending&&"warning"||t.status===b.expired&&"error"||t.status===b.cancel&&"default"||t.status===b.cancel&&"error"||"default",children:t.status})})]})}function pe({rows:a,status:t}){const{page:o,rowsPerPage:r}=C();return e.jsx(re,{children:t==="loading"?e.jsx(F,{text:"loading ..",colspan:T.length}):a.length===0?e.jsx(F,{text:"data not found",colspan:T.length}):a.map((l,d)=>e.jsx(me,{row:l,no:(o-1)*r+d+1},d))})}const xe=D({store:D({id:y(),name:y()}).nullable(),start_date:y(),end_date:y()}).refine(a=>!(a.end_date&&!a.start_date),{message:"Start date is required",path:["start_date"]}),$={store:null,start_date:`${_("YYYY-MM")}-01`,end_date:_("YYYY-MM-DD")},ge=async a=>{try{const t=P(a.start_date,"YYYY-M-D"),o=P(a.end_date,"YYYY-M-D"),r=await W.get(`${A.report.payment}?start_at=${t}&end_at=${o}&store_id=${a.store?.id??""}&mode=url`);window.open(r.data,"__blank")}catch(t){throw console.error("PaymentReportDownload - error : ",t),new Error("something wrong")}};function fe(){const{loginInfo:a}=N(),{triggerRefresh:t,updateToolbarSearchValue:o}=C(),r=q(!1),[l,d]=n.useState([]);n.useEffect(()=>{a&&d(a.stores)},[a]);const u=z({resolver:G(xe),defaultValues:$}),{reset:h,handleSubmit:m,formState:{isDirty:f}}=u,p=async s=>{o(s),t()},x=async()=>{h($),o(null),t()},j=async s=>{r.onTrue(),await ge(s).finally(()=>{r.onFalse()})},g=async s=>{s.start_date?.message&&J.warning(s.start_date?.message,{position:"top-center"})};return e.jsx(v,{sx:{p:2.5},children:e.jsx(K,{methods:u,children:e.jsxs(w,{container:!0,spacing:2,children:[e.jsx(w,{xs:12,lg:3,children:e.jsx(U,{options:l,name:"store",label:"Store",getOptionKey:s=>s.id,getOptionLabel:s=>s.name,isOptionEqualToValue:(s,c)=>s.id===c.id})}),e.jsx(w,{xs:12,lg:3,children:e.jsx(E,{name:"start_date",label:"Start Date",hideErrorMessage:!0})}),e.jsx(w,{xs:12,lg:3,children:e.jsx(E,{name:"end_date",label:"End Date"})}),e.jsx(w,{xs:12,lg:3,children:e.jsxs(v,{spacing:2,direction:"row",sx:{height:"100%",alignItems:"stretch"},children:[e.jsx(R,{title:"reset",arrow:!0,children:e.jsx("span",{style:{display:"flex",flex:1},children:e.jsx(M,{fullWidth:!0,onClick:x,variant:"outlined",color:"warning",sx:{height:"100%"},children:e.jsx(Y,{icon:"system-uicons:reset-alt"})})})}),e.jsx(R,{title:"search",arrow:!0,children:e.jsx("span",{style:{display:"flex",flex:1},children:e.jsx(M,{fullWidth:!0,onClick:m(p,g),variant:"outlined",color:"info",sx:{height:"100%"},children:e.jsx(Y,{icon:"material-symbols:search-rounded"})})})}),e.jsx(R,{title:"download",arrow:!0,children:e.jsx("span",{style:{display:"flex",flex:1},children:e.jsx(Z,{onClick:m(j,g),fullWidth:!0,size:"medium",type:"submit",variant:"outlined",loading:r.value,sx:{height:"100%"},children:e.jsx(Y,{icon:"material-symbols:download"})})})})]})})]})})})}function je(){const{refreshFlag:a,toolbarSearchValue:t}=C(),[o,r]=n.useState(0),[l,d]=n.useState(0),[u,h]=n.useState(15),[m,f]=n.useState([]),[p,x]=n.useState(!1),j=async()=>{t===null?f([]):(x(!0),await le({page:o+1,start_date:P(t.start_date,"YYYY-MM-DD")??"",end_date:P(t.end_date,"YYYY-MM-DD")??"",store_id:t.store?.id??"all"}).then(c=>{f(c.data),d(c.total),r(c.current_page-1)}).finally(()=>{x(!1)}))};n.useEffect(()=>{j()},[t,a,o]);const g=(c,I)=>{r(I)},s=c=>{h(parseInt(c.target.value,10)),r(0)};return e.jsxs(de,{children:[e.jsx(fe,{}),e.jsx(Q,{sx:{position:"relative"},children:e.jsx(X,{children:e.jsxs(ie,{size:"medium",sx:{minWidth:0},children:[e.jsx(he,{}),e.jsx(pe,{rows:m,status:p?"loading":"finish"})]})})}),e.jsx(ne,{dense:!1,page:o,count:l,rowsPerPage:u,rowsPerPageOptions:[15,25,100],onPageChange:g,onRowsPerPageChange:s})]})}const be={title:`Reports - Payment Report - ${te.site.name}`};function Be(){return e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:e.jsxs("title",{children:[" ",be.title]})}),e.jsx(ae,{maxWidth:"xl",children:e.jsxs(ce,{children:[e.jsx(ue,{}),e.jsx(je,{})]})})]})}export{Be as default};
